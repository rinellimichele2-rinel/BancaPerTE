{"file_contents":{"client/screens/WelcomeScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  TextInput,\n  Pressable,\n  StyleSheet,\n  KeyboardAvoidingView,\n  Platform,\n  ActivityIndicator,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { LinearGradient } from \"expo-linear-gradient\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\ntype NavigationProp = NativeStackNavigationProp<RootStackParamList>;\n\nexport default function WelcomeScreen() {\n  const insets = useSafeAreaInsets();\n  const navigation = useNavigation<NavigationProp>();\n  const { login, userId, needsSetup } = useAuth();\n  const [username, setUsername] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [showWelcome, setShowWelcome] = useState(false);\n  const [welcomeName, setWelcomeName] = useState(\"\");\n  const [isNewUser, setIsNewUser] = useState(false);\n\n  const handleEnter = async () => {\n    if (userId) {\n      navigation.navigate(needsSetup ? \"PinSetup\" : \"PinEntry\");\n      return;\n    }\n    \n    if (!username.trim()) return;\n    \n    setIsLoading(true);\n    try {\n      const result = await login(username.trim());\n      setWelcomeName(username.trim());\n      setShowWelcome(true);\n      setIsNewUser(result.needsSetup);\n    } catch (error) {\n      console.error(\"Login error:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleContinue = () => {\n    navigation.navigate(isNewUser ? \"PinSetup\" : \"PinEntry\");\n  };\n\n  return (\n    <LinearGradient\n      colors={[BankColors.primaryLight, BankColors.primary, BankColors.primaryDark]}\n      style={styles.container}\n    >\n      <KeyboardAvoidingView\n        behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n        style={styles.keyboardView}\n      >\n        <View style={[styles.content, { paddingTop: insets.top + Spacing[\"3xl\"], paddingBottom: insets.bottom + Spacing[\"3xl\"] }]}>\n          <View style={styles.logoContainer}>\n            <Text style={styles.logoText}>INTESA</Text>\n            <View style={styles.logoIcon}>\n              <Icon name=\"home\" size={20} color={BankColors.white} />\n            </View>\n            <Text style={styles.logoText}>SANPAOLO</Text>\n          </View>\n\n          <View style={styles.centerContent}>\n            {showWelcome ? (\n              <>\n                <Text style={styles.welcomeText}>Benvenuto {welcomeName}</Text>\n                <Pressable\n                  style={({ pressed }) => [\n                    styles.enterButton,\n                    pressed && styles.buttonPressed,\n                  ]}\n                  onPress={handleContinue}\n                >\n                  <Text style={styles.enterButtonText}>Entra</Text>\n                </Pressable>\n              </>\n            ) : userId ? (\n              <>\n                <Text style={styles.welcomeText}>Bentornato</Text>\n                <Pressable\n                  style={({ pressed }) => [\n                    styles.enterButton,\n                    pressed && styles.buttonPressed,\n                  ]}\n                  onPress={handleEnter}\n                >\n                  <Text style={styles.enterButtonText}>Entra</Text>\n                </Pressable>\n              </>\n            ) : (\n              <>\n                <Text style={styles.inputLabel}>Inserisci il tuo nome</Text>\n                <TextInput\n                  style={styles.input}\n                  value={username}\n                  onChangeText={setUsername}\n                  placeholder=\"Nome utente\"\n                  placeholderTextColor={BankColors.gray400}\n                  autoCapitalize=\"words\"\n                  autoCorrect={false}\n                />\n                <Pressable\n                  style={({ pressed }) => [\n                    styles.enterButton,\n                    pressed && styles.buttonPressed,\n                    (!username.trim() || isLoading) && styles.buttonDisabled,\n                  ]}\n                  onPress={handleEnter}\n                  disabled={!username.trim() || isLoading}\n                >\n                  {isLoading ? (\n                    <ActivityIndicator color={BankColors.primary} />\n                  ) : (\n                    <Text style={styles.enterButtonText}>Entra</Text>\n                  )}\n                </Pressable>\n              </>\n            )}\n          </View>\n\n          <View style={styles.bottomActions}>\n            <View style={styles.quickActions}>\n              <Pressable style={styles.quickAction}>\n                <View style={styles.quickActionIcon}>\n                  <Icon name=\"smartphone\" size={24} color={BankColors.white} />\n                </View>\n                <Text style={styles.quickActionText}>Prelievo{\"\\n\"}cardless</Text>\n              </Pressable>\n              <Pressable style={styles.quickAction}>\n                <View style={styles.quickActionIcon}>\n                  <Icon name=\"credit-card\" size={24} color={BankColors.white} />\n                </View>\n                <Text style={styles.quickActionText}>BANCOMAT{\"\\n\"}Pay</Text>\n              </Pressable>\n              <Pressable style={styles.quickAction}>\n                <View style={styles.quickActionIcon}>\n                  <Icon name=\"map-pin\" size={24} color={BankColors.white} />\n                </View>\n                <Text style={styles.quickActionText}>Vicino a me</Text>\n              </Pressable>\n              <Pressable style={styles.quickAction}>\n                <View style={styles.quickActionIcon}>\n                  <Icon name=\"more-vertical\" size={24} color={BankColors.white} />\n                </View>\n                <Text style={styles.quickActionText}>Altro</Text>\n              </Pressable>\n            </View>\n            <View style={styles.emergencyButton}>\n              <Text style={styles.emergencyText}>Emergenze</Text>\n            </View>\n          </View>\n        </View>\n      </KeyboardAvoidingView>\n    </LinearGradient>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  keyboardView: {\n    flex: 1,\n  },\n  content: {\n    flex: 1,\n    paddingHorizontal: Spacing.xl,\n  },\n  logoContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.sm,\n  },\n  logoText: {\n    color: BankColors.white,\n    fontSize: 18,\n    fontWeight: \"600\",\n    letterSpacing: 2,\n  },\n  logoIcon: {\n    width: 36,\n    height: 36,\n    borderRadius: 8,\n    borderWidth: 2,\n    borderColor: BankColors.white,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  centerContent: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    gap: Spacing.xl,\n  },\n  welcomeText: {\n    color: BankColors.white,\n    fontSize: 28,\n    fontWeight: \"400\",\n    textAlign: \"center\",\n  },\n  inputLabel: {\n    color: BankColors.white,\n    fontSize: 16,\n    marginBottom: Spacing.sm,\n  },\n  input: {\n    width: \"100%\",\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.lg,\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.md,\n    fontSize: 16,\n    color: BankColors.gray900,\n  },\n  enterButton: {\n    width: \"100%\",\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.xl,\n    paddingVertical: Spacing.lg,\n    alignItems: \"center\",\n  },\n  buttonPressed: {\n    opacity: 0.9,\n    transform: [{ scale: 0.98 }],\n  },\n  buttonDisabled: {\n    opacity: 0.6,\n  },\n  enterButtonText: {\n    color: BankColors.primary,\n    fontSize: 18,\n    fontWeight: \"600\",\n  },\n  bottomActions: {\n    gap: Spacing.lg,\n  },\n  quickActions: {\n    flexDirection: \"row\",\n    justifyContent: \"space-around\",\n    paddingVertical: Spacing.lg,\n  },\n  quickAction: {\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  quickActionIcon: {\n    width: 56,\n    height: 56,\n    borderRadius: 16,\n    backgroundColor: \"rgba(255,255,255,0.15)\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  quickActionText: {\n    color: BankColors.white,\n    fontSize: 11,\n    textAlign: \"center\",\n    opacity: 0.9,\n  },\n  emergencyButton: {\n    alignSelf: \"center\",\n    backgroundColor: \"rgba(255,255,255,0.2)\",\n    paddingHorizontal: Spacing.xl,\n    paddingVertical: Spacing.sm,\n    borderRadius: BorderRadius.lg,\n  },\n  emergencyText: {\n    color: BankColors.white,\n    fontSize: 14,\n  },\n});\n","path":null,"size_bytes":8621,"size_tokens":null},"client/lib/auth-context.tsx":{"content":"import React, { createContext, useContext, useState, useEffect, useCallback } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { getApiUrl, apiRequest } from \"@/lib/query-client\";\n\ninterface UserData {\n  id: string;\n  username: string;\n  rechargeUsername: string | null;\n  fullName: string;\n  accountNumber: string;\n  balance: string;\n  purchasedBalance: string;\n  cardLastFour: string;\n}\n\ninterface AuthContextType {\n  user: UserData | null;\n  userId: string | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  needsSetup: boolean;\n  login: (username: string) => Promise<{ userId: string; needsSetup: boolean }>;\n  setupPin: (pin: string) => Promise<boolean>;\n  verifyPin: (pin: string) => Promise<boolean>;\n  logout: () => Promise<void>;\n  refreshUser: () => Promise<void>;\n  updateBalance: (newBalance: string) => Promise<void>;\n  updateName: (newName: string) => Promise<void>;\n  updateAccountNumber: (newAccountNumber: string) => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nconst AUTH_STORAGE_KEY = \"@banking_auth\";\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<UserData | null>(null);\n  const [userId, setUserId] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [needsSetup, setNeedsSetup] = useState(false);\n\n  useEffect(() => {\n    loadStoredAuth();\n  }, []);\n\n  const loadStoredAuth = async () => {\n    try {\n      const stored = await AsyncStorage.getItem(AUTH_STORAGE_KEY);\n      if (stored) {\n        const { userId: storedUserId, needsSetup: storedNeedsSetup } = JSON.parse(stored);\n        if (storedUserId) {\n          setUserId(storedUserId);\n          setNeedsSetup(storedNeedsSetup || false);\n        }\n      }\n    } catch (error) {\n      console.error(\"Error loading auth:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = async (username: string): Promise<{ userId: string; needsSetup: boolean }> => {\n    const response = await apiRequest(\"POST\", \"/api/auth/login\", { username });\n    const data = await response.json();\n    \n    await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify({ \n      userId: data.userId,\n      username: data.username,\n      needsSetup: data.needsSetup\n    }));\n    \n    setUserId(data.userId);\n    setNeedsSetup(data.needsSetup);\n    return { userId: data.userId, needsSetup: data.needsSetup };\n  };\n\n  const setupPin = async (pin: string): Promise<boolean> => {\n    if (!userId) return false;\n    \n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/setup-pin\", { userId, pin });\n      const data = await response.json();\n      \n      if (data.success && data.user) {\n        setUser(data.user);\n        setNeedsSetup(false);\n        const stored = await AsyncStorage.getItem(AUTH_STORAGE_KEY);\n        const currentData = stored ? JSON.parse(stored) : {};\n        await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify({ \n          ...currentData,\n          userId,\n          needsSetup: false\n        }));\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"PIN setup error:\", error);\n      return false;\n    }\n  };\n\n  const verifyPin = async (pin: string): Promise<boolean> => {\n    if (!userId) return false;\n    \n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/verify-pin\", { userId, pin });\n      const data = await response.json();\n      \n      if (data.success && data.user) {\n        setUser(data.user);\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"PIN verification error:\", error);\n      return false;\n    }\n  };\n\n  const logout = async () => {\n    await AsyncStorage.removeItem(AUTH_STORAGE_KEY);\n    setUser(null);\n    setUserId(null);\n  };\n\n  const refreshUser = useCallback(async () => {\n    if (!userId) return;\n    \n    try {\n      const response = await fetch(new URL(`/api/user/${userId}`, getApiUrl()).toString());\n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n      }\n    } catch (error) {\n      console.error(\"Error refreshing user:\", error);\n    }\n  }, [userId]);\n\n  const updateBalance = async (newBalance: string) => {\n    if (!userId) return;\n    \n    try {\n      await apiRequest(\"PUT\", `/api/user/${userId}/balance`, { balance: newBalance });\n      await refreshUser();\n    } catch (error) {\n      console.error(\"Error updating balance:\", error);\n    }\n  };\n\n  const updateName = async (newName: string) => {\n    if (!userId) return;\n    \n    try {\n      await apiRequest(\"PUT\", `/api/user/${userId}/name`, { name: newName });\n      await refreshUser();\n    } catch (error) {\n      console.error(\"Error updating name:\", error);\n    }\n  };\n\n  const updateAccountNumber = async (newAccountNumber: string) => {\n    if (!userId) return;\n    \n    try {\n      await apiRequest(\"PUT\", `/api/user/${userId}/account-number`, { accountNumber: newAccountNumber });\n      await refreshUser();\n    } catch (error) {\n      console.error(\"Error updating account number:\", error);\n    }\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        userId,\n        isAuthenticated: !!user,\n        isLoading,\n        needsSetup,\n        login,\n        setupPin,\n        verifyPin,\n        logout,\n        refreshUser,\n        updateBalance,\n        updateName,\n        updateAccountNumber,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":5748,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Banking Interface App\n\n## Platform & Design System\n- **Platform**: Android (Material Design principles)\n- **Language**: Italian interface\n- **Data Storage**: Server-based (NOT local files)\n\n## Authentication Flow\n\n### 1. Username Screen (Screenshot 1)\n- Full-screen form with centered layout\n- White background\n- Bank logo at top center\n- Single text input field for username\n- Blue primary action button labeled \"AVANTI\" (Continue)\n- No navigation header\n- Clean, minimal design\n\n### 2. PIN Entry Screen (Screenshot 2)\n- Numeric keypad interface\n- 4-digit PIN display circles at top\n- Bank branding visible\n- Standard numeric grid (1-9, 0) with delete function\n- White background with subtle shadows on buttons\n\n## Main Dashboard (Screenshots 3-6)\n\n### Header\n- **Top Right**: Help icon (\"?\") - Single tap generates random transactions\n- **Color**: Teal/turquoise brand color (#00A19C approximate)\n- **Safe Area**: Standard Android status bar spacing\n\n### Balance Card\n- Large, prominent card at top\n- Displays \"Saldo disponibile\" (Available balance)\n- Large numeric value with € symbol\n- White text on teal gradient background\n- Rounded corners (8-12px radius)\n\n### Quick Action Grid (Screenshot 3)\n- 2x3 grid of action buttons below balance card\n- Each button contains:\n  - Icon (SVG)\n  - Label text below icon\n- White background cards with subtle elevation\n- Equal spacing between cards\n- Actions visible: Ricarica (Reload), Bonifico (Transfer), Bollettini (Bills), Pagamenti (Payments), Carta (Card), Altro (Other)\n\n### Transaction List\n- Below quick actions\n- \"Ultime operazioni\" (Recent operations) header\n- List items show:\n  - Left: Icon representing transaction type\n  - Center: Transaction description and date/time\n  - Right: Amount with +/- indicator and color coding (green for positive, red for negative)\n- Divider lines between items\n\n## Navigation Architecture\n- **Type**: Bottom Navigation Drawer (hamburger menu)\n- **Screens**: Multiple sections accessible via drawer menu\n\n## Detailed Screens (Screenshots 7-15)\n\n### Transaction Detail View\n- Full transaction information\n- Date, time, description\n- Amount prominently displayed\n- Category/type information\n- Back arrow navigation in header\n\n### Menu/Settings Screens\n- List-based navigation\n- Grouped sections with headers\n- Icons left-aligned with menu items\n- Chevron indicators for nested navigation\n- Options include: Profile, Cards, Payments, Settings, Help\n\n### Forms & Input Screens\n- Clean, single-column layouts\n- Input fields with subtle borders\n- Primary action buttons at bottom\n- Cancel/back options in header\n\n## Color Palette\n- **Primary**: Teal/Turquoise (#00A19C)\n- **Background**: White (#FFFFFF)\n- **Text Primary**: Dark gray/black\n- **Text Secondary**: Medium gray\n- **Success/Positive**: Green (#4CAF50)\n- **Error/Negative**: Red (#F44336)\n- **Card Shadows**: Subtle elevation (2-4dp)\n\n## Typography\n- **Headers**: Bold, 20-24sp\n- **Body**: Regular, 14-16sp\n- **Amounts**: Bold, 24-32sp\n- **Labels**: Regular, 12-14sp\n- Font: Roboto (Android standard)\n\n## Iconography\n- **Type**: SVG icons throughout\n- **Style**: Line-based, simple, Material Design compatible\n- **Size**: 24x24dp for standard icons, 32x32dp for prominent actions\n- **Color**: Matching brand teal or contextual colors\n\n## Layout Specifications\n- **Spacing**: 8dp base unit\n- **Card Padding**: 16dp\n- **Screen Margins**: 16dp horizontal\n- **Grid Gap**: 12-16dp\n- **Button Height**: 48-56dp\n- **Corner Radius**: 8-12dp for cards, 24dp for buttons\n\n## Interaction Design\n- **Touchable Feedback**: Material ripple effect\n- **Help Button**: Single tap generates random transaction entries\n- **Balance**: Editable/modifiable\n- **Navigation**: Smooth transitions between screens\n- **Form Submission**: Loading states for server communication\n\n## Critical Requirements\n1. **Exact Proportions**: Match screenshot layouts precisely\n2. **Sequential Order**: Follow screenshot sequence exactly\n3. **SVG Icons**: All icons must be SVG format\n4. **Dynamic Buttons**: Generate from screenshot analysis\n5. **Server Storage**: All data persists server-side\n6. **Italian Language**: All UI text in Italian\n\n## Accessibility\n- Minimum touch target: 48x48dp\n- Sufficient color contrast (4.5:1 minimum)\n- Clear visual hierarchy\n- Keyboard navigation support","path":null,"size_bytes":4318,"size_tokens":null},"client/index.js":{"content":"import { registerRootComponent } from \"expo\";\n\nimport App from \"@/App\";\n\nregisterRootComponent(App);\n","path":null,"size_bytes":101,"size_tokens":null},"scripts/build.js":{"content":"const fs = require(\"fs\");\nconst path = require(\"path\");\nconst { spawn } = require(\"child_process\");\nconst { Readable } = require(\"stream\");\nconst { pipeline } = require(\"stream/promises\");\n\nlet metroProcess = null;\n\nfunction exitWithError(message) {\n  console.error(message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n}\n\nfunction setupSignalHandlers() {\n  const cleanup = () => {\n    if (metroProcess) {\n      console.log(\"Cleaning up Metro process...\");\n      metroProcess.kill();\n    }\n    process.exit(0);\n  };\n\n  process.on(\"SIGINT\", cleanup);\n  process.on(\"SIGTERM\", cleanup);\n  process.on(\"SIGHUP\", cleanup);\n}\n\nfunction stripProtocol(domain) {\n  let urlString = domain.trim();\n\n  if (!/^https?:\\/\\//i.test(urlString)) {\n    urlString = `https://${urlString}`;\n  }\n\n  return new URL(urlString).host;\n}\n\nfunction getDeploymentDomain() {\n  // Check Replit deployment environment variables first\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    return stripProtocol(process.env.REPLIT_INTERNAL_APP_DOMAIN);\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    return stripProtocol(process.env.REPLIT_DEV_DOMAIN);\n  }\n\n  if (process.env.EXPO_PUBLIC_DOMAIN) {\n    return stripProtocol(process.env.EXPO_PUBLIC_DOMAIN);\n  }\n\n  console.error(\n    \"ERROR: No deployment domain found. Set REPLIT_INTERNAL_APP_DOMAIN, REPLIT_DEV_DOMAIN, or EXPO_PUBLIC_DOMAIN\",\n  );\n  process.exit(1);\n}\n\nfunction prepareDirectories(timestamp) {\n  console.log(\"Preparing build directories...\");\n\n  if (fs.existsSync(\"static-build\")) {\n    fs.rmSync(\"static-build\", { recursive: true });\n  }\n\n  const dirs = [\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"ios\"),\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"android\"),\n    path.join(\"static-build\", \"ios\"),\n    path.join(\"static-build\", \"android\"),\n  ];\n\n  for (const dir of dirs) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n\n  console.log(\"Build:\", timestamp);\n}\n\nfunction clearMetroCache() {\n  console.log(\"Clearing Metro cache...\");\n\n  const cacheDirs = [\n    ...fs.globSync(\".metro-cache\"),\n    ...fs.globSync(\"node_modules/.cache/metro\"),\n  ];\n\n  for (const dir of cacheDirs) {\n    fs.rmSync(dir, { recursive: true, force: true });\n  }\n\n  console.log(\"Cache cleared\");\n}\n\nasync function checkMetroHealth() {\n  try {\n    const response = await fetch(\"http://localhost:8081/status\", {\n      signal: AbortSignal.timeout(5000),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nasync function startMetro(expoPublicDomain) {\n  const isRunning = await checkMetroHealth();\n  if (isRunning) {\n    console.log(\"Metro already running\");\n    return;\n  }\n\n  console.log(\"Starting Metro...\");\n  console.log(`Setting EXPO_PUBLIC_DOMAIN=${expoPublicDomain}`);\n  const env = {\n    ...process.env,\n    EXPO_PUBLIC_DOMAIN: expoPublicDomain,\n  };\n  metroProcess = spawn(\"npm\", [\"run\", \"expo:start:static:build\"], {\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n    detached: false,\n    env,\n  });\n\n  if (metroProcess.stdout) {\n    metroProcess.stdout.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.log(`[Metro] ${output}`);\n    });\n  }\n  if (metroProcess.stderr) {\n    metroProcess.stderr.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.error(`[Metro Error] ${output}`);\n    });\n  }\n\n  for (let i = 0; i < 60; i++) {\n    await new Promise((resolve) => setTimeout(resolve, 1000));\n\n    const healthy = await checkMetroHealth();\n    if (healthy) {\n      console.log(\"Metro ready\");\n      return;\n    }\n  }\n\n  console.error(\"Metro timeout\");\n  process.exit(1);\n}\n\nasync function downloadFile(url, outputPath) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 120_000);\n\n  try {\n    console.log(`Downloading: ${url}`);\n    const response = await fetch(url, { signal: controller.signal });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const file = fs.createWriteStream(outputPath);\n    await pipeline(Readable.fromWeb(response.body), file);\n\n    const fileSize = fs.statSync(outputPath).size;\n\n    if (fileSize === 0) {\n      fs.unlinkSync(outputPath);\n      throw new Error(\"Downloaded file is empty\");\n    }\n  } catch (error) {\n    if (fs.existsSync(outputPath)) {\n      fs.unlinkSync(outputPath);\n    }\n\n    if (error.name === \"AbortError\") {\n      throw new Error(`Download timeout after 2m: ${url}`);\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundle(platform, timestamp) {\n  const url = new URL(\"http://localhost:8081/client/index.bundle\");\n  url.searchParams.set(\"platform\", platform);\n  url.searchParams.set(\"dev\", \"false\");\n  url.searchParams.set(\"hot\", \"false\");\n  url.searchParams.set(\"lazy\", \"false\");\n  url.searchParams.set(\"minify\", \"true\");\n\n  const output = path.join(\n    \"static-build\",\n    timestamp,\n    \"_expo\",\n    \"static\",\n    \"js\",\n    platform,\n    \"bundle.js\",\n  );\n\n  console.log(`Fetching ${platform} bundle...`);\n  await downloadFile(url.toString(), output);\n  console.log(`${platform} bundle ready`);\n}\n\nasync function downloadManifest(platform) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 300_000);\n\n  try {\n    console.log(`Fetching ${platform} manifest...`);\n    const response = await fetch(\"http://localhost:8081/manifest\", {\n      headers: { \"expo-platform\": platform },\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const manifest = await response.json();\n    console.log(`${platform} manifest ready`);\n    return manifest;\n  } catch (error) {\n    if (error.name === \"AbortError\") {\n      throw new Error(\n        `Manifest download timeout after 5m for platform: ${platform}`,\n      );\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundlesAndManifests(timestamp) {\n  console.log(\"Downloading bundles and manifests...\");\n  console.log(\"This may take several minutes for production builds...\");\n\n  try {\n    const results = await Promise.allSettled([\n      downloadBundle(\"ios\", timestamp),\n      downloadBundle(\"android\", timestamp),\n      downloadManifest(\"ios\"),\n      downloadManifest(\"android\"),\n    ]);\n\n    const failures = results\n      .map((result, index) => ({ result, index }))\n      .filter(({ result }) => result.status === \"rejected\");\n\n    if (failures.length > 0) {\n      const errorMessages = failures.map(({ result, index }) => {\n        const names = [\n          \"iOS bundle\",\n          \"Android bundle\",\n          \"iOS manifest\",\n          \"Android manifest\",\n        ];\n        return `  - ${names[index]}: ${result.reason?.message || result.reason}`;\n      });\n\n      exitWithError(`Download failed:\\n${errorMessages.join(\"\\n\")}`);\n    }\n\n    const iosManifest =\n      results[2].status === \"fulfilled\" ? results[2].value : null;\n    const androidManifest =\n      results[3].status === \"fulfilled\" ? results[3].value : null;\n\n    console.log(\"All downloads completed successfully\");\n    return { ios: iosManifest, android: androidManifest };\n  } catch (error) {\n    exitWithError(`Unexpected download error: ${error.message}`);\n  }\n}\n\nfunction extractAssets(timestamp) {\n  const bundles = {\n    ios: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"ios\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n    android: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"android\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n  };\n\n  const assetsMap = new Map();\n  const assetPattern =\n    /httpServerLocation:\"([^\"]+)\"[^}]*hash:\"([^\"]+)\"[^}]*name:\"([^\"]+)\"[^}]*type:\"([^\"]+)\"/g;\n\n  const extractFromBundle = (bundle, platform) => {\n    for (const match of bundle.matchAll(assetPattern)) {\n      const originalPath = match[1];\n      const filename = match[3] + \".\" + match[4];\n\n      const tempUrl = new URL(`http://localhost:8081${originalPath}`);\n      const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n      if (!unstablePath) {\n        throw new Error(`Asset missing unstable_path: ${originalPath}`);\n      }\n\n      const decodedPath = decodeURIComponent(unstablePath);\n      const key = path.posix.join(decodedPath, filename);\n\n      if (!assetsMap.has(key)) {\n        const asset = {\n          url: path.posix.join(\"/\", decodedPath, filename),\n          originalPath: originalPath,\n          filename: filename,\n          relativePath: decodedPath,\n          hash: match[2],\n          platforms: new Set(),\n        };\n\n        assetsMap.set(key, asset);\n      }\n      assetsMap.get(key).platforms.add(platform);\n    }\n  };\n\n  extractFromBundle(bundles.ios, \"ios\");\n  extractFromBundle(bundles.android, \"android\");\n\n  return Array.from(assetsMap.values());\n}\n\nasync function downloadAssets(assets, timestamp) {\n  if (assets.length === 0) {\n    return 0;\n  }\n\n  console.log(\"Downloading assets...\");\n  let successCount = 0;\n  const failures = [];\n\n  const downloadPromises = assets.map(async (asset) => {\n    const platform = Array.from(asset.platforms)[0];\n\n    const tempUrl = new URL(`http://localhost:8081${asset.originalPath}`);\n    const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n    if (!unstablePath) {\n      throw new Error(`Asset missing unstable_path: ${asset.originalPath}`);\n    }\n\n    const decodedPath = decodeURIComponent(unstablePath);\n    const metroUrl = new URL(\n      `http://localhost:8081${path.posix.join(\"/assets\", decodedPath, asset.filename)}`,\n    );\n    metroUrl.searchParams.set(\"platform\", platform);\n    metroUrl.searchParams.set(\"hash\", asset.hash);\n\n    const outputDir = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      asset.relativePath,\n    );\n    fs.mkdirSync(outputDir, { recursive: true });\n    const output = path.join(outputDir, asset.filename);\n\n    try {\n      await downloadFile(metroUrl.toString(), output);\n      successCount++;\n    } catch (error) {\n      failures.push({\n        filename: asset.filename,\n        error: error.message,\n        url: metroUrl.toString(),\n      });\n    }\n  });\n\n  await Promise.all(downloadPromises);\n\n  if (failures.length > 0) {\n    const errorMsg =\n      `Failed to download ${failures.length} asset(s):\\n` +\n      failures\n        .map((f) => `  - ${f.filename}: ${f.error} (${f.url})`)\n        .join(\"\\n\");\n    exitWithError(errorMsg);\n  }\n\n  console.log(`Downloaded ${successCount} assets`);\n  return successCount;\n}\n\nfunction updateBundleUrls(timestamp, baseUrl) {\n  const updateForPlatform = (platform) => {\n    const bundlePath = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      platform,\n      \"bundle.js\",\n    );\n    let bundle = fs.readFileSync(bundlePath, \"utf-8\");\n\n    bundle = bundle.replace(\n      /httpServerLocation:\"(\\/[^\"]+)\"/g,\n      (_match, capturedPath) => {\n        const tempUrl = new URL(`http://localhost:8081${capturedPath}`);\n        const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n        if (!unstablePath) {\n          throw new Error(\n            `Asset missing unstable_path in bundle: ${capturedPath}`,\n          );\n        }\n\n        const decodedPath = decodeURIComponent(unstablePath);\n        return `httpServerLocation:\"${baseUrl}/${timestamp}/_expo/static/js/${decodedPath}\"`;\n      },\n    );\n\n    fs.writeFileSync(bundlePath, bundle);\n  };\n\n  updateForPlatform(\"ios\");\n  updateForPlatform(\"android\");\n  console.log(\"Updated bundle URLs\");\n}\n\nfunction updateManifests(manifests, timestamp, baseUrl, assetsByHash) {\n  const updateForPlatform = (platform, manifest) => {\n    if (!manifest.launchAsset || !manifest.extra) {\n      exitWithError(`Malformed manifest for ${platform}`);\n    }\n\n    manifest.launchAsset.url = `${baseUrl}/${timestamp}/_expo/static/js/${platform}/bundle.js`;\n    manifest.launchAsset.key = `bundle-${timestamp}`;\n    manifest.createdAt = new Date(\n      Number(timestamp.split(\"-\")[0]),\n    ).toISOString();\n    manifest.extra.expoClient.hostUri =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.debuggerHost =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.packagerOpts.dev = false;\n\n    if (manifest.assets && manifest.assets.length > 0) {\n      manifest.assets.forEach((asset) => {\n        if (!asset.url) return;\n\n        const hash = asset.hash;\n        if (!hash) return;\n\n        const assetInfo = assetsByHash.get(hash);\n        if (!assetInfo) return;\n\n        asset.url = `${baseUrl}/${timestamp}/_expo/static/js/${assetInfo.relativePath}/${assetInfo.filename}`;\n      });\n    }\n\n    fs.writeFileSync(\n      path.join(\"static-build\", platform, \"manifest.json\"),\n      JSON.stringify(manifest, null, 2),\n    );\n  };\n\n  updateForPlatform(\"ios\", manifests.ios);\n  updateForPlatform(\"android\", manifests.android);\n  console.log(\"Manifests updated\");\n}\n\nasync function main() {\n  console.log(\"Building static Expo Go deployment...\");\n\n  setupSignalHandlers();\n\n  const domain = getDeploymentDomain();\n  const baseUrl = `https://${domain}`;\n  const timestamp = `${Date.now()}-${process.pid}`;\n\n  prepareDirectories(timestamp);\n  clearMetroCache();\n\n  await startMetro(domain);\n\n  const downloadTimeout = 300000;\n  const downloadPromise = downloadBundlesAndManifests(timestamp);\n  const timeoutPromise = new Promise((_, reject) => {\n    setTimeout(() => {\n      reject(\n        new Error(\n          `Overall download timeout after ${downloadTimeout / 1000} seconds. ` +\n            \"Metro may be struggling to generate bundles. Check Metro logs above.\",\n        ),\n      );\n    }, downloadTimeout);\n  });\n\n  const manifests = await Promise.race([downloadPromise, timeoutPromise]);\n\n  console.log(\"Processing assets...\");\n  const assets = extractAssets(timestamp);\n  console.log(\"Found\", assets.length, \"unique asset(s)\");\n\n  const assetsByHash = new Map();\n  for (const asset of assets) {\n    assetsByHash.set(asset.hash, {\n      relativePath: asset.relativePath,\n      filename: asset.filename,\n    });\n  }\n\n  const assetCount = await downloadAssets(assets, timestamp);\n\n  if (assetCount > 0) {\n    updateBundleUrls(timestamp, baseUrl);\n  }\n\n  console.log(\"Updating manifests and creating landing page...\");\n  updateManifests(manifests, timestamp, baseUrl, assetsByHash);\n\n  console.log(\"Build complete! Deploy to:\", baseUrl);\n\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(0);\n}\n\nmain().catch((error) => {\n  console.error(\"Build failed:\", error.message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n});\n","path":null,"size_bytes":14884,"size_tokens":null},"server/replit_integrations/news/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport OpenAI from \"openai\";\nimport { db } from \"../../db\";\nimport { transactions } from \"../../../shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\ninterface NewsArticle {\n  id: string;\n  title: string;\n  summary: string;\n  category: string;\n  relevanceScore: number;\n  source: string;\n  publishedAt: string;\n  icon: string;\n}\n\nconst FINANCIAL_NEWS_TOPICS = [\n  { category: \"Mercati\", icon: \"trending-up\", topics: [\"Borsa Italiana\", \"FTSE MIB\", \"mercati azionari europei\", \"Wall Street\"] },\n  { category: \"Economia\", icon: \"globe\", topics: [\"PIL Italia\", \"inflazione\", \"BCE tassi interesse\", \"economia europea\"] },\n  { category: \"Risparmio\", icon: \"piggy-bank\", topics: [\"conti deposito\", \"buoni fruttiferi\", \"investimenti sicuri\", \"rendimenti\"] },\n  { category: \"Banche\", icon: \"building\", topics: [\"banche italiane\", \"mutui\", \"prestiti\", \"fintech\"] },\n  { category: \"Crypto\", icon: \"cpu\", topics: [\"Bitcoin\", \"criptovalute\", \"blockchain\", \"ETF crypto\"] },\n  { category: \"Immobiliare\", icon: \"home\", topics: [\"mercato immobiliare\", \"mutui casa\", \"affitti\", \"prezzi case\"] },\n  { category: \"Lavoro\", icon: \"briefcase\", topics: [\"occupazione Italia\", \"pensioni\", \"INPS\", \"stipendi\"] },\n  { category: \"Fisco\", icon: \"file-text\", topics: [\"tasse\", \"dichiarazione redditi\", \"bonus fiscali\", \"detrazioni\"] },\n];\n\nasync function generatePersonalizedNews(userId: string | null, userBalance: number): Promise<NewsArticle[]> {\n  let spendingCategories: string[] = [];\n  \n  if (userId) {\n    const userTransactions = await db.select()\n      .from(transactions)\n      .where(eq(transactions.userId, userId))\n      .orderBy(desc(transactions.date))\n      .limit(50);\n    \n    const categoryCount: Record<string, number> = {};\n    userTransactions.forEach(tx => {\n      categoryCount[tx.category] = (categoryCount[tx.category] || 0) + 1;\n    });\n    \n    spendingCategories = Object.entries(categoryCount)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([cat]) => cat);\n  }\n\n  const today = new Date();\n  const dateStr = today.toLocaleDateString(\"it-IT\", { day: \"numeric\", month: \"long\", year: \"numeric\" });\n\n  const prompt = `Sei un esperto giornalista finanziario italiano. Genera 8 notizie finanziarie realistiche e attuali per un utente di una app bancaria italiana.\n\nData di oggi: ${dateStr}\nSaldo utente: €${userBalance.toFixed(2)}\nCategorie di spesa principali dell'utente: ${spendingCategories.length > 0 ? spendingCategories.join(\", \") : \"varie\"}\n\nGenera notizie personalizzate che siano rilevanti per questo profilo utente. Le notizie devono essere:\n- Realistiche e plausibili per il mercato italiano attuale\n- Variate tra diverse categorie (mercati, risparmio, economia, banche, immobiliare, lavoro)\n- Alcune positive, alcune neutre\n- Scritte in modo professionale ma accessibile\n\nRispondi SOLO con un array JSON valido (senza markdown, senza commenti). Ogni oggetto deve avere:\n{\n  \"title\": \"titolo breve della notizia (max 80 caratteri)\",\n  \"summary\": \"riassunto della notizia in 2-3 frasi (max 200 caratteri)\",\n  \"category\": \"una tra: Mercati, Economia, Risparmio, Banche, Crypto, Immobiliare, Lavoro, Fisco\",\n  \"relevanceScore\": numero da 1 a 100 indicante rilevanza per questo utente,\n  \"source\": \"nome fonte credibile italiana (es: Il Sole 24 Ore, Milano Finanza, ANSA Economia)\"\n}`;\n\n  try {\n    const completion = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: [{ role: \"user\", content: prompt }],\n      max_tokens: 2000,\n      temperature: 0.8,\n    });\n\n    const content = completion.choices[0]?.message?.content || \"[]\";\n    const cleanContent = content.replace(/```json\\n?/g, \"\").replace(/```\\n?/g, \"\").trim();\n    const newsItems = JSON.parse(cleanContent);\n\n    return newsItems.map((item: any, index: number) => {\n      const categoryInfo = FINANCIAL_NEWS_TOPICS.find(t => t.category === item.category) || FINANCIAL_NEWS_TOPICS[0];\n      return {\n        id: `news-${Date.now()}-${index}`,\n        title: item.title,\n        summary: item.summary,\n        category: item.category,\n        relevanceScore: item.relevanceScore,\n        source: item.source,\n        publishedAt: new Date(Date.now() - Math.random() * 24 * 60 * 60 * 1000).toISOString(),\n        icon: categoryInfo.icon,\n      };\n    });\n  } catch (error) {\n    console.error(\"Error generating news:\", error);\n    return getDefaultNews();\n  }\n}\n\nfunction getDefaultNews(): NewsArticle[] {\n  const now = new Date();\n  return [\n    {\n      id: \"default-1\",\n      title: \"FTSE MIB chiude in rialzo: banche protagoniste\",\n      summary: \"La Borsa di Milano chiude positiva trainata dal comparto bancario. I titoli del settore tra i migliori della giornata.\",\n      category: \"Mercati\",\n      relevanceScore: 85,\n      source: \"Il Sole 24 Ore\",\n      publishedAt: now.toISOString(),\n      icon: \"trending-up\",\n    },\n    {\n      id: \"default-2\",\n      title: \"BCE: tassi invariati, focus su inflazione\",\n      summary: \"La Banca Centrale Europea mantiene i tassi di interesse stabili. Lagarde: 'Monitoreremo attentamente i dati sull'inflazione'.\",\n      category: \"Economia\",\n      relevanceScore: 90,\n      source: \"ANSA Economia\",\n      publishedAt: new Date(now.getTime() - 2 * 60 * 60 * 1000).toISOString(),\n      icon: \"globe\",\n    },\n    {\n      id: \"default-3\",\n      title: \"Conti deposito: rendimenti in aumento\",\n      summary: \"Le banche italiane alzano i tassi sui conti deposito. Opportunità interessanti per i risparmiatori.\",\n      category: \"Risparmio\",\n      relevanceScore: 95,\n      source: \"Milano Finanza\",\n      publishedAt: new Date(now.getTime() - 4 * 60 * 60 * 1000).toISOString(),\n      icon: \"piggy-bank\",\n    },\n    {\n      id: \"default-4\",\n      title: \"Mercato immobiliare: prezzi stabili nel 2024\",\n      summary: \"L'Osservatorio del Mercato Immobiliare conferma la stabilizzazione dei prezzi nelle principali città italiane.\",\n      category: \"Immobiliare\",\n      relevanceScore: 75,\n      source: \"Idealista News\",\n      publishedAt: new Date(now.getTime() - 6 * 60 * 60 * 1000).toISOString(),\n      icon: \"home\",\n    },\n  ];\n}\n\nexport function registerNewsRoutes(app: Express): void {\n  app.get(\"/api/news\", async (req: Request, res: Response) => {\n    try {\n      const userId = req.query.userId as string | undefined;\n      const balance = parseFloat(req.query.balance as string) || 1000;\n\n      const news = await generatePersonalizedNews(userId || null, balance);\n      \n      res.json({\n        news: news.sort((a, b) => b.relevanceScore - a.relevanceScore),\n        generatedAt: new Date().toISOString(),\n        personalized: !!userId,\n      });\n    } catch (error) {\n      console.error(\"Error fetching news:\", error);\n      res.status(500).json({ error: \"Failed to fetch news\" });\n    }\n  });\n\n  app.get(\"/api/news/categories\", (req: Request, res: Response) => {\n    res.json(FINANCIAL_NEWS_TOPICS.map(t => ({\n      category: t.category,\n      icon: t.icon,\n    })));\n  });\n}\n","path":null,"size_bytes":7157,"size_tokens":null},"client/screens/TransferScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  TextInput,\n  StyleSheet,\n  Alert,\n  ActivityIndicator,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { apiRequest, getApiUrl } from \"@/lib/query-client\";\n\ninterface UserInfo {\n  id: string;\n  username: string;\n  fullName: string | null;\n  accountNumber: string | null;\n  balance: string | null;\n}\n\nexport default function TransferScreen() {\n  const insets = useSafeAreaInsets();\n  const navigation = useNavigation();\n  const { user, refreshUser } = useAuth();\n  const queryClient = useQueryClient();\n  \n  const [searchUsername, setSearchUsername] = useState(\"\");\n  const [selectedUser, setSelectedUser] = useState<UserInfo | null>(null);\n  const [amount, setAmount] = useState(\"\");\n  const [isTransferring, setIsTransferring] = useState(false);\n  const [isSearching, setIsSearching] = useState(false);\n  const [searchError, setSearchError] = useState<string | null>(null);\n\n  const handleSearch = async () => {\n    if (!searchUsername.trim()) {\n      setSearchError(\"Inserisci uno username da cercare\");\n      return;\n    }\n\n    const usernameToSearch = searchUsername.trim().replace(/^@/, \"\");\n    \n    if (usernameToSearch.toLowerCase() === user?.username.toLowerCase()) {\n      setSearchError(\"Non puoi inviare denaro a te stesso\");\n      return;\n    }\n\n    setIsSearching(true);\n    setSearchError(null);\n    setSelectedUser(null);\n\n    try {\n      const response = await fetch(\n        new URL(`/api/users/search/${encodeURIComponent(usernameToSearch)}`, getApiUrl()).toString()\n      );\n      \n      if (response.ok) {\n        const foundUser = await response.json();\n        setSelectedUser(foundUser);\n        setSearchError(null);\n      } else if (response.status === 404) {\n        setSearchError(\"Utente non trovato. Verifica lo username e riprova.\");\n      } else {\n        setSearchError(\"Errore durante la ricerca\");\n      }\n    } catch (error) {\n      setSearchError(\"Errore di connessione. Riprova.\");\n    } finally {\n      setIsSearching(false);\n    }\n  };\n\n  const clearSearch = () => {\n    setSearchUsername(\"\");\n    setSelectedUser(null);\n    setSearchError(null);\n    setAmount(\"\");\n  };\n\n  const handleTransfer = async () => {\n    if (!selectedUser || !amount || !user) return;\n\n    const amountNum = parseFloat(amount);\n    if (isNaN(amountNum) || amountNum <= 0) {\n      Alert.alert(\"Errore\", \"Inserisci un importo valido maggiore di zero\");\n      return;\n    }\n\n    const currentBalance = parseFloat(user.balance || \"0\");\n    if (amountNum > currentBalance) {\n      Alert.alert(\"Errore\", \"Saldo insufficiente per questo trasferimento\");\n      return;\n    }\n\n    Alert.alert(\n      \"Conferma Trasferimento\",\n      `Vuoi trasferire ${amountNum.toFixed(0)} EUR a @${selectedUser.username}?\\n\\nCodice ID: ${selectedUser.accountNumber || \"N/A\"}`,\n      [\n        { text: \"Annulla\", style: \"cancel\" },\n        {\n          text: \"Conferma\",\n          onPress: async () => {\n            setIsTransferring(true);\n            try {\n              const response = await apiRequest(\"POST\", \"/api/transfer\", {\n                fromUserId: user.id,\n                toUserId: selectedUser.id,\n                amount: amountNum,\n              });\n\n              const data = await response.json();\n              if (data.success) {\n                await refreshUser();\n                await queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n                await queryClient.invalidateQueries({ queryKey: [`/api/transactions/${user.id}`] });\n                \n                Alert.alert(\n                  \"Trasferimento Completato\",\n                  `Hai trasferito ${amountNum.toFixed(0)} EUR a @${selectedUser.username}`,\n                  [{ text: \"OK\", onPress: () => navigation.goBack() }]\n                );\n              } else {\n                Alert.alert(\"Errore\", data.error || \"Errore durante il trasferimento\");\n              }\n            } catch (error: any) {\n              if (error.securityViolation) {\n                Alert.alert(\n                  \"Sicurezza\",\n                  \"Rilevata modifica non autorizzata. L'operazione è stata bloccata.\",\n                  [{ text: \"OK\" }]\n                );\n              } else {\n                Alert.alert(\"Errore\", error.message || \"Errore durante il trasferimento\");\n              }\n            } finally {\n              setIsTransferring(false);\n            }\n          },\n        },\n      ]\n    );\n  };\n\n  const formatBalance = (balance: string | null | undefined) => {\n    if (!balance) return \"0\";\n    const num = parseFloat(balance);\n    return num.toLocaleString(\"it-IT\", { minimumFractionDigits: 0, maximumFractionDigits: 0 });\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={[styles.header, { paddingTop: insets.top + Spacing.md }]}>\n        <Pressable style={styles.backButton} onPress={() => navigation.goBack()}>\n          <Icon name=\"arrow-left\" size={24} color={BankColors.white} />\n        </Pressable>\n        <Text style={styles.headerTitle}>Scambia Denaro</Text>\n        <View style={{ width: 40 }} />\n      </View>\n\n      <View style={styles.balanceCard}>\n        <Text style={styles.balanceLabel}>Il tuo saldo disponibile</Text>\n        <Text style={styles.balanceAmount}>{formatBalance(user?.balance)} EUR</Text>\n      </View>\n\n      <ScrollView \n        style={styles.scrollView}\n        contentContainerStyle={{ paddingBottom: insets.bottom + 100 }}\n      >\n        <Text style={styles.sectionTitle}>Cerca destinatario</Text>\n        \n        <View style={styles.searchContainer}>\n          <View style={styles.searchInputContainer}>\n            <Icon name=\"at-sign\" size={20} color={BankColors.gray500} />\n            <TextInput\n              style={styles.searchInput}\n              value={searchUsername}\n              onChangeText={(text) => {\n                setSearchUsername(text);\n                setSearchError(null);\n              }}\n              placeholder=\"Inserisci username\"\n              placeholderTextColor={BankColors.gray400}\n              autoCapitalize=\"none\"\n              autoCorrect={false}\n              onSubmitEditing={handleSearch}\n              returnKeyType=\"search\"\n            />\n            {searchUsername.length > 0 ? (\n              <Pressable onPress={clearSearch} style={styles.clearButton}>\n                <Icon name=\"x\" size={18} color={BankColors.gray500} />\n              </Pressable>\n            ) : null}\n          </View>\n          <Pressable \n            style={[styles.searchButton, isSearching && styles.searchButtonDisabled]}\n            onPress={handleSearch}\n            disabled={isSearching}\n          >\n            {isSearching ? (\n              <ActivityIndicator color={BankColors.white} size=\"small\" />\n            ) : (\n              <Icon name=\"search\" size={20} color={BankColors.white} />\n            )}\n          </Pressable>\n        </View>\n\n        {searchError ? (\n          <View style={styles.errorContainer}>\n            <Icon name=\"alert-circle\" size={20} color={BankColors.error} />\n            <Text style={styles.errorText}>{searchError}</Text>\n          </View>\n        ) : null}\n\n        {selectedUser ? (\n          <View style={styles.usersList}>\n            <View style={styles.foundUserLabel}>\n              <Icon name=\"check-circle\" size={16} color={BankColors.primary} />\n              <Text style={styles.foundUserText}>Utente trovato</Text>\n            </View>\n            <View style={[styles.userCard, styles.userCardSelected]}>\n              <View style={styles.userAvatar}>\n                <Text style={styles.userAvatarText}>\n                  {selectedUser.username.charAt(0).toUpperCase()}\n                </Text>\n              </View>\n              <View style={styles.userInfo}>\n                <Text style={styles.userName}>@{selectedUser.username}</Text>\n                <Text style={styles.userAccount}>\n                  {selectedUser.accountNumber || \"ID non disponibile\"}\n                </Text>\n              </View>\n              <Icon name=\"check-circle\" size={24} color={BankColors.primary} />\n            </View>\n          </View>\n        ) : !searchError && !isSearching ? (\n          <View style={styles.hintContainer}>\n            <Icon name=\"info\" size={20} color={BankColors.gray400} />\n            <Text style={styles.hintText}>\n              Inserisci lo username esatto del destinatario per inviare denaro\n            </Text>\n          </View>\n        ) : null}\n\n        {selectedUser ? (\n          <View style={styles.transferForm}>\n            <Text style={styles.sectionTitle}>Importo da trasferire</Text>\n            <View style={styles.amountInputContainer}>\n              <Text style={styles.currencySymbol}>EUR</Text>\n              <TextInput\n                style={styles.amountInput}\n                value={amount}\n                onChangeText={(text) => setAmount(text.replace(/[^0-9]/g, \"\"))}\n                placeholder=\"0\"\n                placeholderTextColor={BankColors.gray400}\n                keyboardType=\"numeric\"\n                maxLength={7}\n              />\n            </View>\n\n            <Pressable\n              style={[\n                styles.transferButton,\n                (!amount || isTransferring) && styles.transferButtonDisabled,\n              ]}\n              onPress={handleTransfer}\n              disabled={!amount || isTransferring}\n            >\n              {isTransferring ? (\n                <ActivityIndicator color={BankColors.white} />\n              ) : (\n                <>\n                  <Icon name=\"send\" size={20} color={BankColors.white} />\n                  <Text style={styles.transferButtonText}>Trasferisci</Text>\n                </>\n              )}\n            </Pressable>\n          </View>\n        ) : null}\n      </ScrollView>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.gray100,\n  },\n  header: {\n    backgroundColor: BankColors.primary,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.lg,\n  },\n  backButton: {\n    width: 40,\n    height: 40,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  headerTitle: {\n    fontSize: 18,\n    fontWeight: \"600\",\n    color: BankColors.white,\n  },\n  balanceCard: {\n    backgroundColor: BankColors.primary,\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.xl,\n    alignItems: \"center\",\n  },\n  balanceLabel: {\n    fontSize: 14,\n    color: \"rgba(255,255,255,0.8)\",\n    marginBottom: Spacing.xs,\n  },\n  balanceAmount: {\n    fontSize: 32,\n    fontWeight: \"700\",\n    color: BankColors.white,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  sectionTitle: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray700,\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.lg,\n    paddingBottom: Spacing.sm,\n  },\n  searchContainer: {\n    flexDirection: \"row\",\n    paddingHorizontal: Spacing.lg,\n    gap: Spacing.sm,\n  },\n  searchInputContainer: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.md,\n    paddingHorizontal: Spacing.md,\n    gap: Spacing.sm,\n  },\n  searchInput: {\n    flex: 1,\n    fontSize: 16,\n    color: BankColors.gray900,\n    paddingVertical: Spacing.md,\n  },\n  clearButton: {\n    padding: Spacing.xs,\n  },\n  searchButton: {\n    backgroundColor: BankColors.primary,\n    borderRadius: BorderRadius.md,\n    width: 50,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  searchButtonDisabled: {\n    opacity: 0.7,\n  },\n  errorContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.md,\n  },\n  errorText: {\n    fontSize: 14,\n    color: BankColors.error,\n    flex: 1,\n  },\n  hintContainer: {\n    flexDirection: \"row\",\n    alignItems: \"flex-start\",\n    gap: Spacing.sm,\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.lg,\n    paddingBottom: Spacing.md,\n  },\n  hintText: {\n    fontSize: 14,\n    color: BankColors.gray500,\n    flex: 1,\n    lineHeight: 20,\n  },\n  foundUserLabel: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n    marginBottom: Spacing.sm,\n  },\n  foundUserText: {\n    fontSize: 14,\n    color: BankColors.primary,\n    fontWeight: \"500\",\n  },\n  usersList: {\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.md,\n  },\n  userCard: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginBottom: Spacing.sm,\n    borderWidth: 2,\n    borderColor: \"transparent\",\n  },\n  userCardSelected: {\n    borderColor: BankColors.primary,\n    backgroundColor: \"rgba(32, 128, 55, 0.05)\",\n  },\n  userAvatar: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  userAvatarText: {\n    fontSize: 20,\n    fontWeight: \"700\",\n    color: BankColors.white,\n  },\n  userInfo: {\n    flex: 1,\n  },\n  userName: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  userAccount: {\n    fontSize: 14,\n    color: BankColors.gray500,\n    marginTop: 2,\n  },\n  transferForm: {\n    marginTop: Spacing.md,\n  },\n  amountInputContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.white,\n    marginHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n  },\n  currencySymbol: {\n    fontSize: 18,\n    fontWeight: \"600\",\n    color: BankColors.gray500,\n    marginRight: Spacing.md,\n  },\n  amountInput: {\n    flex: 1,\n    fontSize: 32,\n    fontWeight: \"700\",\n    color: BankColors.gray900,\n  },\n  transferButton: {\n    backgroundColor: BankColors.primary,\n    marginHorizontal: Spacing.lg,\n    marginTop: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.sm,\n  },\n  transferButtonDisabled: {\n    opacity: 0.5,\n  },\n  transferButtonText: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.white,\n  },\n});\n","path":null,"size_bytes":14655,"size_tokens":null},"server/replit_integrations/image/index.ts":{"content":"export { registerImageRoutes } from \"./routes\";\nexport { openai, generateImageBuffer, editImages } from \"./client\";\n\n","path":null,"size_bytes":117,"size_tokens":null},"server/replit_integrations/image/client.ts":{"content":"import fs from \"node:fs\";\nimport OpenAI, { toFile } from \"openai\";\nimport { Buffer } from \"node:buffer\";\n\nexport const openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\nexport async function generateImageBuffer(\n  prompt: string,\n  size: \"1024x1024\" | \"512x512\" | \"256x256\" = \"1024x1024\"\n): Promise<Buffer> {\n  const response = await openai.images.generate({\n    model: \"gpt-image-1\",\n    prompt,\n    size,\n  });\n  const base64 = response.data?.[0]?.b64_json ?? \"\";\n  return Buffer.from(base64, \"base64\");\n}\n\nexport async function editImages(\n  imageFiles: string[],\n  prompt: string,\n  outputPath?: string\n): Promise<Buffer> {\n  const images = await Promise.all(\n    imageFiles.map((file) =>\n      toFile(fs.createReadStream(file), file, {\n        type: \"image/png\",\n      })\n    )\n  );\n\n  const response = await openai.images.edit({\n    model: \"gpt-image-1\",\n    image: images,\n    prompt,\n  });\n\n  const imageBase64 = response.data?.[0]?.b64_json ?? \"\";\n  const imageBytes = Buffer.from(imageBase64, \"base64\");\n\n  if (outputPath) {\n    fs.writeFileSync(outputPath, imageBytes);\n  }\n\n  return imageBytes;\n}\n","path":null,"size_bytes":1196,"size_tokens":null},"client/screens/TransactionDetailScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  StyleSheet,\n  Pressable,\n  TextInput,\n  Modal,\n  ActivityIndicator,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation, useRoute, RouteProp } from \"@react-navigation/native\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Icon } from \"@/components/Icon\";\nimport * as Haptics from \"expo-haptics\";\nimport { apiRequest } from \"@/lib/query-client\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport type { Transaction } from \"@shared/schema\";\nimport type { HomeStackParamList } from \"@/navigation/MainTabNavigator\";\n\ntype TransactionDetailRouteProp = RouteProp<HomeStackParamList, \"TransactionDetail\">;\n\nexport default function TransactionDetailScreen() {\n  const insets = useSafeAreaInsets();\n  const navigation = useNavigation();\n  const route = useRoute<TransactionDetailRouteProp>();\n  const queryClient = useQueryClient();\n  const { userId, refreshUser } = useAuth();\n  const { transaction } = route.params;\n\n  const [showEditAmount, setShowEditAmount] = useState(false);\n  const [showEditDescription, setShowEditDescription] = useState(false);\n  const [newAmount, setNewAmount] = useState(transaction.amount);\n  const [newDescription, setNewDescription] = useState(transaction.description);\n\n  const isExpense = transaction.type === \"expense\";\n  const amountValue = Math.abs(parseFloat(transaction.amount));\n  const formattedAmount = `${isExpense ? \"-\" : \"+\"}${amountValue.toFixed(2).replace(\".\", \",\")} \\u20AC`;\n\n  const dateStr = transaction.date \n    ? new Date(transaction.date).toLocaleDateString(\"it-IT\", {\n        weekday: \"long\",\n        day: \"numeric\",\n        month: \"long\",\n        year: \"numeric\",\n      })\n    : \"Ieri\";\n\n  const updateMutation = useMutation({\n    mutationFn: async (updates: { amount?: string; description?: string }) => {\n      const response = await apiRequest(\"PUT\", `/api/transactions/${transaction.id}`, updates);\n      return response.json();\n    },\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({ queryKey: [\"/api/transactions\", userId] });\n      await refreshUser();\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    },\n  });\n\n  const handleSaveAmount = async () => {\n    const cleanAmount = newAmount.replace(\",\", \".\");\n    if (!isNaN(parseFloat(cleanAmount)) && parseFloat(cleanAmount) > 0) {\n      await updateMutation.mutateAsync({ amount: parseFloat(cleanAmount).toFixed(2) });\n      setShowEditAmount(false);\n    }\n  };\n\n  const handleSaveDescription = async () => {\n    if (newDescription.trim()) {\n      await updateMutation.mutateAsync({ description: newDescription.trim() });\n      setShowEditDescription(false);\n    }\n  };\n\n  const getCategoryIcon = () => {\n    switch (transaction.category) {\n      case \"Supermercato\":\n        return \"shopping-cart\";\n      case \"Elettronica\":\n        return \"monitor\";\n      case \"Carburante\":\n        return \"truck\";\n      case \"Ristorazione\":\n        return \"coffee\";\n      case \"Salute\":\n        return \"heart\";\n      case \"Utenze\":\n        return \"zap\";\n      case \"Bonifici\":\n      case \"Stipendio\":\n      case \"Pensione\":\n        return \"arrow-up-right\";\n      case \"Affitti\":\n        return \"home\";\n      case \"Investimenti\":\n        return \"trending-up\";\n      case \"Rimborsi\":\n        return \"rotate-ccw\";\n      default:\n        return isExpense ? \"arrow-down-left\" : \"arrow-up-right\";\n    }\n  };\n\n  return (\n    <View style={[styles.container, { paddingTop: insets.top }]}>\n      <View style={styles.header}>\n        <Pressable style={styles.backButton} onPress={() => navigation.goBack()}>\n          <Icon name=\"chevron-left\" size={24} color={BankColors.primary} />\n          <Text style={styles.backText}>Indietro</Text>\n        </Pressable>\n        <Text style={styles.headerTitle}>Dettaglio operazione</Text>\n        <Pressable style={styles.helpButton}>\n          <Icon name=\"help-circle\" size={24} color={BankColors.primary} />\n          <Text style={styles.helpText}>Aiuto</Text>\n        </Pressable>\n      </View>\n\n      <View style={styles.content}>\n        <View style={styles.iconContainer}>\n          <View style={[styles.iconCircle, isExpense ? styles.expenseIcon : styles.incomeIcon]}>\n            <Icon \n              name={getCategoryIcon()} \n              size={32} \n              color={isExpense ? BankColors.primary : BankColors.success} \n            />\n          </View>\n        </View>\n\n        <Text style={styles.categoryLabel}>\n          {isExpense ? \"ALTRE USCITE\" : \"ENTRATE\"}\n        </Text>\n\n        <Pressable onPress={() => setShowEditAmount(true)}>\n          <Text style={[styles.amount, isExpense && styles.expenseAmount]}>\n            {formattedAmount}\n          </Text>\n        </Pressable>\n\n        <View style={styles.detailsContainer}>\n          <View style={styles.detailRow}>\n            <Pressable style={styles.descriptionRow} onPress={() => setShowEditDescription(true)}>\n              <Text style={styles.description}>{transaction.description}</Text>\n            </Pressable>\n            <Text style={styles.dateText}>{dateStr}</Text>\n          </View>\n          \n          {!transaction.isContabilizzato ? (\n            <Text style={styles.nonContabilizzato}>NON CONTABILIZZATO</Text>\n          ) : null}\n\n          {transaction.accountNumber ? (\n            <Text style={styles.accountNumber}>{transaction.accountNumber}</Text>\n          ) : null}\n        </View>\n\n        <View style={styles.actionsContainer}>\n          <Pressable style={styles.actionButton}>\n            <View style={styles.actionIconCircle}>\n              <Icon name=\"share-2\" size={24} color={BankColors.primary} />\n            </View>\n            <Text style={styles.actionText}>Condividi</Text>\n          </Pressable>\n        </View>\n      </View>\n\n      <Modal visible={showEditAmount} transparent animationType=\"fade\">\n        <View style={styles.modalOverlay}>\n          <Pressable style={styles.modalBackdrop} onPress={() => setShowEditAmount(false)} />\n          <View style={styles.modalContent} onStartShouldSetResponder={() => true}>\n            <Text style={styles.modalTitle}>Modifica Importo</Text>\n            <TextInput\n              style={styles.modalInput}\n              value={newAmount}\n              onChangeText={setNewAmount}\n              keyboardType=\"decimal-pad\"\n              placeholder=\"0.00\"\n              autoFocus\n            />\n            <View style={styles.modalButtons}>\n              <Pressable style={styles.modalCancelBtn} onPress={() => setShowEditAmount(false)}>\n                <Text style={styles.modalCancelText}>Annulla</Text>\n              </Pressable>\n              <Pressable \n                style={styles.modalSaveBtn} \n                onPress={handleSaveAmount}\n                disabled={updateMutation.isPending}\n              >\n                {updateMutation.isPending ? (\n                  <ActivityIndicator color={BankColors.white} size=\"small\" />\n                ) : (\n                  <Text style={styles.modalSaveText}>Salva</Text>\n                )}\n              </Pressable>\n            </View>\n          </View>\n        </View>\n      </Modal>\n\n      <Modal visible={showEditDescription} transparent animationType=\"fade\">\n        <View style={styles.modalOverlay}>\n          <Pressable style={styles.modalBackdrop} onPress={() => setShowEditDescription(false)} />\n          <View style={styles.modalContent} onStartShouldSetResponder={() => true}>\n            <Text style={styles.modalTitle}>Modifica Descrizione</Text>\n            <TextInput\n              style={styles.modalInput}\n              value={newDescription}\n              onChangeText={setNewDescription}\n              placeholder=\"Descrizione\"\n              autoFocus\n            />\n            <View style={styles.modalButtons}>\n              <Pressable style={styles.modalCancelBtn} onPress={() => setShowEditDescription(false)}>\n                <Text style={styles.modalCancelText}>Annulla</Text>\n              </Pressable>\n              <Pressable \n                style={styles.modalSaveBtn} \n                onPress={handleSaveDescription}\n                disabled={updateMutation.isPending}\n              >\n                {updateMutation.isPending ? (\n                  <ActivityIndicator color={BankColors.white} size=\"small\" />\n                ) : (\n                  <Text style={styles.modalSaveText}>Salva</Text>\n                )}\n              </Pressable>\n            </View>\n          </View>\n        </View>\n      </Modal>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n  },\n  header: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n    backgroundColor: BankColors.gray50,\n  },\n  backButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  backText: {\n    color: BankColors.primary,\n    fontSize: 16,\n    marginLeft: 4,\n  },\n  headerTitle: {\n    fontSize: 17,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  helpButton: {\n    alignItems: \"center\",\n  },\n  helpText: {\n    color: BankColors.primary,\n    fontSize: 11,\n    marginTop: 2,\n  },\n  content: {\n    flex: 1,\n    alignItems: \"center\",\n    paddingTop: Spacing[\"3xl\"],\n  },\n  iconContainer: {\n    marginBottom: Spacing.lg,\n  },\n  iconCircle: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  expenseIcon: {\n    backgroundColor: \"#F3E8FF\",\n  },\n  incomeIcon: {\n    backgroundColor: \"#DCFCE7\",\n  },\n  categoryLabel: {\n    fontSize: 12,\n    fontWeight: \"600\",\n    color: BankColors.primary,\n    letterSpacing: 1,\n    marginBottom: Spacing.sm,\n  },\n  amount: {\n    fontSize: 32,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.xl,\n  },\n  expenseAmount: {\n    color: BankColors.gray900,\n  },\n  detailsContainer: {\n    width: \"100%\",\n    paddingHorizontal: Spacing.lg,\n    gap: Spacing.sm,\n  },\n  detailRow: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"flex-start\",\n  },\n  descriptionRow: {\n    flex: 1,\n    marginRight: Spacing.md,\n  },\n  description: {\n    fontSize: 16,\n    color: BankColors.gray900,\n    fontWeight: \"500\",\n  },\n  dateText: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    textTransform: \"capitalize\",\n  },\n  nonContabilizzato: {\n    fontSize: 12,\n    fontWeight: \"600\",\n    color: BankColors.success,\n    alignSelf: \"flex-end\",\n  },\n  accountNumber: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    marginTop: Spacing.sm,\n  },\n  actionsContainer: {\n    position: \"absolute\",\n    bottom: 100,\n    alignItems: \"center\",\n  },\n  actionButton: {\n    alignItems: \"center\",\n  },\n  actionIconCircle: {\n    width: 56,\n    height: 56,\n    borderRadius: 28,\n    backgroundColor: BankColors.gray100,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xs,\n  },\n  actionText: {\n    fontSize: 12,\n    color: BankColors.primary,\n  },\n  modalOverlay: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  modalBackdrop: {\n    ...StyleSheet.absoluteFillObject,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n  },\n  modalContent: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.xl,\n    padding: Spacing.xl,\n    width: \"85%\",\n    maxWidth: 360,\n  },\n  modalTitle: {\n    fontSize: 18,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.lg,\n    textAlign: \"center\",\n  },\n  modalInput: {\n    borderWidth: 1,\n    borderColor: BankColors.gray300,\n    borderRadius: BorderRadius.md,\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.md,\n    fontSize: 16,\n    color: BankColors.gray900,\n    marginBottom: Spacing.lg,\n  },\n  modalButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  modalCancelBtn: {\n    flex: 1,\n    paddingVertical: Spacing.md,\n    borderRadius: BorderRadius.md,\n    backgroundColor: BankColors.gray100,\n    alignItems: \"center\",\n  },\n  modalCancelText: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray600,\n  },\n  modalSaveBtn: {\n    flex: 1,\n    paddingVertical: Spacing.md,\n    borderRadius: BorderRadius.md,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n  },\n  modalSaveText: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.white,\n  },\n});\n","path":null,"size_bytes":12670,"size_tokens":null},"client/components/Spacer.tsx":{"content":"import { View } from \"react-native\";\n\ntype Props = {\n  width?: number;\n  height?: number;\n};\n\nexport default function Spacer(props: Props) {\n  const width: number = props.width ?? 1;\n  const height: number = props.height ?? 1;\n\n  return (\n    <View\n      style={{\n        width,\n        height,\n      }}\n    />\n  );\n}\n","path":null,"size_bytes":318,"size_tokens":null},"client/components/ErrorBoundary.tsx":{"content":"import React, { Component, ComponentType, PropsWithChildren } from \"react\";\nimport { ErrorFallback, ErrorFallbackProps } from \"@/components/ErrorFallback\";\n\nexport type ErrorBoundaryProps = PropsWithChildren<{\n  FallbackComponent?: ComponentType<ErrorFallbackProps>;\n  onError?: (error: Error, stackTrace: string) => void;\n}>;\n\ntype ErrorBoundaryState = { error: Error | null };\n\n/**\n * This is a special case for for using the class components. Error boundaries must be class components because React only provides error boundary functionality through lifecycle methods (componentDidCatch and getDerivedStateFromError) which are not available in functional components.\n * https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary\n */\n\nexport class ErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  state: ErrorBoundaryState = { error: null };\n\n  static defaultProps: {\n    FallbackComponent: ComponentType<ErrorFallbackProps>;\n  } = {\n    FallbackComponent: ErrorFallback,\n  };\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { error };\n  }\n\n  componentDidCatch(error: Error, info: { componentStack: string }): void {\n    if (typeof this.props.onError === \"function\") {\n      this.props.onError(error, info.componentStack);\n    }\n  }\n\n  resetError = (): void => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    const { FallbackComponent } = this.props;\n\n    return this.state.error && FallbackComponent ? (\n      <FallbackComponent\n        error={this.state.error}\n        resetError={this.resetError}\n      />\n    ) : (\n      this.props.children\n    );\n  }\n}\n","path":null,"size_bytes":1674,"size_tokens":null},"client/components/KeyboardAwareScrollViewCompat.tsx":{"content":"import { Platform, ScrollView, ScrollViewProps } from \"react-native\";\nimport {\n  KeyboardAwareScrollView,\n  KeyboardAwareScrollViewProps,\n} from \"react-native-keyboard-controller\";\n\ntype Props = KeyboardAwareScrollViewProps & ScrollViewProps;\n\n/**\n * KeyboardAwareScrollView that falls back to ScrollView on web.\n * Use this for any screen containing text inputs.\n */\nexport function KeyboardAwareScrollViewCompat({\n  children,\n  keyboardShouldPersistTaps = \"handled\",\n  ...props\n}: Props) {\n  if (Platform.OS === \"web\") {\n    return (\n      <ScrollView\n        keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n        {...props}\n      >\n        {children}\n      </ScrollView>\n    );\n  }\n\n  return (\n    <KeyboardAwareScrollView\n      keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n      {...props}\n    >\n      {children}\n    </KeyboardAwareScrollView>\n  );\n}\n","path":null,"size_bytes":872,"size_tokens":null},"client/components/Icon.tsx":{"content":"import React from \"react\";\nimport Svg, { Path, Circle, Rect, Line, Polyline, Polygon } from \"react-native-svg\";\n\ninterface IconProps {\n  name: string;\n  size?: number;\n  color?: string;\n}\n\nexport function Icon({ name, size = 24, color = \"#000\" }: IconProps) {\n  switch (name) {\n    case \"home\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\" />\n          <Polyline points=\"9 22 9 12 15 12 15 22\" />\n        </Svg>\n      );\n    case \"grid\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" />\n          <Rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" />\n          <Rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" />\n          <Rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" />\n        </Svg>\n      );\n    case \"credit-card\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Rect x=\"1\" y=\"4\" width=\"22\" height=\"16\" rx=\"2\" ry=\"2\" />\n          <Line x1=\"1\" y1=\"10\" x2=\"23\" y2=\"10\" />\n        </Svg>\n      );\n    case \"more-horizontal\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"12\" cy=\"12\" r=\"1\" />\n          <Circle cx=\"19\" cy=\"12\" r=\"1\" />\n          <Circle cx=\"5\" cy=\"12\" r=\"1\" />\n        </Svg>\n      );\n    case \"search\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"11\" cy=\"11\" r=\"8\" />\n          <Line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\" />\n        </Svg>\n      );\n    case \"help-circle\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"12\" cy=\"12\" r=\"10\" />\n          <Path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\" />\n          <Line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\n        </Svg>\n      );\n    case \"eye\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\" />\n          <Circle cx=\"12\" cy=\"12\" r=\"3\" />\n        </Svg>\n      );\n    case \"eye-off\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24\" />\n          <Line x1=\"1\" y1=\"1\" x2=\"23\" y2=\"23\" />\n        </Svg>\n      );\n    case \"chevron-right\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Polyline points=\"9 18 15 12 9 6\" />\n        </Svg>\n      );\n    case \"arrow-left\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\" />\n          <Polyline points=\"12 19 5 12 12 5\" />\n        </Svg>\n      );\n    case \"delete\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z\" />\n          <Line x1=\"18\" y1=\"9\" x2=\"12\" y2=\"15\" />\n          <Line x1=\"12\" y1=\"9\" x2=\"18\" y2=\"15\" />\n        </Svg>\n      );\n    case \"log-out\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\" />\n          <Polyline points=\"16 17 21 12 16 7\" />\n          <Line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\" />\n        </Svg>\n      );\n    case \"settings\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"12\" cy=\"12\" r=\"3\" />\n          <Path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\" />\n        </Svg>\n      );\n    case \"user\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\" />\n          <Circle cx=\"12\" cy=\"7\" r=\"4\" />\n        </Svg>\n      );\n    case \"bell\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\" />\n          <Path d=\"M13.73 21a2 2 0 0 1-3.46 0\" />\n        </Svg>\n      );\n    case \"info\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"12\" cy=\"12\" r=\"10\" />\n          <Line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\" />\n          <Line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\" />\n        </Svg>\n      );\n    case \"shield\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\" />\n        </Svg>\n      );\n    case \"file-text\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" />\n          <Polyline points=\"14 2 14 8 20 8\" />\n          <Line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\" />\n          <Line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\" />\n          <Polyline points=\"10 9 9 9 8 9\" />\n        </Svg>\n      );\n    case \"message-circle\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z\" />\n        </Svg>\n      );\n    case \"shopping-cart\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"9\" cy=\"21\" r=\"1\" />\n          <Circle cx=\"20\" cy=\"21\" r=\"1\" />\n          <Path d=\"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6\" />\n        </Svg>\n      );\n    case \"truck\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Rect x=\"1\" y=\"3\" width=\"15\" height=\"13\" />\n          <Polygon points=\"16 8 20 8 23 11 23 16 16 16 16 8\" />\n          <Circle cx=\"5.5\" cy=\"18.5\" r=\"2.5\" />\n          <Circle cx=\"18.5\" cy=\"18.5\" r=\"2.5\" />\n        </Svg>\n      );\n    case \"gift\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Polyline points=\"20 12 20 22 4 22 4 12\" />\n          <Rect x=\"2\" y=\"7\" width=\"20\" height=\"5\" />\n          <Line x1=\"12\" y1=\"22\" x2=\"12\" y2=\"7\" />\n          <Path d=\"M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z\" />\n          <Path d=\"M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z\" />\n        </Svg>\n      );\n    case \"coffee\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M18 8h1a4 4 0 0 1 0 8h-1\" />\n          <Path d=\"M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z\" />\n          <Line x1=\"6\" y1=\"1\" x2=\"6\" y2=\"4\" />\n          <Line x1=\"10\" y1=\"1\" x2=\"10\" y2=\"4\" />\n          <Line x1=\"14\" y1=\"1\" x2=\"14\" y2=\"4\" />\n        </Svg>\n      );\n    case \"dollar-sign\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"23\" />\n          <Path d=\"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\" />\n        </Svg>\n      );\n    case \"send\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\" />\n          <Polygon points=\"22 2 15 22 11 13 2 9 22 2\" />\n        </Svg>\n      );\n    case \"download\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\n          <Polyline points=\"7 10 12 15 17 10\" />\n          <Line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" />\n        </Svg>\n      );\n    case \"smartphone\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Rect x=\"5\" y=\"2\" width=\"14\" height=\"20\" rx=\"2\" ry=\"2\" />\n          <Line x1=\"12\" y1=\"18\" x2=\"12.01\" y2=\"18\" />\n        </Svg>\n      );\n    case \"wifi\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M5 12.55a11 11 0 0 1 14.08 0\" />\n          <Path d=\"M1.42 9a16 16 0 0 1 21.16 0\" />\n          <Path d=\"M8.53 16.11a6 6 0 0 1 6.95 0\" />\n          <Line x1=\"12\" y1=\"20\" x2=\"12.01\" y2=\"20\" />\n        </Svg>\n      );\n    case \"menu\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\" />\n          <Line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\" />\n          <Line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\" />\n        </Svg>\n      );\n    case \"arrow-down-left\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"17\" y1=\"7\" x2=\"7\" y2=\"17\" />\n          <Polyline points=\"17 17 7 17 7 7\" />\n        </Svg>\n      );\n    case \"arrow-up-right\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"7\" y1=\"17\" x2=\"17\" y2=\"7\" />\n          <Polyline points=\"7 7 17 7 17 17\" />\n        </Svg>\n      );\n    case \"chevron-left\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Polyline points=\"15 18 9 12 15 6\" />\n        </Svg>\n      );\n    case \"arrow-down\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" />\n          <Polyline points=\"19 12 12 19 5 12\" />\n        </Svg>\n      );\n    case \"arrow-up\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"5\" />\n          <Polyline points=\"5 12 12 5 19 12\" />\n        </Svg>\n      );\n    case \"cpu\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" ry=\"2\" />\n          <Rect x=\"9\" y=\"9\" width=\"6\" height=\"6\" />\n          <Line x1=\"9\" y1=\"1\" x2=\"9\" y2=\"4\" />\n          <Line x1=\"15\" y1=\"1\" x2=\"15\" y2=\"4\" />\n          <Line x1=\"9\" y1=\"20\" x2=\"9\" y2=\"23\" />\n          <Line x1=\"15\" y1=\"20\" x2=\"15\" y2=\"23\" />\n          <Line x1=\"20\" y1=\"9\" x2=\"23\" y2=\"9\" />\n          <Line x1=\"20\" y1=\"14\" x2=\"23\" y2=\"14\" />\n          <Line x1=\"1\" y1=\"9\" x2=\"4\" y2=\"9\" />\n          <Line x1=\"1\" y1=\"14\" x2=\"4\" y2=\"14\" />\n        </Svg>\n      );\n    case \"map-pin\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\" />\n          <Circle cx=\"12\" cy=\"10\" r=\"3\" />\n        </Svg>\n      );\n    case \"more-vertical\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"12\" cy=\"12\" r=\"1\" />\n          <Circle cx=\"12\" cy=\"5\" r=\"1\" />\n          <Circle cx=\"12\" cy=\"19\" r=\"1\" />\n        </Svg>\n      );\n    case \"share-2\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"18\" cy=\"5\" r=\"3\" />\n          <Circle cx=\"6\" cy=\"12\" r=\"3\" />\n          <Circle cx=\"18\" cy=\"19\" r=\"3\" />\n          <Line x1=\"8.59\" y1=\"13.51\" x2=\"15.42\" y2=\"17.49\" />\n          <Line x1=\"15.41\" y1=\"6.51\" x2=\"8.59\" y2=\"10.49\" />\n        </Svg>\n      );\n    case \"trending-up\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Polyline points=\"23 6 13.5 15.5 8.5 10.5 1 18\" />\n          <Polyline points=\"17 6 23 6 23 12\" />\n        </Svg>\n      );\n    case \"rotate-ccw\":\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Polyline points=\"1 4 1 10 7 10\" />\n          <Path d=\"M3.51 15a9 9 0 1 0 2.13-9.36L1 10\" />\n        </Svg>\n      );\n    default:\n      return (\n        <Svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\">\n          <Circle cx=\"12\" cy=\"12\" r=\"10\" />\n          <Line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\" />\n          <Line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\" />\n        </Svg>\n      );\n  }\n}\n","path":null,"size_bytes":15866,"size_tokens":null},"client/screens/NewsScreen.tsx":{"content":"import React, { useCallback } from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  StyleSheet,\n  RefreshControl,\n  ActivityIndicator,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport * as Haptics from \"expo-haptics\";\nimport { Icon } from \"@/components/Icon\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { getApiUrl } from \"@/lib/query-client\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface NewsArticle {\n  id: string;\n  title: string;\n  summary: string;\n  category: string;\n  relevanceScore: number;\n  source: string;\n  publishedAt: string;\n  icon: string;\n}\n\ninterface NewsResponse {\n  news: NewsArticle[];\n  generatedAt: string;\n  personalized: boolean;\n}\n\nconst CATEGORY_COLORS: Record<string, string> = {\n  Mercati: \"#10B981\",\n  Economia: \"#3B82F6\",\n  Risparmio: \"#F59E0B\",\n  Banche: \"#6366F1\",\n  Crypto: \"#8B5CF6\",\n  Immobiliare: \"#EC4899\",\n  Lavoro: \"#14B8A6\",\n  Fisco: \"#EF4444\",\n};\n\nfunction formatTimeAgo(dateStr: string): string {\n  const date = new Date(dateStr);\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffMins = Math.floor(diffMs / (1000 * 60));\n  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n  \n  if (diffMins < 60) {\n    return `${diffMins} min fa`;\n  } else if (diffHours < 24) {\n    return `${diffHours} ore fa`;\n  } else {\n    return date.toLocaleDateString(\"it-IT\", { day: \"numeric\", month: \"short\" });\n  }\n}\n\nfunction NewsCard({ article }: { article: NewsArticle }) {\n  const categoryColor = CATEGORY_COLORS[article.category] || BankColors.primary;\n\n  return (\n    <Pressable\n      style={({ pressed }) => [styles.newsCard, pressed && styles.newsCardPressed]}\n      onPress={() => Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)}\n    >\n      <View style={styles.newsHeader}>\n        <View style={[styles.categoryBadge, { backgroundColor: categoryColor + \"20\" }]}>\n          <Icon name={article.icon} size={14} color={categoryColor} />\n          <Text style={[styles.categoryText, { color: categoryColor }]}>{article.category}</Text>\n        </View>\n        <Text style={styles.timeAgo}>{formatTimeAgo(article.publishedAt)}</Text>\n      </View>\n      \n      <Text style={styles.newsTitle}>{article.title}</Text>\n      <Text style={styles.newsSummary}>{article.summary}</Text>\n      \n      <View style={styles.newsFooter}>\n        <Text style={styles.newsSource}>{article.source}</Text>\n        <View style={styles.relevanceContainer}>\n          <Icon name=\"target\" size={12} color={BankColors.gray400} />\n          <Text style={styles.relevanceText}>{article.relevanceScore}% rilevante</Text>\n        </View>\n      </View>\n    </Pressable>\n  );\n}\n\nexport default function NewsScreen() {\n  const insets = useSafeAreaInsets();\n  const headerHeight = useHeaderHeight();\n  const queryClient = useQueryClient();\n  const { userId, user } = useAuth();\n\n  const { data, isLoading, isRefetching, refetch } = useQuery<NewsResponse>({\n    queryKey: [\"/api/news\", userId],\n    queryFn: async () => {\n      const balance = user?.balance ? parseFloat(user.balance) : 1000;\n      const url = `${getApiUrl()}/api/news?userId=${userId || \"\"}&balance=${balance}`;\n      const response = await fetch(url);\n      return response.json();\n    },\n    enabled: true,\n    staleTime: 5 * 60 * 1000,\n    refetchOnWindowFocus: false,\n  });\n\n  const handleRefresh = useCallback(async () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    await refetch();\n  }, [refetch]);\n\n  const news = data?.news || [];\n\n  return (\n    <View style={styles.container}>\n      <ScrollView\n        style={styles.scrollView}\n        contentContainerStyle={[\n          styles.scrollContent,\n          { paddingTop: headerHeight + Spacing.md, paddingBottom: insets.bottom + Spacing.xl },\n        ]}\n        refreshControl={\n          <RefreshControl\n            refreshing={isRefetching}\n            onRefresh={handleRefresh}\n            tintColor={BankColors.primary}\n          />\n        }\n      >\n        {data?.personalized ? (\n          <View style={styles.personalizedBanner}>\n            <Icon name=\"sparkles\" size={16} color={BankColors.primary} />\n            <Text style={styles.personalizedText}>\n              Notizie personalizzate in base alle tue abitudini finanziarie\n            </Text>\n          </View>\n        ) : null}\n\n        {isLoading ? (\n          <View style={styles.loadingContainer}>\n            <ActivityIndicator size=\"large\" color={BankColors.primary} />\n            <Text style={styles.loadingText}>Caricamento notizie personalizzate...</Text>\n          </View>\n        ) : news.length === 0 ? (\n          <View style={styles.emptyContainer}>\n            <Icon name=\"inbox\" size={48} color={BankColors.gray400} />\n            <Text style={styles.emptyText}>Nessuna notizia disponibile</Text>\n            <Pressable style={styles.refreshButton} onPress={handleRefresh}>\n              <Text style={styles.refreshButtonText}>Riprova</Text>\n            </Pressable>\n          </View>\n        ) : (\n          news.map((article) => <NewsCard key={article.id} article={article} />)\n        )}\n\n        {data?.generatedAt ? (\n          <Text style={styles.generatedAt}>\n            Aggiornato: {new Date(data.generatedAt).toLocaleTimeString(\"it-IT\", { hour: \"2-digit\", minute: \"2-digit\" })}\n          </Text>\n        ) : null}\n      </ScrollView>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.gray100,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  scrollContent: {\n    paddingHorizontal: Spacing.lg,\n  },\n  personalizedBanner: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.primaryLight,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    marginBottom: Spacing.lg,\n    gap: Spacing.sm,\n  },\n  personalizedText: {\n    flex: 1,\n    fontSize: 13,\n    color: BankColors.primary,\n    fontWeight: \"500\",\n  },\n  loadingContainer: {\n    alignItems: \"center\",\n    paddingVertical: Spacing.xl * 2,\n  },\n  loadingText: {\n    marginTop: Spacing.md,\n    fontSize: 14,\n    color: BankColors.gray500,\n  },\n  emptyContainer: {\n    alignItems: \"center\",\n    paddingVertical: Spacing.xl * 2,\n  },\n  emptyText: {\n    marginTop: Spacing.md,\n    fontSize: 16,\n    color: BankColors.gray500,\n  },\n  refreshButton: {\n    marginTop: Spacing.lg,\n    paddingHorizontal: Spacing.xl,\n    paddingVertical: Spacing.md,\n    backgroundColor: BankColors.primary,\n    borderRadius: BorderRadius.md,\n  },\n  refreshButtonText: {\n    color: BankColors.white,\n    fontSize: 14,\n    fontWeight: \"600\",\n  },\n  newsCard: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.lg,\n    marginBottom: Spacing.md,\n    borderWidth: 1,\n    borderColor: BankColors.gray200,\n  },\n  newsCardPressed: {\n    backgroundColor: BankColors.gray50,\n  },\n  newsHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.sm,\n  },\n  categoryBadge: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.sm,\n    paddingVertical: 4,\n    borderRadius: BorderRadius.full,\n    gap: 4,\n  },\n  categoryText: {\n    fontSize: 12,\n    fontWeight: \"600\",\n  },\n  timeAgo: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  newsTitle: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n    lineHeight: 22,\n    marginBottom: Spacing.sm,\n  },\n  newsSummary: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    lineHeight: 20,\n    marginBottom: Spacing.md,\n  },\n  newsFooter: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n  },\n  newsSource: {\n    fontSize: 12,\n    color: BankColors.gray500,\n    fontStyle: \"italic\",\n  },\n  relevanceContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 4,\n  },\n  relevanceText: {\n    fontSize: 11,\n    color: BankColors.gray400,\n  },\n  generatedAt: {\n    textAlign: \"center\",\n    fontSize: 12,\n    color: BankColors.gray400,\n    marginTop: Spacing.lg,\n  },\n});\n","path":null,"size_bytes":8284,"size_tokens":null},"client/screens/AltroScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  StyleSheet,\n  Modal,\n  TextInput,\n  ActivityIndicator,\n  Alert,\n  Linking,\n  Platform,\n  TouchableOpacity,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport * as Haptics from \"expo-haptics\";\nimport { Icon } from \"@/components/Icon\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { apiRequest, getApiUrl } from \"@/lib/query-client\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\nimport { DEFAULT_PRESETS, TRANSACTION_CATEGORIES, type PresetTransaction } from \"@shared/presets\";\n\ntype NavigationProp = NativeStackNavigationProp<RootStackParamList>;\n\ninterface DbCustomPreset {\n  id: number;\n  userId: string;\n  description: string;\n  type: string;\n  category: string;\n  minAmount: number;\n  maxAmount: number;\n  isEnabled: boolean;\n  createdAt: string;\n}\n\ninterface MenuItemProps {\n  icon: string;\n  title: string;\n  badge?: number;\n  onPress?: () => void;\n}\n\nconst MenuItem = ({ icon, title, badge, onPress }: MenuItemProps) => (\n  <Pressable \n    style={({ pressed }) => [styles.menuItem, pressed && styles.menuItemPressed]}\n    onPress={onPress}\n  >\n    <View style={styles.menuItemLeft}>\n      <Icon name={icon} size={22} color={BankColors.gray700} />\n      <Text style={styles.menuItemText}>{title}</Text>\n    </View>\n    <View style={styles.menuItemRight}>\n      {badge ? (\n        <View style={styles.badge}>\n          <Text style={styles.badgeText}>{badge}</Text>\n        </View>\n      ) : null}\n      <Icon name=\"chevron-right\" size={20} color={BankColors.gray400} />\n    </View>\n  </Pressable>\n);\n\ninterface TopActionProps {\n  icon: string;\n  label: string;\n  badge?: number;\n}\n\nconst TopAction = ({ icon, label, badge }: TopActionProps) => (\n  <Pressable style={styles.topAction}>\n    <View style={styles.topActionIconContainer}>\n      <Icon name={icon} size={24} color={BankColors.gray700} />\n      {badge ? (\n        <View style={styles.topActionBadge}>\n          <Text style={styles.topActionBadgeText}>{badge}</Text>\n        </View>\n      ) : null}\n    </View>\n    <Text style={styles.topActionLabel}>{label}</Text>\n  </Pressable>\n);\n\nexport default function AltroScreen() {\n  const insets = useSafeAreaInsets();\n  const tabBarHeight = useBottomTabBarHeight();\n  const navigation = useNavigation<NavigationProp>();\n  const queryClient = useQueryClient();\n  const { user, userId, logout, updateName, refreshUser } = useAuth();\n  const [showEditName, setShowEditName] = useState(false);\n  const [newName, setNewName] = useState(\"\");\n  const [showConsole, setShowConsole] = useState(false);\n  const [consoleTab, setConsoleTab] = useState<\"form\" | \"preset\">(\"form\");\n  const [txDescription, setTxDescription] = useState(\"\");\n  const [txAmount, setTxAmount] = useState(\"\");\n  const [txType, setTxType] = useState<\"expense\" | \"income\">(\"income\");\n  const [txCategory, setTxCategory] = useState(TRANSACTION_CATEGORIES[0]);\n  const [showPresetEditor, setShowPresetEditor] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [editingPreset, setEditingPreset] = useState<DbCustomPreset | null>(null);\n  const [presetDesc, setPresetDesc] = useState(\"\");\n  const [presetMinAmount, setPresetMinAmount] = useState(\"\");\n  const [presetMaxAmount, setPresetMaxAmount] = useState(\"\");\n  const [presetType, setPresetType] = useState<\"expense\" | \"income\">(\"expense\");\n  const [presetCategory, setPresetCategory] = useState(TRANSACTION_CATEGORIES[0]);\n\n  // Fetch custom presets from database\n  const { data: customPresets = [], refetch: refetchPresets } = useQuery<DbCustomPreset[]>({\n    queryKey: [`/api/users/${userId}/custom-presets`],\n    enabled: !!userId,\n  });\n\n  // Create preset mutation\n  const createPresetMutation = useMutation({\n    mutationFn: async (data: { description: string; type: string; category: string; minAmount: number; maxAmount: number }) => {\n      const response = await apiRequest(\"POST\", `/api/users/${userId}/custom-presets`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchPresets();\n      setShowPresetEditor(false);\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    },\n  });\n\n  // Update preset mutation\n  const updatePresetMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<DbCustomPreset> }) => {\n      const response = await apiRequest(\"PUT\", `/api/users/${userId}/custom-presets/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchPresets();\n      setShowPresetEditor(false);\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    },\n  });\n\n  // Delete preset mutation\n  const deletePresetMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/users/${userId}/custom-presets/${id}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchPresets();\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    },\n  });\n\n  // Trigger preset transaction mutation\n  const triggerPresetMutation = useMutation({\n    mutationFn: async (presetId: number) => {\n      const response = await apiRequest(\"POST\", `/api/users/${userId}/custom-presets/${presetId}/trigger`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [`/api/transactions/${userId}`] });\n      refreshUser();\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      if (data.transaction) {\n        const amount = Math.abs(parseFloat(data.transaction.amount));\n        Alert.alert(\n          \"Transazione creata\",\n          `${data.transaction.description}: -${amount.toFixed(0)} EUR`\n        );\n      }\n    },\n    onError: (error: any) => {\n      Alert.alert(\"Errore\", error.message || \"Impossibile eseguire la transazione\");\n    },\n  });\n\n  // Convert database presets to local format for display\n  const allPresets: (PresetTransaction & { dbId?: number })[] = [\n    ...DEFAULT_PRESETS,\n    ...customPresets.map(p => ({\n      description: p.description,\n      type: p.type as \"expense\" | \"income\",\n      category: p.category,\n      minAmount: p.minAmount,\n      maxAmount: p.maxAmount,\n      isCustom: true,\n      dbId: p.id,\n    }))\n  ];\n\n  const confirmDeletePreset = (preset: PresetTransaction & { dbId?: number }) => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    \n    if (preset.isCustom && preset.dbId) {\n      Alert.alert(\n        \"Gestisci Preset\",\n        `Cosa vuoi fare con \"${preset.description}\"?`,\n        [\n          { text: \"Annulla\", style: \"cancel\" },\n          { text: \"Modifica\", onPress: () => openEditPresetById(preset.dbId!) },\n          { text: \"Elimina\", style: \"destructive\", onPress: () => deletePresetMutation.mutate(preset.dbId!) },\n        ]\n      );\n    }\n  };\n\n  const openCreatePreset = () => {\n    setEditingPreset(null);\n    setPresetDesc(\"\");\n    setPresetMinAmount(\"\");\n    setPresetMaxAmount(\"\");\n    setPresetType(\"expense\");\n    setPresetCategory(TRANSACTION_CATEGORIES[0]);\n    setShowPresetEditor(true);\n  };\n\n  const openEditPresetById = (id: number) => {\n    const preset = customPresets.find(p => p.id === id);\n    if (preset) {\n      setEditingPreset(preset);\n      setPresetDesc(preset.description);\n      setPresetMinAmount(preset.minAmount.toString());\n      setPresetMaxAmount(preset.maxAmount.toString());\n      setPresetType(preset.type as \"expense\" | \"income\");\n      setPresetCategory(preset.category);\n      setShowPresetEditor(true);\n    }\n  };\n\n  const savePreset = async () => {\n    if (!presetDesc.trim() || !presetMinAmount.trim() || !presetMaxAmount.trim()) return;\n    const min = parseInt(presetMinAmount);\n    const max = parseInt(presetMaxAmount);\n    if (isNaN(min) || isNaN(max) || min <= 0 || max < min) return;\n\n    const presetData = {\n      description: presetDesc.trim(),\n      type: presetType,\n      category: presetCategory,\n      minAmount: min,\n      maxAmount: max,\n    };\n\n    if (editingPreset) {\n      updatePresetMutation.mutate({ id: editingPreset.id, data: presetData });\n    } else {\n      createPresetMutation.mutate(presetData);\n    }\n  };\n\n  const createTransactionMutation = useMutation({\n    mutationFn: async (data: { description: string; amount: string; type: string; category: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/transactions\", {\n        userId,\n        description: data.description,\n        amount: data.amount,\n        type: data.type,\n        category: data.category,\n        isContabilizzato: true,\n        date: new Date().toISOString(),\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\", userId] });\n      refreshUser();\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      if (data.wasCapped) {\n        Alert.alert(\"Saldo riportato al massimo\", data.cappedMessage || \"L'importo e stato limitato per raggiungere il saldo massimo pagato.\");\n      }\n    },\n  });\n\n  const generateRandomMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/transactions/${userId}/generate-random`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\", userId] });\n      refreshUser();\n      if (data.transaction) {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n        if (data.wasCapped) {\n          Alert.alert(\"Saldo riportato al massimo\", data.cappedMessage || \"L'importo e stato limitato per raggiungere il saldo massimo pagato.\");\n        }\n      } else if (data.message) {\n        Alert.alert(\"Info\", data.message);\n      }\n    },\n  });\n\n  const handleAddTransaction = async () => {\n    if (!txDescription.trim() || !txAmount.trim()) return;\n    const amount = Math.floor(parseFloat(txAmount.replace(\",\", \".\")));\n    if (isNaN(amount) || amount <= 0) return;\n    \n    // Manual form is always income (certification of entries)\n    try {\n      await createTransactionMutation.mutateAsync({\n        description: txDescription.trim(),\n        amount: amount.toFixed(0) + \".00\",\n        type: \"income\",\n        category: txCategory,\n      });\n      setTxDescription(\"\");\n      setTxAmount(\"\");\n    } catch (error: any) {\n      // Error is already handled by mutation onSuccess for 403\n    }\n  };\n\n  const handlePresetTransaction = async (preset: PresetTransaction) => {\n    const amount = Math.floor(Math.random() * (preset.maxAmount - preset.minAmount) + preset.minAmount);\n    \n    try {\n      await createTransactionMutation.mutateAsync({\n        description: preset.description,\n        amount: amount.toFixed(0) + \".00\",\n        type: preset.type,\n        category: preset.category,\n      });\n    } catch (error: any) {\n      if (error?.message?.includes(\"Saldo gia al massimo\")) {\n        Alert.alert(\"Saldo al massimo\", \"Il saldo e gia al massimo pagato. Non puoi aggiungere altre entrate simulate.\");\n      }\n    }\n  };\n\n  const handleEditName = () => {\n    setNewName(user?.fullName || \"\");\n    setShowEditName(true);\n  };\n\n  const handleSaveName = async () => {\n    if (newName.trim()) {\n      await updateName(newName.trim());\n      setShowEditName(false);\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n  };\n\n  const handleLogout = async () => {\n    await logout();\n    navigation.reset({\n      index: 0,\n      routes: [{ name: \"Welcome\" }],\n    });\n  };\n\n  const getInitials = (name: string) => {\n    const parts = name.split(\" \");\n    if (parts.length >= 2) {\n      return parts[0][0] + parts[parts.length - 1][0];\n    }\n    return name.substring(0, 2).toUpperCase();\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={[styles.header, { paddingTop: insets.top + Spacing.lg }]}>\n        <Text style={styles.pageTitle}>Altro</Text>\n      </View>\n\n      <ScrollView\n        style={styles.scrollView}\n        contentContainerStyle={{ paddingBottom: tabBarHeight + Spacing.xl }}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <View style={styles.topActions}>\n          <TopAction icon=\"bell\" label=\"Avvisi\" badge={5} />\n          <View style={styles.topActionDivider} />\n          <TopAction icon=\"archive\" label=\"Archivio\" badge={3} />\n          <View style={styles.topActionDivider} />\n          <TopAction icon=\"shopping-cart\" label=\"Carrello\" />\n        </View>\n\n        <Pressable style={styles.profileCard} onPress={handleEditName}>\n          <View style={styles.profileAvatar}>\n            <Text style={styles.profileInitials}>\n              {user?.fullName ? getInitials(user.fullName) : \"MR\"}\n            </Text>\n          </View>\n          <View style={styles.profileInfo}>\n            <Text style={styles.profileLabel}>Il mio profilo</Text>\n            <Text style={styles.profileName}>{user?.fullName || \"MICHELE RINELLI\"}</Text>\n            <Text style={styles.profileBank}>EquisCash</Text>\n            {user?.rechargeUsername ? (\n              <Text style={styles.profileRechargeUsername}>Username ricarica: @{user.rechargeUsername}</Text>\n            ) : null}\n          </View>\n          <Icon name=\"chevron-right\" size={24} color={BankColors.gray400} />\n        </Pressable>\n\n        <View style={styles.menuSection}>\n          <MenuItem icon=\"settings\" title=\"Impostazioni e privacy\" onPress={() => setShowSettings(true)} />\n          <MenuItem icon=\"shield\" title=\"Sicurezza\" />\n          <MenuItem icon=\"message-circle\" title=\"Parla con noi\" onPress={() => Linking.openURL(\"https://wa.me/393293293177\")} />\n        </View>\n\n        <View style={styles.menuSection}>\n          <MenuItem icon=\"volume-2\" title=\"Ti suggeriamo di...\" badge={1} />\n          <MenuItem icon=\"percent\" title=\"Finanziamenti\" />\n          <MenuItem icon=\"umbrella\" title=\"Assicurazioni e Previdenza\" />\n          <MenuItem icon=\"book\" title=\"Catalogo prodotti\" />\n        </View>\n\n        <View style={styles.menuSection}>\n          <MenuItem icon=\"file-text\" title=\"Documenti\" />\n          <MenuItem icon=\"info\" title=\"Informazioni\" onPress={() => setShowConsole(true)} />\n          <MenuItem icon=\"help-circle\" title=\"FAQ e Tutorial\" />\n        </View>\n\n        <Pressable \n          style={styles.logoutButton}\n          onPress={handleLogout}\n        >\n          <Icon name=\"log-out\" size={20} color={BankColors.error} />\n          <Text style={styles.logoutText}>Esci</Text>\n        </Pressable>\n      </ScrollView>\n\n      <Modal visible={showEditName} transparent animationType=\"fade\">\n        <View style={styles.modalOverlay}>\n          <Pressable style={styles.modalBackdrop} onPress={() => setShowEditName(false)} />\n          <View style={styles.modalContent} onStartShouldSetResponder={() => true}>\n            <Text style={styles.modalTitle}>Modifica Nome</Text>\n            <TextInput\n              style={styles.modalInput}\n              value={newName}\n              onChangeText={setNewName}\n              placeholder=\"Nome Cognome\"\n              autoCapitalize=\"words\"\n              autoFocus\n            />\n            <View style={styles.modalButtons}>\n              <Pressable style={styles.modalCancelBtn} onPress={() => setShowEditName(false)}>\n                <Text style={styles.modalCancelText}>Annulla</Text>\n              </Pressable>\n              <Pressable style={styles.modalSaveBtn} onPress={handleSaveName}>\n                <Text style={styles.modalSaveText}>Salva</Text>\n              </Pressable>\n            </View>\n          </View>\n        </View>\n      </Modal>\n\n      <Modal visible={showConsole} transparent animationType=\"slide\">\n        <View style={styles.consoleOverlay}>\n          <View style={[styles.consoleContainer, { paddingTop: insets.top }]}>\n            <View style={styles.consoleHeader}>\n              <Text style={styles.consoleTitle}>Console Transazioni</Text>\n              <Pressable style={styles.consoleCloseBtn} onPress={() => setShowConsole(false)}>\n                <Icon name=\"x\" size={24} color={BankColors.gray700} />\n              </Pressable>\n            </View>\n\n            <View style={styles.certificationHeader}>\n              <View style={styles.certRow}>\n                <Icon name=\"shield\" size={18} color={BankColors.primary} />\n                <Text style={styles.certLabel}>Saldo Certificato:</Text>\n                <Text style={styles.certValue}>\n                  {parseFloat(user?.purchasedBalance || \"0\").toLocaleString('it-IT', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}\n                </Text>\n              </View>\n              <View style={styles.certRow}>\n                <Icon name=\"trending-up\" size={18} color={BankColors.cardBlue} />\n                <Text style={styles.certLabel}>Margine di recupero:</Text>\n                <Text style={[styles.certValue, styles.certValueRecovery]}>\n                  {(() => {\n                    const currentBalance = parseFloat(user?.balance || \"0\");\n                    const purchasedBalance = parseFloat(user?.purchasedBalance || \"0\");\n                    const recovery = Math.max(0, Math.floor(purchasedBalance - currentBalance));\n                    return `€${recovery.toLocaleString('it-IT')}`;\n                  })()}\n                </Text>\n              </View>\n            </View>\n\n            <View style={styles.consoleTabs}>\n              <Pressable \n                style={[styles.consoleTab, consoleTab === \"form\" && styles.consoleTabActive]}\n                onPress={() => setConsoleTab(\"form\")}\n              >\n                <Text style={[styles.consoleTabText, consoleTab === \"form\" && styles.consoleTabTextActive]}>\n                  Certifica Entrata\n                </Text>\n              </Pressable>\n              <Pressable \n                style={[styles.consoleTab, consoleTab === \"preset\" && styles.consoleTabActive]}\n                onPress={() => setConsoleTab(\"preset\")}\n              >\n                <Text style={[styles.consoleTabText, consoleTab === \"preset\" && styles.consoleTabTextActive]}>\n                  Uscite Random\n                </Text>\n              </Pressable>\n            </View>\n\n            <ScrollView style={styles.consoleBody} contentContainerStyle={{ paddingBottom: insets.bottom + Spacing.xl }}>\n              {consoleTab === \"form\" ? (\n                <View style={styles.consoleForm}>\n                  <Text style={styles.incomeFormHint}>\n                    Inserisci un'entrata per recuperare il saldo fino al massimo certificato.\n                  </Text>\n                  \n                  <Text style={styles.formLabel}>Descrizione Entrata</Text>\n                  <TextInput\n                    style={styles.formInput}\n                    value={txDescription}\n                    onChangeText={setTxDescription}\n                    placeholder=\"Es: Bonifico Affitto, Crypto, Stipendio\"\n                    placeholderTextColor={BankColors.gray400}\n                  />\n\n                  <Text style={styles.formLabel}>Importo (EUR) - Max: {(() => {\n                    const currentBalance = parseFloat(user?.balance || \"0\");\n                    const purchasedBalance = parseFloat(user?.purchasedBalance || \"0\");\n                    const recovery = Math.max(0, Math.floor(purchasedBalance - currentBalance));\n                    return recovery.toLocaleString('it-IT');\n                  })()}</Text>\n                  <TextInput\n                    style={styles.formInput}\n                    value={txAmount}\n                    onChangeText={(text) => {\n                      const currentBalance = parseFloat(user?.balance || \"0\");\n                      const purchasedBalance = parseFloat(user?.purchasedBalance || \"0\");\n                      const maxRecovery = Math.max(0, Math.floor(purchasedBalance - currentBalance));\n                      const numValue = parseInt(text.replace(/[^0-9]/g, ''), 10);\n                      if (!isNaN(numValue) && numValue > maxRecovery) {\n                        setTxAmount(maxRecovery.toString());\n                      } else {\n                        setTxAmount(text.replace(/[^0-9]/g, ''));\n                      }\n                    }}\n                    placeholder=\"Es: 100\"\n                    keyboardType=\"numeric\"\n                    placeholderTextColor={BankColors.gray400}\n                  />\n\n                  <Text style={styles.formLabel}>Categoria</Text>\n                  <ScrollView horizontal showsHorizontalScrollIndicator={false} style={styles.categoryScroll}>\n                    {TRANSACTION_CATEGORIES.map((cat) => (\n                      <Pressable \n                        key={cat}\n                        style={[styles.categoryChip, txCategory === cat && styles.categoryChipActive]}\n                        onPress={() => setTxCategory(cat)}\n                      >\n                        <Text style={[styles.categoryChipText, txCategory === cat && styles.categoryChipTextActive]}>\n                          {cat}\n                        </Text>\n                      </Pressable>\n                    ))}\n                  </ScrollView>\n\n                  <Pressable \n                    style={[styles.submitBtn, createTransactionMutation.isPending && styles.submitBtnDisabled, (() => {\n                      const currentBalance = parseFloat(user?.balance || \"0\");\n                      const purchasedBalance = parseFloat(user?.purchasedBalance || \"0\");\n                      return purchasedBalance <= currentBalance ? styles.submitBtnDisabled : {};\n                    })()]}\n                    onPress={handleAddTransaction}\n                    disabled={createTransactionMutation.isPending || (() => {\n                      const currentBalance = parseFloat(user?.balance || \"0\");\n                      const purchasedBalance = parseFloat(user?.purchasedBalance || \"0\");\n                      return purchasedBalance <= currentBalance;\n                    })()}\n                  >\n                    {createTransactionMutation.isPending ? (\n                      <ActivityIndicator color={BankColors.white} />\n                    ) : (\n                      <Text style={styles.submitBtnText}>Certifica Entrata</Text>\n                    )}\n                  </Pressable>\n                  \n                  {(() => {\n                    const currentBalance = parseFloat(user?.balance || \"0\");\n                    const purchasedBalance = parseFloat(user?.purchasedBalance || \"0\");\n                    if (purchasedBalance <= currentBalance) {\n                      return (\n                        <Text style={styles.noRecoveryHint}>\n                          Il saldo attuale e gia al massimo certificato. Genera uscite per creare margine di recupero.\n                        </Text>\n                      );\n                    }\n                    return null;\n                  })()}\n                </View>\n              ) : (\n                <View style={styles.presetList}>\n                  <View style={styles.randomSection}>\n                    <Text style={styles.randomSectionTitle}>Genera una spesa casuale</Text>\n                    <Text style={styles.randomSectionSubtitle}>\n                      {allPresets.filter(p => p.type === \"expense\").length > 0 \n                        ? \"Simula uscite quotidiane dai preset configurati\"\n                        : \"Crea prima dei preset per generare spese casuali\"}\n                    </Text>\n                    <Pressable \n                      style={[\n                        styles.randomBtn, \n                        styles.randomBtnFullWidth,\n                        (generateRandomMutation.isPending || allPresets.filter(p => p.type === \"expense\").length === 0) && styles.submitBtnDisabled\n                      ]}\n                      onPress={() => generateRandomMutation.mutate()}\n                      disabled={generateRandomMutation.isPending || allPresets.filter(p => p.type === \"expense\").length === 0}\n                    >\n                      {generateRandomMutation.isPending ? (\n                        <ActivityIndicator color={BankColors.white} />\n                      ) : (\n                        <>\n                          <Icon name=\"shuffle\" size={20} color={BankColors.white} />\n                          <Text style={styles.randomBtnText}>Genera Uscita Random</Text>\n                        </>\n                      )}\n                    </Pressable>\n                  </View>\n                  \n                  <View style={styles.presetDivider} />\n                  \n                  <View style={styles.presetHeader}>\n                    <View style={styles.presetHeaderLeft}>\n                      <Text style={styles.presetTitle}>Preset uscite disponibili</Text>\n                      <Text style={styles.presetSubtitle}>Tieni premuto per eliminare</Text>\n                    </View>\n                    <TouchableOpacity \n                      style={styles.addPresetBtn} \n                      onPress={openCreatePreset}\n                      activeOpacity={0.7}\n                    >\n                      <Icon name=\"plus\" size={18} color={BankColors.white} />\n                      <Text style={styles.addPresetBtnText}>Nuovo</Text>\n                    </TouchableOpacity>\n                  </View>\n                  \n                  {allPresets.filter(p => p.type === \"expense\").length === 0 ? (\n                    <View style={styles.emptyPresetState}>\n                      <Icon name=\"inbox\" size={40} color={BankColors.gray300} />\n                      <Text style={styles.emptyPresetText}>Nessun preset configurato</Text>\n                      <Text style={styles.emptyPresetHint}>Premi \"Nuovo\" per creare il tuo primo preset</Text>\n                    </View>\n                  ) : null}\n                  \n                  {allPresets.filter(p => p.type === \"expense\").map((preset, index) => {\n                    const isCustom = preset.isCustom;\n                    return (\n                      <Pressable \n                        key={preset.dbId || index}\n                        style={[\n                          styles.presetItem, \n                          isCustom && styles.presetItemCustom\n                        ]}\n                        onPress={() => {\n                          if (isCustom && preset.dbId) {\n                            triggerPresetMutation.mutate(preset.dbId);\n                          } else {\n                            handlePresetTransaction(preset);\n                          }\n                        }}\n                        onLongPress={() => isCustom ? confirmDeletePreset(preset) : null}\n                      >\n                        <View style={styles.presetInfo}>\n                          <View style={styles.presetDescRow}>\n                            <Text style={styles.presetDesc}>{preset.description}</Text>\n                            {isCustom ? <Text style={styles.customBadge}>Personalizzato</Text> : null}\n                          </View>\n                          <Text style={[styles.presetType, styles.presetTypeExpense]}>\n                            Uscita - {preset.category}\n                          </Text>\n                          <Text style={styles.presetRange}>\n                            Importo: {preset.minAmount} - {preset.maxAmount} EUR\n                          </Text>\n                        </View>\n                        {isCustom && preset.dbId ? (\n                          <Pressable onPress={() => openEditPresetById(preset.dbId!)}>\n                            <Icon name=\"edit-2\" size={20} color={BankColors.cardBlue} />\n                          </Pressable>\n                        ) : null}\n                      </Pressable>\n                    );\n                  })}\n                </View>\n              )}\n            </ScrollView>\n          </View>\n        </View>\n      </Modal>\n\n      <Modal visible={showPresetEditor} animationType=\"slide\" transparent>\n        <View style={styles.modalOverlay}>\n          <View style={styles.consoleContainer}>\n            <View style={styles.consoleHeader}>\n              <Text style={styles.consoleTitle}>{editingPreset ? \"Modifica Preset\" : \"Nuovo Preset\"}</Text>\n              <Pressable onPress={() => setShowPresetEditor(false)}>\n                <Icon name=\"x\" size={24} color={BankColors.gray700} />\n              </Pressable>\n            </View>\n            <ScrollView style={styles.consoleBody} contentContainerStyle={{ paddingBottom: insets.bottom + Spacing.xl }}>\n              <View style={styles.consoleForm}>\n                <Text style={styles.formLabel}>Descrizione</Text>\n                <TextInput\n                  style={styles.formInput}\n                  value={presetDesc}\n                  onChangeText={setPresetDesc}\n                  placeholder=\"Es: Supermercato Locale\"\n                  placeholderTextColor={BankColors.gray400}\n                />\n                <Text style={styles.formLabel}>Importo Minimo (EUR)</Text>\n                <TextInput\n                  style={styles.formInput}\n                  value={presetMinAmount}\n                  onChangeText={setPresetMinAmount}\n                  placeholder=\"Es: 10\"\n                  keyboardType=\"numeric\"\n                  placeholderTextColor={BankColors.gray400}\n                />\n                <Text style={styles.formLabel}>Importo Massimo (EUR)</Text>\n                <TextInput\n                  style={styles.formInput}\n                  value={presetMaxAmount}\n                  onChangeText={setPresetMaxAmount}\n                  placeholder=\"Es: 100\"\n                  keyboardType=\"numeric\"\n                  placeholderTextColor={BankColors.gray400}\n                />\n                <Text style={styles.formLabel}>Tipo</Text>\n                <View style={styles.typeSelector}>\n                  <Pressable \n                    style={[styles.typeBtn, presetType === \"expense\" && styles.typeBtnActiveExpense]}\n                    onPress={() => setPresetType(\"expense\")}\n                  >\n                    <Text style={[styles.typeBtnText, presetType === \"expense\" && styles.typeBtnTextActive]}>Uscita</Text>\n                  </Pressable>\n                  <Pressable \n                    style={[styles.typeBtn, presetType === \"income\" && styles.typeBtnActiveIncome]}\n                    onPress={() => setPresetType(\"income\")}\n                  >\n                    <Text style={[styles.typeBtnText, presetType === \"income\" && styles.typeBtnTextActive]}>Entrata</Text>\n                  </Pressable>\n                </View>\n                <Text style={styles.formLabel}>Categoria</Text>\n                <ScrollView horizontal showsHorizontalScrollIndicator={false} style={styles.categoryScroll}>\n                  {TRANSACTION_CATEGORIES.map((cat) => (\n                    <Pressable \n                      key={cat}\n                      style={[styles.categoryChip, presetCategory === cat && styles.categoryChipActive]}\n                      onPress={() => setPresetCategory(cat)}\n                    >\n                      <Text style={[styles.categoryChipText, presetCategory === cat && styles.categoryChipTextActive]}>\n                        {cat}\n                      </Text>\n                    </Pressable>\n                  ))}\n                </ScrollView>\n                <Pressable style={styles.submitBtn} onPress={savePreset}>\n                  <Text style={styles.submitBtnText}>{editingPreset ? \"Salva Modifiche\" : \"Crea Preset\"}</Text>\n                </Pressable>\n              </View>\n            </ScrollView>\n          </View>\n        </View>\n      </Modal>\n\n      <Modal visible={showSettings} transparent animationType=\"fade\">\n        <View style={styles.modalOverlay}>\n          <Pressable style={styles.modalBackdrop} onPress={() => setShowSettings(false)} />\n          <View style={styles.settingsModalContent} onStartShouldSetResponder={() => true}>\n            <View style={styles.settingsHeader}>\n              <Text style={styles.settingsTitle}>Impostazioni e privacy</Text>\n              <Pressable onPress={() => setShowSettings(false)}>\n                <Icon name=\"x\" size={24} color={BankColors.gray700} />\n              </Pressable>\n            </View>\n            <View style={styles.settingsSection}>\n              <Text style={styles.settingsSectionTitle}>Username di ricarica</Text>\n              <View style={styles.settingsUsernameBox}>\n                <Icon name=\"at-sign\" size={20} color={BankColors.primary} />\n                <Text style={styles.settingsUsername}>{user?.rechargeUsername || \"Non disponibile\"}</Text>\n              </View>\n              <Text style={styles.settingsHint}>\n                Questo username viene usato per le ricariche PayPal. Comunicalo quando effettui un pagamento.\n              </Text>\n            </View>\n          </View>\n        </View>\n      </Modal>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.gray100,\n  },\n  header: {\n    backgroundColor: BankColors.white,\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.lg,\n  },\n  pageTitle: {\n    fontSize: 32,\n    fontWeight: \"700\",\n    color: BankColors.gray900,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  topActions: {\n    flexDirection: \"row\",\n    backgroundColor: BankColors.white,\n    paddingVertical: Spacing.lg,\n    marginBottom: Spacing.lg,\n    justifyContent: \"center\",\n    gap: Spacing[\"3xl\"],\n  },\n  topAction: {\n    alignItems: \"center\",\n  },\n  topActionIconContainer: {\n    position: \"relative\",\n  },\n  topActionBadge: {\n    position: \"absolute\",\n    top: -6,\n    right: -10,\n    backgroundColor: BankColors.error,\n    borderRadius: 10,\n    minWidth: 18,\n    height: 18,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: 4,\n  },\n  topActionBadgeText: {\n    color: BankColors.white,\n    fontSize: 11,\n    fontWeight: \"700\",\n  },\n  topActionLabel: {\n    fontSize: 12,\n    color: BankColors.gray700,\n    marginTop: Spacing.xs,\n  },\n  topActionDivider: {\n    width: 1,\n    backgroundColor: BankColors.gray300,\n  },\n  profileCard: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.white,\n    marginHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n    marginBottom: Spacing.lg,\n  },\n  profileAvatar: {\n    width: 56,\n    height: 56,\n    borderRadius: 12,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  profileInitials: {\n    color: BankColors.white,\n    fontSize: 20,\n    fontWeight: \"700\",\n  },\n  profileInfo: {\n    flex: 1,\n  },\n  profileLabel: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  profileName: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  profileBank: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  profileRechargeUsername: {\n    fontSize: 11,\n    color: BankColors.primary,\n    marginTop: 4,\n    fontWeight: \"500\",\n  },\n  menuSection: {\n    backgroundColor: BankColors.white,\n    marginHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    marginBottom: Spacing.lg,\n    overflow: \"hidden\",\n  },\n  menuItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.lg,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  menuItemPressed: {\n    backgroundColor: BankColors.gray100,\n  },\n  menuItemLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.md,\n  },\n  menuItemText: {\n    fontSize: 16,\n    color: BankColors.gray900,\n  },\n  menuItemRight: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  badge: {\n    backgroundColor: BankColors.error,\n    borderRadius: 10,\n    minWidth: 20,\n    height: 20,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: 6,\n  },\n  badgeText: {\n    color: BankColors.white,\n    fontSize: 12,\n    fontWeight: \"700\",\n  },\n  logoutButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: BankColors.white,\n    marginHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n    gap: Spacing.sm,\n    marginBottom: Spacing.xl,\n  },\n  logoutText: {\n    fontSize: 16,\n    color: BankColors.error,\n    fontWeight: \"500\",\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  modalBackdrop: {\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n  },\n  modalContent: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.xl,\n    width: \"85%\",\n    maxWidth: 400,\n    zIndex: 1,\n  },\n  modalTitle: {\n    fontSize: 20,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.lg,\n    textAlign: \"center\",\n  },\n  modalInput: {\n    borderWidth: 1,\n    borderColor: BankColors.gray300,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    fontSize: 18,\n    marginBottom: Spacing.lg,\n  },\n  modalButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  modalCancelBtn: {\n    flex: 1,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    backgroundColor: BankColors.gray200,\n    alignItems: \"center\",\n  },\n  modalCancelText: {\n    color: BankColors.gray700,\n    fontSize: 16,\n    fontWeight: \"500\",\n  },\n  modalSaveBtn: {\n    flex: 1,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n  },\n  modalSaveText: {\n    color: BankColors.white,\n    fontSize: 16,\n    fontWeight: \"500\",\n  },\n  consoleOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n  },\n  consoleContainer: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n    marginTop: 50,\n    borderTopLeftRadius: BorderRadius.xl,\n    borderTopRightRadius: BorderRadius.xl,\n  },\n  consoleHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  consoleTitle: {\n    fontSize: 20,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  consoleCloseBtn: {\n    padding: Spacing.sm,\n  },\n  consoleTabs: {\n    flexDirection: \"row\",\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  consoleTab: {\n    flex: 1,\n    paddingVertical: Spacing.md,\n    alignItems: \"center\",\n    borderBottomWidth: 2,\n    borderBottomColor: \"transparent\",\n  },\n  consoleTabActive: {\n    borderBottomColor: BankColors.primary,\n  },\n  consoleTabText: {\n    fontSize: 14,\n    fontWeight: \"500\",\n    color: BankColors.gray500,\n  },\n  consoleTabTextActive: {\n    color: BankColors.primary,\n  },\n  certificationHeader: {\n    backgroundColor: BankColors.primary + \"10\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.primary + \"20\",\n  },\n  certRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n    marginBottom: Spacing.xs,\n  },\n  certLabel: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    fontWeight: \"500\",\n  },\n  certValue: {\n    fontSize: 16,\n    color: BankColors.primary,\n    fontWeight: \"700\",\n    marginLeft: \"auto\",\n  },\n  certValueRecovery: {\n    color: BankColors.cardBlue,\n  },\n  incomeFormHint: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    textAlign: \"center\",\n    marginBottom: Spacing.lg,\n    lineHeight: 20,\n  },\n  noRecoveryHint: {\n    fontSize: 13,\n    color: BankColors.error,\n    textAlign: \"center\",\n    marginTop: Spacing.lg,\n    lineHeight: 18,\n  },\n  randomSection: {\n    padding: Spacing.lg,\n    alignItems: \"center\",\n    backgroundColor: BankColors.error + \"08\",\n    borderRadius: BorderRadius.lg,\n    marginHorizontal: Spacing.lg,\n    marginTop: Spacing.lg,\n  },\n  randomSectionTitle: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.xs,\n  },\n  randomSectionSubtitle: {\n    fontSize: 13,\n    color: BankColors.gray500,\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  presetDivider: {\n    height: 1,\n    backgroundColor: BankColors.gray200,\n    marginVertical: Spacing.lg,\n    marginHorizontal: Spacing.lg,\n  },\n  recoveryBar: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.cardBlue + \"15\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.sm,\n    gap: Spacing.sm,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.cardBlue + \"30\",\n  },\n  recoveryBarText: {\n    fontSize: 13,\n    color: BankColors.cardBlue,\n    fontWeight: \"500\",\n  },\n  consoleBody: {\n    flex: 1,\n  },\n  consoleForm: {\n    padding: Spacing.lg,\n  },\n  formLabel: {\n    fontSize: 14,\n    fontWeight: \"600\",\n    color: BankColors.gray700,\n    marginBottom: Spacing.sm,\n    marginTop: Spacing.md,\n  },\n  formInput: {\n    borderWidth: 1,\n    borderColor: BankColors.gray300,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    fontSize: 16,\n    backgroundColor: BankColors.gray50,\n    color: BankColors.gray900,\n  },\n  typeSelector: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  typeBtn: {\n    flex: 1,\n    paddingVertical: Spacing.md,\n    alignItems: \"center\",\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n    borderColor: BankColors.gray300,\n  },\n  typeBtnActiveExpense: {\n    backgroundColor: BankColors.error,\n    borderColor: BankColors.error,\n  },\n  typeBtnActiveIncome: {\n    backgroundColor: BankColors.primary,\n    borderColor: BankColors.primary,\n  },\n  typeBtnText: {\n    fontSize: 14,\n    fontWeight: \"500\",\n    color: BankColors.gray700,\n  },\n  typeBtnTextActive: {\n    color: BankColors.white,\n  },\n  categoryScroll: {\n    marginBottom: Spacing.lg,\n  },\n  categoryChip: {\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n    borderRadius: BorderRadius.full,\n    borderWidth: 1,\n    borderColor: BankColors.gray300,\n    marginRight: Spacing.sm,\n  },\n  categoryChipActive: {\n    backgroundColor: BankColors.primary,\n    borderColor: BankColors.primary,\n  },\n  categoryChipText: {\n    fontSize: 12,\n    color: BankColors.gray700,\n  },\n  categoryChipTextActive: {\n    color: BankColors.white,\n  },\n  submitBtn: {\n    backgroundColor: BankColors.primary,\n    paddingVertical: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    alignItems: \"center\",\n    marginTop: Spacing.lg,\n  },\n  submitBtnDisabled: {\n    opacity: 0.6,\n  },\n  submitBtnText: {\n    color: BankColors.white,\n    fontSize: 16,\n    fontWeight: \"600\",\n  },\n  divider: {\n    height: 1,\n    backgroundColor: BankColors.gray200,\n    marginVertical: Spacing.xl,\n  },\n  randomBtn: {\n    backgroundColor: \"#FF9800\",\n    paddingVertical: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    alignItems: \"center\",\n    flexDirection: \"row\",\n    justifyContent: \"center\",\n    gap: Spacing.sm,\n  },\n  randomBtnFullWidth: {\n    width: \"100%\",\n  },\n  randomBtnText: {\n    color: BankColors.white,\n    fontSize: 16,\n    fontWeight: \"600\",\n  },\n  presetList: {\n    paddingHorizontal: Spacing.md,\n    paddingTop: Spacing.sm,\n  },\n  presetTitle: {\n    fontSize: 15,\n    fontWeight: \"600\",\n    color: BankColors.gray800,\n    marginBottom: Spacing.xs,\n  },\n  presetSubtitle: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  presetHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n    paddingHorizontal: Spacing.sm,\n  },\n  presetHeaderLeft: {\n    flex: 1,\n  },\n  emptyPresetState: {\n    alignItems: \"center\",\n    paddingVertical: Spacing[\"2xl\"],\n    paddingHorizontal: Spacing.lg,\n    backgroundColor: BankColors.gray50,\n    borderRadius: BorderRadius.lg,\n    marginHorizontal: Spacing.sm,\n  },\n  emptyPresetText: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray600,\n    marginTop: Spacing.md,\n  },\n  emptyPresetHint: {\n    fontSize: 13,\n    color: BankColors.gray400,\n    marginTop: Spacing.xs,\n    textAlign: \"center\",\n  },\n  addPresetBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.primary,\n    borderRadius: BorderRadius.md,\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n    gap: 4,\n    zIndex: 10,\n    cursor: \"pointer\",\n  } as any,\n  addPresetBtnText: {\n    color: BankColors.white,\n    fontSize: 13,\n    fontWeight: \"600\",\n  },\n  presetItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.gray50,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    marginBottom: Spacing.md,\n    borderWidth: 1,\n    borderColor: BankColors.gray200,\n  },\n  presetItemDisabled: {\n    opacity: 0.6,\n    backgroundColor: BankColors.gray100,\n  },\n  presetItemCustom: {\n    borderColor: BankColors.cardBlue,\n    borderWidth: 1.5,\n  },\n  presetDescRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    flexWrap: \"wrap\",\n    gap: 6,\n  },\n  presetDescDisabled: {\n    textDecorationLine: \"line-through\",\n  },\n  customBadge: {\n    fontSize: 10,\n    color: BankColors.white,\n    backgroundColor: BankColors.cardBlue,\n    paddingHorizontal: 6,\n    paddingVertical: 2,\n    borderRadius: 4,\n    fontWeight: \"600\",\n  },\n  presetDisabledBadge: {\n    fontSize: 11,\n    color: BankColors.error,\n    marginTop: 4,\n    fontWeight: \"600\",\n  },\n  presetItemPressed: {\n    backgroundColor: BankColors.gray100,\n  },\n  swipeDeleteBtn: {\n    backgroundColor: BankColors.error,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    width: 90,\n    marginBottom: Spacing.md,\n    borderRadius: BorderRadius.md,\n    marginLeft: Spacing.sm,\n  },\n  swipeDeleteText: {\n    color: BankColors.white,\n    fontSize: 12,\n    fontWeight: \"600\",\n    marginTop: 4,\n  },\n  presetInfo: {\n    flex: 1,\n  },\n  presetDesc: {\n    fontSize: 14,\n    fontWeight: \"500\",\n    color: BankColors.gray900,\n    marginBottom: 4,\n  },\n  presetType: {\n    fontSize: 12,\n    marginBottom: 2,\n  },\n  presetTypeIncome: {\n    color: BankColors.primary,\n  },\n  presetTypeExpense: {\n    color: BankColors.error,\n  },\n  presetRange: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  settingsModalContent: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.xl,\n    marginHorizontal: Spacing.lg,\n    width: \"90%\",\n    maxWidth: 400,\n  },\n  settingsHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.xl,\n  },\n  settingsTitle: {\n    fontSize: 20,\n    fontWeight: \"700\",\n    color: BankColors.gray900,\n  },\n  settingsSection: {\n    marginBottom: Spacing.lg,\n  },\n  settingsSectionTitle: {\n    fontSize: 14,\n    fontWeight: \"600\",\n    color: BankColors.gray700,\n    marginBottom: Spacing.sm,\n  },\n  settingsUsernameBox: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.gray100,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  settingsUsername: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.primary,\n  },\n  settingsHint: {\n    fontSize: 12,\n    color: BankColors.gray500,\n    marginTop: Spacing.sm,\n    lineHeight: 18,\n  },\n});\n","path":null,"size_bytes":48019,"size_tokens":null},"client/components/HeaderTitle.tsx":{"content":"import React from \"react\";\nimport { View, StyleSheet, Image } from \"react-native\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Spacing } from \"@/constants/theme\";\n\ninterface HeaderTitleProps {\n  title: string;\n}\n\nexport function HeaderTitle({ title }: HeaderTitleProps) {\n  return (\n    <View style={styles.container}>\n      <Image\n        source={require(\"../../assets/images/icon.png\")}\n        style={styles.icon}\n        resizeMode=\"contain\"\n      />\n      <ThemedText style={styles.title}>{title}</ThemedText>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"flex-start\",\n  },\n  icon: {\n    width: 28,\n    height: 28,\n    marginRight: Spacing.sm,\n  },\n  title: {\n    fontSize: 17,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":832,"size_tokens":null},"client/screens/OperazioniScreen.tsx":{"content":"import React from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  StyleSheet,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport type { OperazioniStackParamList } from \"@/navigation/MainTabNavigator\";\n\ninterface OperationItemProps {\n  title: string;\n  onPress?: () => void;\n}\n\nconst OperationItem = ({ title, onPress }: OperationItemProps) => (\n  <Pressable \n    style={({ pressed }) => [styles.operationItem, pressed && styles.operationItemPressed]}\n    onPress={onPress}\n  >\n    <Text style={styles.operationItemText}>{title}</Text>\n    <Icon name=\"chevron-right\" size={20} color={BankColors.gray400} />\n  </Pressable>\n);\n\ninterface SectionHeaderProps {\n  icon?: string;\n  iconColor?: string;\n  title: string;\n}\n\nconst SectionHeader = ({ icon, iconColor, title }: SectionHeaderProps) => (\n  <View style={styles.sectionHeader}>\n    {icon ? (\n      <View style={[styles.sectionIcon, iconColor ? { backgroundColor: iconColor } : null]}>\n        <Icon name={icon} size={18} color={BankColors.white} />\n      </View>\n    ) : null}\n    <Text style={styles.sectionTitle}>{title}</Text>\n  </View>\n);\n\ntype NavigationProp = NativeStackNavigationProp<OperazioniStackParamList>;\n\nexport default function OperazioniScreen() {\n  const insets = useSafeAreaInsets();\n  const tabBarHeight = useBottomTabBarHeight();\n  const navigation = useNavigation<NavigationProp>();\n\n  const handleTransferPress = () => {\n    navigation.navigate(\"Transfer\");\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={[styles.header, { paddingTop: insets.top + Spacing.lg }]}>\n        <View style={styles.headerActions}>\n          <Pressable style={styles.headerAction}>\n            <Icon name=\"search\" size={22} color={BankColors.gray700} />\n            <Text style={styles.headerActionText}>Cerca</Text>\n          </Pressable>\n          <Pressable style={styles.headerAction}>\n            <Icon name=\"help-circle\" size={22} color={BankColors.gray700} />\n            <Text style={styles.headerActionText}>Aiuto</Text>\n          </Pressable>\n        </View>\n      </View>\n\n      <ScrollView\n        style={styles.scrollView}\n        contentContainerStyle={{ paddingBottom: tabBarHeight + Spacing.xl }}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <Text style={styles.pageTitle}>Operazioni</Text>\n\n        <View style={styles.section}>\n          <Text style={styles.sectionLabel}>Operazioni frequenti</Text>\n          <View style={styles.card}>\n            <OperationItem title=\"Bonifico\" />\n            <OperationItem title=\"Prelievo cardless\" />\n            <OperationItem title=\"Scambia denaro\" onPress={handleTransferPress} />\n          </View>\n        </View>\n\n        <View style={styles.section}>\n          <Text style={styles.sectionLabel}>Tutte le operazioni</Text>\n          \n          <SectionHeader icon=\"send\" iconColor={BankColors.primary} title=\"Bonifici e giroconti\" />\n          <View style={styles.card}>\n            <OperationItem title=\"Bonifico\" />\n            <OperationItem title=\"Bonifico per agevolazioni fiscali\" />\n          </View>\n\n          <SectionHeader icon=\"credit-card\" iconColor=\"#4CAF50\" title=\"BANCOMAT Pay\" />\n          <View style={styles.card}>\n            <OperationItem title=\"Scambia denaro\" onPress={handleTransferPress} />\n            <OperationItem title=\"Paga in negozio\" />\n            <OperationItem title=\"Addebiti ricorrenti\" />\n          </View>\n\n          <View style={styles.card}>\n            <OperationItem title=\"Bollettino postale premarcato\" />\n            <OperationItem title=\"MAV\" />\n            <OperationItem title=\"RAV\" />\n            <OperationItem title=\"F24\" />\n          </View>\n\n          <SectionHeader icon=\"smartphone\" iconColor=\"#FF9800\" title=\"Ricariche\" />\n          <View style={styles.card}>\n            <OperationItem title=\"Ricarica telefonica\" />\n            <OperationItem title=\"Ricarica carta prepagata\" />\n          </View>\n\n          <SectionHeader icon=\"file-text\" iconColor=\"#2196F3\" title=\"Pagamenti\" />\n          <View style={styles.card}>\n            <OperationItem title=\"CBILL/pagoPA\" />\n            <OperationItem title=\"Bollo auto\" />\n            <OperationItem title=\"Pagamento utenze\" />\n          </View>\n        </View>\n      </ScrollView>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.gray100,\n  },\n  header: {\n    backgroundColor: BankColors.white,\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.sm,\n  },\n  headerActions: {\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\",\n    gap: Spacing.lg,\n  },\n  headerAction: {\n    alignItems: \"center\",\n  },\n  headerActionText: {\n    color: BankColors.gray700,\n    fontSize: 11,\n    marginTop: 2,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  pageTitle: {\n    fontSize: 32,\n    fontWeight: \"700\",\n    color: BankColors.gray900,\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.lg,\n    backgroundColor: BankColors.white,\n  },\n  section: {\n    marginTop: Spacing.lg,\n  },\n  sectionLabel: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray700,\n    paddingHorizontal: Spacing.lg,\n    marginBottom: Spacing.sm,\n  },\n  sectionHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.md,\n    gap: Spacing.sm,\n  },\n  sectionIcon: {\n    width: 32,\n    height: 32,\n    borderRadius: 8,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  sectionTitle: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  card: {\n    backgroundColor: BankColors.white,\n    marginHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    marginBottom: Spacing.sm,\n    overflow: \"hidden\",\n  },\n  operationItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.lg,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  operationItemPressed: {\n    backgroundColor: BankColors.gray100,\n  },\n  operationItemText: {\n    fontSize: 16,\n    color: BankColors.gray900,\n  },\n});\n","path":null,"size_bytes":6585,"size_tokens":null},"server/replit_integrations/chat/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport OpenAI from \"openai\";\nimport { chatStorage } from \"./storage\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\nconst FINANCIAL_ADVISOR_SYSTEM_PROMPT = `Sei un consulente finanziario AI personale di EquisCash. \nIl tuo nome è \"Assistente EquisCash\".\n\nLe tue competenze includono:\n- Analisi delle spese e suggerimenti per risparmiare\n- Consigli su investimenti e risparmio\n- Spiegazioni di prodotti bancari e finanziari\n- Suggerimenti per budget mensili\n- Consigli su prestiti, mutui e finanziamenti\n- Educazione finanziaria generale\n\nRegole importanti:\n- Rispondi SEMPRE in italiano\n- Sii professionale ma cordiale\n- Dai consigli pratici e specifici\n- Se non sei sicuro di qualcosa, suggerisci di contattare un consulente umano\n- Non dare mai consigli fiscali specifici senza suggerire di consultare un commercialista\n- Mantieni le risposte concise e facili da capire\n- Usa esempi concreti quando possibile`;\n\nexport function registerChatRoutes(app: Express): void {\n  // Get all conversations for a user\n  app.get(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const userId = req.query.userId as string;\n      const conversations = await chatStorage.getAllConversations(userId);\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversations\" });\n    }\n  });\n\n  // Get single conversation with messages\n  app.get(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const conversation = await chatStorage.getConversation(id);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      const messages = await chatStorage.getMessagesByConversation(id);\n      res.json({ ...conversation, messages });\n    } catch (error) {\n      console.error(\"Error fetching conversation:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation\" });\n    }\n  });\n\n  // Create new conversation\n  app.post(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const { title, userId } = req.body;\n      const conversation = await chatStorage.createConversation(title || \"Nuova Conversazione\", userId);\n      res.status(201).json(conversation);\n    } catch (error) {\n      console.error(\"Error creating conversation:\", error);\n      res.status(500).json({ error: \"Failed to create conversation\" });\n    }\n  });\n\n  // Delete conversation\n  app.delete(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await chatStorage.deleteConversation(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting conversation:\", error);\n      res.status(500).json({ error: \"Failed to delete conversation\" });\n    }\n  });\n\n  // Send message and get AI response (non-streaming for mobile compatibility)\n  app.post(\"/api/conversations/:id/messages\", async (req: Request, res: Response) => {\n    try {\n      const conversationId = parseInt(req.params.id);\n      const { content, userContext } = req.body;\n\n      // Save user message\n      await chatStorage.createMessage(conversationId, \"user\", content);\n\n      // Get conversation history for context\n      const messages = await chatStorage.getMessagesByConversation(conversationId);\n      const chatMessages: OpenAI.Chat.ChatCompletionMessageParam[] = [\n        { role: \"system\", content: FINANCIAL_ADVISOR_SYSTEM_PROMPT + (userContext ? `\\n\\nContesto utente: ${userContext}` : \"\") },\n        ...messages.map((m) => ({\n          role: m.role as \"user\" | \"assistant\",\n          content: m.content,\n        })),\n      ];\n\n      // Get response from OpenAI\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o-mini\",\n        messages: chatMessages,\n        max_tokens: 1024,\n      });\n\n      const assistantResponse = completion.choices[0]?.message?.content || \"Mi scuso, non sono riuscito a elaborare una risposta.\";\n\n      // Save assistant message\n      const savedMessage = await chatStorage.createMessage(conversationId, \"assistant\", assistantResponse);\n\n      res.json({ message: savedMessage });\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      res.status(500).json({ error: \"Failed to send message\" });\n    }\n  });\n}\n","path":null,"size_bytes":4591,"size_tokens":null},"client/components/ErrorFallback.tsx":{"content":"import React, { useState } from \"react\";\nimport { reloadAppAsync } from \"expo\";\nimport {\n  StyleSheet,\n  View,\n  Pressable,\n  ScrollView,\n  Text,\n  Modal,\n} from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, Fonts } from \"@/constants/theme\";\n\nexport type ErrorFallbackProps = {\n  error: Error;\n  resetError: () => void;\n};\n\nexport function ErrorFallback({ error, resetError }: ErrorFallbackProps) {\n  const { theme } = useTheme();\n  const [isModalVisible, setIsModalVisible] = useState(false);\n\n  const handleRestart = async () => {\n    try {\n      await reloadAppAsync();\n    } catch (restartError) {\n      console.error(\"Failed to restart app:\", restartError);\n      resetError();\n    }\n  };\n\n  const formatErrorDetails = (): string => {\n    let details = `Error: ${error.message}\\n\\n`;\n    if (error.stack) {\n      details += `Stack Trace:\\n${error.stack}`;\n    }\n    return details;\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      {__DEV__ ? (\n        <Pressable\n          onPress={() => setIsModalVisible(true)}\n          style={({ pressed }) => [\n            styles.topButton,\n            {\n              backgroundColor: theme.backgroundDefault,\n              opacity: pressed ? 0.8 : 1,\n            },\n          ]}\n        >\n          <Feather name=\"alert-circle\" size={20} color={theme.text} />\n        </Pressable>\n      ) : null}\n\n      <View style={styles.content}>\n        <ThemedText type=\"h1\" style={styles.title}>\n          Something went wrong\n        </ThemedText>\n\n        <ThemedText type=\"body\" style={styles.message}>\n          Please reload the app to continue.\n        </ThemedText>\n\n        <Pressable\n          onPress={handleRestart}\n          style={({ pressed }) => [\n            styles.button,\n            {\n              backgroundColor: theme.link,\n              opacity: pressed ? 0.9 : 1,\n              transform: [{ scale: pressed ? 0.98 : 1 }],\n            },\n          ]}\n        >\n          <ThemedText\n            type=\"body\"\n            style={[styles.buttonText, { color: theme.buttonText }]}\n          >\n            Try Again\n          </ThemedText>\n        </Pressable>\n      </View>\n\n      {__DEV__ ? (\n        <Modal\n          visible={isModalVisible}\n          animationType=\"slide\"\n          transparent={true}\n          onRequestClose={() => setIsModalVisible(false)}\n        >\n          <View style={styles.modalOverlay}>\n            <ThemedView style={styles.modalContainer}>\n              <View style={styles.modalHeader}>\n                <ThemedText type=\"h2\" style={styles.modalTitle}>\n                  Error Details\n                </ThemedText>\n                <Pressable\n                  onPress={() => setIsModalVisible(false)}\n                  style={({ pressed }) => [\n                    styles.closeButton,\n                    { opacity: pressed ? 0.6 : 1 },\n                  ]}\n                >\n                  <Feather name=\"x\" size={24} color={theme.text} />\n                </Pressable>\n              </View>\n\n              <ScrollView\n                style={styles.modalScrollView}\n                contentContainerStyle={styles.modalScrollContent}\n                showsVerticalScrollIndicator\n              >\n                <View\n                  style={[\n                    styles.errorContainer,\n                    { backgroundColor: theme.backgroundDefault },\n                  ]}\n                >\n                  <Text\n                    style={[\n                      styles.errorText,\n                      {\n                        color: theme.text,\n                        fontFamily: Fonts?.mono || \"monospace\",\n                      },\n                    ]}\n                    selectable\n                  >\n                    {formatErrorDetails()}\n                  </Text>\n                </View>\n              </ScrollView>\n            </ThemedView>\n          </View>\n        </Modal>\n      ) : null}\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    width: \"100%\",\n    height: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing[\"2xl\"],\n  },\n  content: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.lg,\n    width: \"100%\",\n    maxWidth: 600,\n  },\n  title: {\n    textAlign: \"center\",\n    lineHeight: 40,\n  },\n  message: {\n    textAlign: \"center\",\n    opacity: 0.7,\n    lineHeight: 24,\n  },\n  topButton: {\n    position: \"absolute\",\n    top: Spacing[\"2xl\"] + Spacing.lg,\n    right: Spacing.lg,\n    width: 44,\n    height: 44,\n    borderRadius: BorderRadius.md,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    zIndex: 10,\n  },\n  button: {\n    paddingVertical: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    paddingHorizontal: Spacing[\"2xl\"],\n    minWidth: 200,\n    elevation: 3,\n  },\n  buttonText: {\n    fontWeight: \"600\",\n    textAlign: \"center\",\n    fontSize: 16,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    justifyContent: \"flex-end\",\n  },\n  modalContainer: {\n    width: \"100%\",\n    height: \"90%\",\n    borderTopLeftRadius: BorderRadius.lg,\n    borderTopRightRadius: BorderRadius.lg,\n  },\n  modalHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.lg,\n    paddingBottom: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: \"rgba(128, 128, 128, 0.2)\",\n  },\n  modalTitle: {\n    fontWeight: \"600\",\n  },\n  closeButton: {\n    padding: Spacing.xs,\n  },\n  modalScrollView: {\n    flex: 1,\n  },\n  modalScrollContent: {\n    padding: Spacing.lg,\n  },\n  errorContainer: {\n    width: \"100%\",\n    borderRadius: BorderRadius.md,\n    overflow: \"hidden\",\n    padding: Spacing.lg,\n  },\n  errorText: {\n    fontSize: 12,\n    lineHeight: 18,\n    width: \"100%\",\n  },\n});\n","path":null,"size_bytes":6064,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\n\nconst pool = new pg.Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool);\n","path":null,"size_bytes":186,"size_tokens":null},"server/replit_integrations/news/index.ts":{"content":"export { registerNewsRoutes } from \"./routes\";\n","path":null,"size_bytes":47,"size_tokens":null},"client/screens/AdvisorScreen.tsx":{"content":"import React, { useState, useRef, useEffect } from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  TextInput,\n  StyleSheet,\n  ActivityIndicator,\n  KeyboardAvoidingView,\n  Platform,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport * as Haptics from \"expo-haptics\";\nimport { Icon } from \"@/components/Icon\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { apiRequest, getApiUrl } from \"@/lib/query-client\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface Message {\n  id: number;\n  conversationId: number;\n  role: \"user\" | \"assistant\";\n  content: string;\n  createdAt: string;\n}\n\ninterface Conversation {\n  id: number;\n  userId: string | null;\n  title: string;\n  createdAt: string;\n  messages?: Message[];\n}\n\nconst SUGGESTED_QUESTIONS = [\n  \"Come posso risparmiare di più?\",\n  \"Analizza le mie spese del mese\",\n  \"Consigli per investire i risparmi\",\n  \"Cos'è un fondo comune d'investimento?\",\n];\n\nexport default function AdvisorScreen() {\n  const insets = useSafeAreaInsets();\n  const headerHeight = useHeaderHeight();\n  const queryClient = useQueryClient();\n  const { userId, user } = useAuth();\n  const scrollViewRef = useRef<ScrollView>(null);\n  \n  const [activeConversationId, setActiveConversationId] = useState<number | null>(null);\n  const [inputMessage, setInputMessage] = useState(\"\");\n  const [isTyping, setIsTyping] = useState(false);\n\n  // Fetch conversations list\n  const { data: conversations = [] } = useQuery<Conversation[]>({\n    queryKey: [\"/api/conversations\", userId],\n    queryFn: async () => {\n      const response = await fetch(`${getApiUrl()}/api/conversations?userId=${userId}`);\n      return response.json();\n    },\n    enabled: !!userId,\n  });\n\n  // Fetch active conversation with messages\n  const { data: activeConversation, isLoading: loadingConversation } = useQuery<Conversation>({\n    queryKey: [\"/api/conversations\", activeConversationId],\n    queryFn: async () => {\n      const response = await fetch(`${getApiUrl()}/api/conversations/${activeConversationId}`);\n      return response.json();\n    },\n    enabled: !!activeConversationId,\n    refetchInterval: false,\n  });\n\n  // Create new conversation\n  const createConversationMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/conversations\", {\n        title: \"Nuova Conversazione\",\n        userId,\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setActiveConversationId(data.id);\n      queryClient.invalidateQueries({ queryKey: [\"/api/conversations\", userId] });\n    },\n  });\n\n  // Send message\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      if (!activeConversationId) return;\n      setIsTyping(true);\n      \n      const userContext = user ? `Saldo attuale: €${parseFloat(user.balance || \"0\").toFixed(2)}, Nome: ${user.fullName}` : \"\";\n      \n      const response = await apiRequest(\"POST\", `/api/conversations/${activeConversationId}/messages`, {\n        content,\n        userContext,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsTyping(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/conversations\", activeConversationId] });\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    },\n    onError: () => {\n      setIsTyping(false);\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);\n    },\n  });\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    if (activeConversation?.messages) {\n      setTimeout(() => {\n        scrollViewRef.current?.scrollToEnd({ animated: true });\n      }, 100);\n    }\n  }, [activeConversation?.messages?.length]);\n\n  const handleSendMessage = async () => {\n    if (!inputMessage.trim()) return;\n    \n    const message = inputMessage.trim();\n    setInputMessage(\"\");\n    \n    // If no active conversation, create one first\n    if (!activeConversationId) {\n      const newConversation = await createConversationMutation.mutateAsync();\n      setActiveConversationId(newConversation.id);\n      setTimeout(() => {\n        sendMessageMutation.mutate(message);\n      }, 100);\n    } else {\n      sendMessageMutation.mutate(message);\n    }\n  };\n\n  const handleSuggestedQuestion = (question: string) => {\n    setInputMessage(question);\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n  };\n\n  const handleNewConversation = () => {\n    setActiveConversationId(null);\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n  };\n\n  const messages = activeConversation?.messages || [];\n\n  return (\n    <KeyboardAvoidingView \n      style={styles.container}\n      behavior={Platform.OS === \"ios\" ? \"padding\" : undefined}\n      keyboardVerticalOffset={headerHeight}\n    >\n      <View style={[styles.content, { paddingTop: headerHeight + Spacing.md }]}>\n        {!activeConversationId && messages.length === 0 ? (\n          <ScrollView \n            style={styles.welcomeScroll}\n            contentContainerStyle={[styles.welcomeContainer, { paddingBottom: insets.bottom + 100 }]}\n          >\n            <View style={styles.advisorIcon}>\n              <Icon name=\"message-circle\" size={48} color={BankColors.primary} />\n            </View>\n            <Text style={styles.welcomeTitle}>Assistente EquisCash</Text>\n            <Text style={styles.welcomeSubtitle}>\n              Il tuo consulente finanziario personale, sempre disponibile per aiutarti.\n            </Text>\n\n            <Text style={styles.suggestionsLabel}>Domande suggerite:</Text>\n            <View style={styles.suggestionsContainer}>\n              {SUGGESTED_QUESTIONS.map((question, index) => (\n                <Pressable\n                  key={index}\n                  style={({ pressed }) => [\n                    styles.suggestionChip,\n                    pressed && styles.suggestionChipPressed,\n                  ]}\n                  onPress={() => handleSuggestedQuestion(question)}\n                >\n                  <Text style={styles.suggestionText}>{question}</Text>\n                </Pressable>\n              ))}\n            </View>\n\n            {conversations.length > 0 ? (\n              <View style={styles.recentSection}>\n                <Text style={styles.recentLabel}>Conversazioni recenti:</Text>\n                {conversations.slice(0, 3).map((conv) => (\n                  <Pressable\n                    key={conv.id}\n                    style={({ pressed }) => [\n                      styles.recentItem,\n                      pressed && styles.recentItemPressed,\n                    ]}\n                    onPress={() => setActiveConversationId(conv.id)}\n                  >\n                    <Icon name=\"message-square\" size={20} color={BankColors.gray500} />\n                    <Text style={styles.recentItemText} numberOfLines={1}>\n                      {conv.title}\n                    </Text>\n                    <Icon name=\"chevron-right\" size={20} color={BankColors.gray400} />\n                  </Pressable>\n                ))}\n              </View>\n            ) : null}\n          </ScrollView>\n        ) : (\n          <>\n            <View style={styles.chatHeader}>\n              <Pressable style={styles.backBtn} onPress={handleNewConversation}>\n                <Icon name=\"plus\" size={20} color={BankColors.primary} />\n                <Text style={styles.backBtnText}>Nuova</Text>\n              </Pressable>\n            </View>\n            \n            <ScrollView\n              ref={scrollViewRef}\n              style={styles.messagesScroll}\n              contentContainerStyle={[styles.messagesContainer, { paddingBottom: 20 }]}\n            >\n              {loadingConversation ? (\n                <View style={styles.loadingContainer}>\n                  <ActivityIndicator color={BankColors.primary} />\n                </View>\n              ) : (\n                messages.map((msg) => (\n                  <View\n                    key={msg.id}\n                    style={[\n                      styles.messageBubble,\n                      msg.role === \"user\" ? styles.userBubble : styles.assistantBubble,\n                    ]}\n                  >\n                    {msg.role === \"assistant\" ? (\n                      <View style={styles.assistantHeader}>\n                        <Icon name=\"message-circle\" size={16} color={BankColors.primary} />\n                        <Text style={styles.assistantLabel}>Assistente EquisCash</Text>\n                      </View>\n                    ) : null}\n                    <Text\n                      style={[\n                        styles.messageText,\n                        msg.role === \"user\" ? styles.userText : styles.assistantText,\n                      ]}\n                    >\n                      {msg.content}\n                    </Text>\n                  </View>\n                ))\n              )}\n              \n              {isTyping ? (\n                <View style={[styles.messageBubble, styles.assistantBubble]}>\n                  <View style={styles.typingIndicator}>\n                    <View style={styles.typingDot} />\n                    <View style={[styles.typingDot, styles.typingDotMiddle]} />\n                    <View style={styles.typingDot} />\n                  </View>\n                </View>\n              ) : null}\n            </ScrollView>\n          </>\n        )}\n      </View>\n\n      <View style={[styles.inputContainer, { paddingBottom: insets.bottom + Spacing.sm }]}>\n        <TextInput\n          style={styles.textInput}\n          value={inputMessage}\n          onChangeText={setInputMessage}\n          placeholder=\"Scrivi un messaggio...\"\n          placeholderTextColor={BankColors.gray400}\n          multiline\n          maxLength={1000}\n          returnKeyType=\"send\"\n          onSubmitEditing={handleSendMessage}\n        />\n        <Pressable\n          style={[\n            styles.sendButton,\n            (!inputMessage.trim() || sendMessageMutation.isPending) && styles.sendButtonDisabled,\n          ]}\n          onPress={handleSendMessage}\n          disabled={!inputMessage.trim() || sendMessageMutation.isPending}\n        >\n          {sendMessageMutation.isPending ? (\n            <ActivityIndicator size=\"small\" color={BankColors.white} />\n          ) : (\n            <Icon name=\"send\" size={20} color={BankColors.white} />\n          )}\n        </Pressable>\n      </View>\n    </KeyboardAvoidingView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.gray100,\n  },\n  content: {\n    flex: 1,\n  },\n  welcomeScroll: {\n    flex: 1,\n  },\n  welcomeContainer: {\n    padding: Spacing.xl,\n    alignItems: \"center\",\n  },\n  advisorIcon: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    backgroundColor: BankColors.primaryLight,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  welcomeTitle: {\n    fontSize: 28,\n    fontWeight: \"700\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.sm,\n  },\n  welcomeSubtitle: {\n    fontSize: 16,\n    color: BankColors.gray600,\n    textAlign: \"center\",\n    marginBottom: Spacing.xl,\n    paddingHorizontal: Spacing.lg,\n    lineHeight: 24,\n  },\n  suggestionsLabel: {\n    fontSize: 14,\n    fontWeight: \"600\",\n    color: BankColors.gray700,\n    alignSelf: \"flex-start\",\n    marginBottom: Spacing.md,\n  },\n  suggestionsContainer: {\n    width: \"100%\",\n    marginBottom: Spacing.xl,\n  },\n  suggestionChip: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    marginBottom: Spacing.sm,\n    borderWidth: 1,\n    borderColor: BankColors.gray200,\n  },\n  suggestionChipPressed: {\n    backgroundColor: BankColors.gray50,\n  },\n  suggestionText: {\n    fontSize: 15,\n    color: BankColors.gray800,\n  },\n  recentSection: {\n    width: \"100%\",\n  },\n  recentLabel: {\n    fontSize: 14,\n    fontWeight: \"600\",\n    color: BankColors.gray700,\n    marginBottom: Spacing.md,\n  },\n  recentItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    marginBottom: Spacing.sm,\n    gap: Spacing.sm,\n    borderWidth: 1,\n    borderColor: BankColors.gray200,\n  },\n  recentItemPressed: {\n    backgroundColor: BankColors.gray50,\n  },\n  recentItemText: {\n    flex: 1,\n    fontSize: 15,\n    color: BankColors.gray800,\n  },\n  chatHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\",\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.sm,\n  },\n  backBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n    paddingVertical: Spacing.sm,\n    paddingHorizontal: Spacing.md,\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.md,\n  },\n  backBtnText: {\n    fontSize: 14,\n    color: BankColors.primary,\n    fontWeight: \"500\",\n  },\n  messagesScroll: {\n    flex: 1,\n  },\n  messagesContainer: {\n    paddingHorizontal: Spacing.lg,\n  },\n  loadingContainer: {\n    padding: Spacing.xl,\n    alignItems: \"center\",\n  },\n  messageBubble: {\n    maxWidth: \"85%\",\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.md,\n    marginBottom: Spacing.md,\n  },\n  userBubble: {\n    backgroundColor: BankColors.primary,\n    alignSelf: \"flex-end\",\n    borderBottomRightRadius: 4,\n  },\n  assistantBubble: {\n    backgroundColor: BankColors.white,\n    alignSelf: \"flex-start\",\n    borderBottomLeftRadius: 4,\n    borderWidth: 1,\n    borderColor: BankColors.gray200,\n  },\n  assistantHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n    marginBottom: Spacing.xs,\n  },\n  assistantLabel: {\n    fontSize: 12,\n    fontWeight: \"600\",\n    color: BankColors.primary,\n  },\n  messageText: {\n    fontSize: 15,\n    lineHeight: 22,\n  },\n  userText: {\n    color: BankColors.white,\n  },\n  assistantText: {\n    color: BankColors.gray800,\n  },\n  typingIndicator: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 4,\n    paddingVertical: Spacing.sm,\n  },\n  typingDot: {\n    width: 8,\n    height: 8,\n    borderRadius: 4,\n    backgroundColor: BankColors.gray400,\n    opacity: 0.5,\n  },\n  typingDotMiddle: {\n    opacity: 0.75,\n  },\n  inputContainer: {\n    flexDirection: \"row\",\n    alignItems: \"flex-end\",\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.sm,\n    backgroundColor: BankColors.white,\n    borderTopWidth: 1,\n    borderTopColor: BankColors.gray200,\n    gap: Spacing.sm,\n  },\n  textInput: {\n    flex: 1,\n    backgroundColor: BankColors.gray100,\n    borderRadius: BorderRadius.lg,\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n    fontSize: 16,\n    maxHeight: 100,\n    color: BankColors.gray900,\n  },\n  sendButton: {\n    width: 44,\n    height: 44,\n    borderRadius: 22,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  sendButtonDisabled: {\n    backgroundColor: BankColors.gray300,\n  },\n});\n","path":null,"size_bytes":15134,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"node:http\";\nimport { storage } from \"./storage\";\nimport { registerChatRoutes } from \"./replit_integrations/chat\";\nimport { registerNewsRoutes } from \"./replit_integrations/news\";\nimport { DEFAULT_PRESETS, type PresetTransaction } from \"../shared/presets\";\n\ntype UserPresetSettings = {\n  deletedPresets: string[];\n  disabledPresets: string[];\n  customPresets: PresetTransaction[];\n};\n\ntype GenerateTransactionResult = {\n  userId: string;\n  description: string;\n  amount: string;\n  type: string;\n  category: string;\n  accountNumber: null;\n  isContabilizzato: boolean;\n  isSimulated: boolean;\n  date: Date;\n  wasCapped?: boolean;\n  cappedMessage?: string;\n} | null;\n\nfunction generateRandomTransaction(\n  userId: string, \n  currentBalance: number,\n  purchasedBalance: number,\n  userSettings: UserPresetSettings\n): GenerateTransactionResult {\n  const now = new Date();\n  \n  // Random button ONLY generates expenses (uscite)\n  // Income is handled separately via manual form\n  const isExpense = true;\n  \n  const excludeDescriptions = [\n    ...userSettings.deletedPresets,\n    ...userSettings.disabledPresets\n  ];\n  \n  // Only get expense presets\n  let availablePresets = DEFAULT_PRESETS.filter(p => {\n    if (p.type !== \"expense\") return false;\n    if (excludeDescriptions.includes(p.description)) return false;\n    return true;\n  });\n  \n  // Add custom expense presets\n  const customExpensePresets = userSettings.customPresets.filter(p => p.type === \"expense\");\n  availablePresets = [...availablePresets, ...customExpensePresets];\n  \n  if (availablePresets.length === 0) {\n    return null;\n  }\n  \n  const preset = availablePresets[Math.floor(Math.random() * availablePresets.length)];\n  \n  let amount: number;\n  if (preset.fixedAmounts && preset.fixedAmounts.length > 0) {\n    amount = preset.fixedAmounts[Math.floor(Math.random() * preset.fixedAmounts.length)];\n  } else {\n    amount = Math.round(Math.random() * (preset.maxAmount - preset.minAmount) + preset.minAmount);\n  }\n  \n  const wasCapped = false;\n  const cappedMessage: string | undefined = undefined;\n  \n  const isContabilizzato = Math.random() > 0.15;\n  \n  return {\n    userId,\n    description: preset.description,\n    amount: amount.toFixed(0) + \".00\",\n    type: preset.type,\n    category: preset.category,\n    accountNumber: null,\n    isContabilizzato,\n    isSimulated: true,\n    date: new Date(now),\n    wasCapped,\n    cappedMessage,\n  };\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Register AI chat routes for financial advisor\n  registerChatRoutes(app);\n  \n  // Register AI-curated news feed routes\n  registerNewsRoutes(app);\n\n  // Server date endpoint for client synchronization\n  app.get(\"/api/server-date\", (req, res) => {\n    const now = new Date();\n    return res.json({\n      date: now.toISOString(),\n      timestamp: now.getTime(),\n      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone\n    });\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    const { username, referralCode } = req.body;\n    \n    if (!username) {\n      return res.status(400).json({ error: \"Username richiesto\" });\n    }\n    \n    let user = await storage.getUserByUsername(username);\n    let isNewUser = false;\n    \n    if (!user) {\n      const rechargeUsername = username\n        .toLowerCase()\n        .replace(/\\s+/g, '_')\n        .replace(/[^a-z0-9_]/g, '')\n        .substring(0, 15) + '_' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n      \n      user = await storage.createUser({\n        username,\n        pin: \"00000\",\n        hasSetPin: false,\n        fullName: username.toUpperCase(),\n        accountNumber: `1000/${Math.floor(Math.random() * 100000).toString().padStart(8, \"0\")}`,\n        balance: \"10.00\",\n        cardLastFour: Math.floor(Math.random() * 10000).toString().padStart(4, \"0\"),\n        rechargeUsername,\n      });\n      isNewUser = true;\n      \n      // Apply referral code if provided and valid\n      if (referralCode && referralCode.trim()) {\n        const referrer = await storage.getUserByReferralCode(referralCode.trim());\n        if (referrer && referrer.id !== user.id) {\n          await storage.updateUserReferredBy(user.id, referrer.id);\n        }\n      }\n    }\n    \n    return res.json({ \n      userId: user.id, \n      username: user.username,\n      needsSetup: isNewUser || !user.hasSetPin\n    });\n  });\n\n  app.post(\"/api/auth/setup-pin\", async (req, res) => {\n    const { userId, pin } = req.body;\n    \n    if (!userId || !pin) {\n      return res.status(400).json({ error: \"UserId e PIN richiesti\" });\n    }\n    \n    if (pin.length !== 5 || !/^\\d{5}$/.test(pin)) {\n      return res.status(400).json({ error: \"Il PIN deve essere di 5 cifre\" });\n    }\n    \n    const user = await storage.getUser(userId);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    await storage.updateUserPin(userId, pin);\n    \n    const updatedUser = await storage.getUser(userId);\n    return res.json({ \n      success: true, \n      user: {\n        id: updatedUser!.id,\n        username: updatedUser!.username,\n        rechargeUsername: updatedUser!.rechargeUsername,\n        fullName: updatedUser!.fullName,\n        accountNumber: updatedUser!.accountNumber,\n        balance: updatedUser!.balance,\n        purchasedBalance: updatedUser!.purchasedBalance,\n        cardLastFour: updatedUser!.cardLastFour,\n      }\n    });\n  });\n\n  app.post(\"/api/auth/set-recharge-username\", async (req, res) => {\n    const { userId, rechargeUsername } = req.body;\n    \n    if (!userId || !rechargeUsername) {\n      return res.status(400).json({ error: \"UserId e username di ricarica richiesti\" });\n    }\n    \n    const trimmedUsername = rechargeUsername.trim().toLowerCase();\n    \n    if (trimmedUsername.length < 3) {\n      return res.status(400).json({ error: \"L'username deve essere di almeno 3 caratteri\" });\n    }\n    \n    if (!/^[a-z0-9_]+$/.test(trimmedUsername)) {\n      return res.status(400).json({ error: \"L'username puo contenere solo lettere, numeri e underscore\" });\n    }\n    \n    const user = await storage.getUser(userId);\n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    if (user.rechargeUsername) {\n      return res.status(400).json({ error: \"L'username di ricarica e gia stato impostato e non puo essere modificato\" });\n    }\n    \n    const existingUser = await storage.getUserByRechargeUsername(trimmedUsername);\n    if (existingUser) {\n      return res.status(400).json({ error: \"Questo username e gia in uso\" });\n    }\n    \n    await storage.setUserRechargeUsername(userId, trimmedUsername);\n    \n    return res.json({ success: true });\n  });\n\n  app.post(\"/api/check-recharge-username\", async (req, res) => {\n    const { rechargeUsername } = req.body;\n    \n    if (!rechargeUsername) {\n      return res.status(400).json({ available: false });\n    }\n    \n    const trimmedUsername = rechargeUsername.trim().toLowerCase();\n    const existingUser = await storage.getUserByRechargeUsername(trimmedUsername);\n    \n    return res.json({ available: !existingUser });\n  });\n\n  app.post(\"/api/auth/verify-pin\", async (req, res) => {\n    const { userId, pin } = req.body;\n    \n    if (!userId || !pin) {\n      return res.status(400).json({ error: \"UserId e PIN richiesti\" });\n    }\n    \n    const user = await storage.getUser(userId);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    if (user.pin !== pin) {\n      return res.status(401).json({ error: \"PIN non valido\" });\n    }\n    \n    return res.json({ \n      success: true, \n      user: {\n        id: user.id,\n        username: user.username,\n        rechargeUsername: user.rechargeUsername,\n        fullName: user.fullName,\n        accountNumber: user.accountNumber,\n        balance: user.balance,\n        purchasedBalance: user.purchasedBalance,\n        cardLastFour: user.cardLastFour,\n      }\n    });\n  });\n\n  app.get(\"/api/user/:userId\", async (req, res) => {\n    const { userId } = req.params;\n    \n    const user = await storage.getUser(userId);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    return res.json({\n      id: user.id,\n      username: user.username,\n      rechargeUsername: user.rechargeUsername,\n      fullName: user.fullName,\n      accountNumber: user.accountNumber,\n      balance: user.balance,\n      purchasedBalance: user.purchasedBalance,\n      cardLastFour: user.cardLastFour,\n    });\n  });\n\n  app.put(\"/api/user/:userId/balance\", async (req, res) => {\n    const { userId } = req.params;\n    const { balance } = req.body;\n    \n    if (balance === undefined) {\n      return res.status(400).json({ error: \"Saldo richiesto\" });\n    }\n    \n    const user = await storage.updateUserBalance(userId, balance.toString());\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    return res.json({\n      id: user.id,\n      balance: user.balance,\n    });\n  });\n\n  app.put(\"/api/user/:userId/name\", async (req, res) => {\n    const { userId } = req.params;\n    const { name } = req.body;\n    \n    if (!name) {\n      return res.status(400).json({ error: \"Nome richiesto\" });\n    }\n    \n    const user = await storage.updateUserName(userId, name);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    return res.json({\n      id: user.id,\n      fullName: user.fullName,\n    });\n  });\n\n  app.put(\"/api/user/:userId/account-number\", async (req, res) => {\n    const { userId } = req.params;\n    const { accountNumber } = req.body;\n    \n    if (!accountNumber) {\n      return res.status(400).json({ error: \"Numero conto richiesto\" });\n    }\n    \n    const user = await storage.updateUserAccountNumber(userId, accountNumber);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    return res.json({\n      id: user.id,\n      accountNumber: user.accountNumber,\n    });\n  });\n\n  app.get(\"/api/transactions/:userId\", async (req, res) => {\n    const { userId } = req.params;\n    \n    const transactions = await storage.getTransactions(userId);\n    \n    return res.json(transactions);\n  });\n\n  app.post(\"/api/transactions/:userId/generate-random\", async (req, res) => {\n    const { userId } = req.params;\n    \n    const user = await storage.getUser(userId);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    // Fetch custom presets from database (new normalized table)\n    const dbCustomPresets = await storage.getCustomPresets(userId);\n    \n    // Convert DB presets to the format expected by generateRandomTransaction\n    const customPresetsForRandom: PresetTransaction[] = dbCustomPresets\n      .filter(p => p.isEnabled && p.type === \"expense\")\n      .map(p => ({\n        description: p.description,\n        type: p.type as \"expense\" | \"income\",\n        category: p.category,\n        minAmount: p.minAmount,\n        maxAmount: p.maxAmount,\n        isCustom: true,\n      }));\n    \n    const userSettings: UserPresetSettings = {\n      deletedPresets: [],\n      disabledPresets: [],\n      customPresets: customPresetsForRandom,\n    };\n    \n    const currentBalance = parseFloat(user.balance || \"0\");\n    const purchasedBalance = parseFloat(user.purchasedBalance || \"0\");\n    const transaction = generateRandomTransaction(userId, currentBalance, purchasedBalance, userSettings);\n    \n    if (!transaction) {\n      return res.json({ \n        transaction: null, \n        newBalance: user.balance,\n        message: \"Nessun preset disponibile. Crea dei preset per generare transazioni casuali.\" \n      });\n    }\n    \n    const { wasCapped, cappedMessage, ...transactionData } = transaction;\n    const created = await storage.createTransaction(transactionData);\n    \n    const amountValue = parseFloat(transaction.amount);\n    const balanceChange = transaction.type === \"expense\" ? -amountValue : amountValue;\n    const newBalance = Math.round(currentBalance + balanceChange).toFixed(0) + \".00\";\n    \n    // Also deduct from purchased balance (margine di recupero)\n    const newPurchasedBalance = Math.max(0, purchasedBalance + balanceChange).toFixed(2);\n    await storage.updateUserBalanceWithPurchased(userId, newBalance, newPurchasedBalance);\n    \n    return res.json({ \n      transaction: created, \n      newBalance,\n      wasCapped,\n      cappedMessage \n    });\n  });\n\n  app.post(\"/api/transactions\", async (req, res) => {\n    const transaction = req.body;\n    \n    if (!transaction.userId || !transaction.description || !transaction.amount) {\n      return res.status(400).json({ error: \"Dati transazione incompleti\" });\n    }\n    \n    const user = await storage.getUser(transaction.userId);\n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    const currentBalance = parseFloat(user.balance || \"0\");\n    const purchasedBalance = parseFloat(user.purchasedBalance || \"0\");\n    // Use exact decimal subtraction - no flooring until final comparison\n    const recoveryAvailability = Math.max(0, purchasedBalance - currentBalance);\n    \n    let amount = Math.abs(parseFloat(transaction.amount));\n    let wasCapped = false;\n    \n    // Only cap income transactions - expenses are always allowed\n    if (transaction.type === \"income\") {\n      // Allow income only if there's recovery room (purchasedBalance > currentBalance)\n      if (recoveryAvailability <= 0) {\n        return res.status(403).json({ \n          error: \"Saldo gia al massimo pagato. Non puoi aggiungere entrate simulate.\",\n          recoveryAvailability: 0\n        });\n      }\n      // Cap the income amount to available recovery\n      if (amount > recoveryAvailability) {\n        amount = Math.floor(recoveryAvailability);\n        wasCapped = true;\n      }\n    }\n    \n    // Floor the amount for whole euros\n    amount = Math.floor(amount);\n    \n    if (transaction.date && typeof transaction.date === 'string') {\n      transaction.date = new Date(transaction.date);\n    }\n    \n    transaction.amount = amount.toFixed(0) + \".00\";\n    transaction.isSimulated = true;\n    \n    const created = await storage.createTransaction(transaction);\n    \n    const balanceChange = transaction.type === \"expense\" ? -amount : amount;\n    const newBalance = Math.floor(currentBalance + balanceChange).toFixed(0) + \".00\";\n    await storage.updateUserBalance(user.id, newBalance);\n    \n    return res.json({ \n      transaction: created, \n      newBalance,\n      wasCapped,\n      cappedMessage: wasCapped ? \"Saldo riportato al massimo pagato\" : undefined,\n      recoveryAvailability: Math.max(0, purchasedBalance - parseFloat(newBalance))\n    });\n  });\n\n  app.put(\"/api/transactions/:transactionId\", async (req, res) => {\n    const { transactionId } = req.params;\n    const { amount, description } = req.body;\n    \n    const transaction = await storage.getTransaction(transactionId);\n    \n    if (!transaction) {\n      return res.status(404).json({ error: \"Transazione non trovata\" });\n    }\n    \n    const updates: { amount?: string; description?: string } = {};\n    if (amount !== undefined) updates.amount = amount;\n    if (description !== undefined) updates.description = description;\n    \n    const updated = await storage.updateTransaction(transactionId, updates);\n    \n    // Security: Editing transactions does NOT modify the user's balance\n    // Balance can only be changed by admin top-ups or transfers\n    \n    return res.json(updated);\n  });\n\n  // Get user preset settings\n  app.get(\"/api/users/:userId/preset-settings\", async (req, res) => {\n    const { userId } = req.params;\n    const settings = await storage.getPresetSettings(userId);\n    if (!settings) {\n      return res.json({\n        deletedPresets: [],\n        disabledPresets: [],\n        customPresets: [],\n      });\n    }\n    return res.json({\n      deletedPresets: JSON.parse(settings.deletedPresets),\n      disabledPresets: JSON.parse(settings.disabledPresets),\n      customPresets: JSON.parse(settings.customPresets),\n    });\n  });\n\n  // Save user preset settings\n  app.post(\"/api/users/:userId/preset-settings\", async (req, res) => {\n    const { userId } = req.params;\n    const { deletedPresets, disabledPresets, customPresets } = req.body;\n    const settings = await storage.savePresetSettings(userId, {\n      deletedPresets,\n      disabledPresets,\n      customPresets,\n    });\n    return res.json({\n      deletedPresets: JSON.parse(settings.deletedPresets),\n      disabledPresets: JSON.parse(settings.disabledPresets),\n      customPresets: JSON.parse(settings.customPresets),\n    });\n  });\n\n  // Custom presets API - database-backed persistent storage\n  app.get(\"/api/users/:userId/custom-presets\", async (req, res) => {\n    const { userId } = req.params;\n    const presets = await storage.getCustomPresets(userId);\n    return res.json(presets);\n  });\n\n  app.post(\"/api/users/:userId/custom-presets\", async (req, res) => {\n    const { userId } = req.params;\n    const { description, type, category, minAmount, maxAmount } = req.body;\n\n    if (!description || !category || minAmount === undefined || maxAmount === undefined) {\n      return res.status(400).json({ error: \"Dati mancanti\" });\n    }\n\n    const preset = await storage.createCustomPreset({\n      userId,\n      description,\n      type: type || \"expense\",\n      category,\n      minAmount: parseInt(minAmount),\n      maxAmount: parseInt(maxAmount),\n      isEnabled: true,\n    });\n\n    return res.json(preset);\n  });\n\n  app.put(\"/api/users/:userId/custom-presets/:presetId\", async (req, res) => {\n    const { userId, presetId } = req.params;\n    const { description, type, category, minAmount, maxAmount, isEnabled } = req.body;\n\n    const existing = await storage.getCustomPreset(parseInt(presetId));\n    if (!existing) {\n      return res.status(404).json({ error: \"Preset non trovato\" });\n    }\n    if (existing.userId !== userId) {\n      return res.status(403).json({ error: \"Non autorizzato\" });\n    }\n\n    const updated = await storage.updateCustomPreset(parseInt(presetId), {\n      description,\n      type,\n      category,\n      minAmount: minAmount !== undefined ? parseInt(minAmount) : undefined,\n      maxAmount: maxAmount !== undefined ? parseInt(maxAmount) : undefined,\n      isEnabled,\n    });\n\n    return res.json(updated);\n  });\n\n  app.delete(\"/api/users/:userId/custom-presets/:presetId\", async (req, res) => {\n    const { userId, presetId } = req.params;\n\n    const existing = await storage.getCustomPreset(parseInt(presetId));\n    if (!existing) {\n      return res.status(404).json({ error: \"Preset non trovato\" });\n    }\n    if (existing.userId !== userId) {\n      return res.status(403).json({ error: \"Non autorizzato\" });\n    }\n\n    await storage.deleteCustomPreset(parseInt(presetId));\n    return res.json({ success: true });\n  });\n\n  app.post(\"/api/users/:userId/custom-presets/:presetId/trigger\", async (req, res) => {\n    const { userId, presetId } = req.params;\n\n    const result = await storage.triggerPresetTransaction(userId, parseInt(presetId));\n    if (!result.success) {\n      return res.status(400).json({ error: result.error });\n    }\n\n    return res.json({\n      success: true,\n      transaction: result.transaction,\n      user: result.user,\n    });\n  });\n\n  // Get all users for money transfer feature\n  app.get(\"/api/users\", async (req, res) => {\n    const allUsers = await storage.getAllUsers();\n    // Return sanitized user data (no PIN)\n    const sanitizedUsers = allUsers.map(user => ({\n      id: user.id,\n      username: user.username,\n      fullName: user.fullName,\n      accountNumber: user.accountNumber,\n      balance: user.balance,\n    }));\n    return res.json(sanitizedUsers);\n  });\n\n  // Search user by username (for transfers)\n  app.get(\"/api/users/search/:username\", async (req, res) => {\n    const { username } = req.params;\n    \n    if (!username || username.trim().length === 0) {\n      return res.status(400).json({ error: \"Username richiesto\" });\n    }\n    \n    const user = await storage.getUserByUsername(username.trim());\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    // Check if user is blocked\n    if (user.isBlocked) {\n      return res.status(403).json({ error: \"Questo utente non può ricevere trasferimenti\" });\n    }\n    \n    // Return sanitized user data (no PIN, no sensitive info)\n    return res.json({\n      id: user.id,\n      username: user.username,\n      fullName: user.fullName,\n      accountNumber: user.accountNumber,\n    });\n  });\n\n  // Transfer balance between users\n  app.post(\"/api/transfer\", async (req, res) => {\n    const { fromUserId, toUserId, amount } = req.body;\n    \n    if (!fromUserId || !toUserId || amount === undefined) {\n      return res.status(400).json({ success: false, error: \"Dati mancanti\" });\n    }\n\n    // Server-side validation - never trust client data\n    const amountNum = parseFloat(amount);\n    if (isNaN(amountNum) || amountNum <= 0 || !Number.isInteger(amountNum)) {\n      return res.status(400).json({ success: false, error: \"L'importo deve essere un numero intero positivo\" });\n    }\n\n    if (fromUserId === toUserId) {\n      return res.status(400).json({ success: false, error: \"Non puoi trasferire denaro a te stesso\" });\n    }\n\n    // Always fetch the authoritative balance from the database (anti-cheat)\n    const fromUser = await storage.getUser(fromUserId);\n    if (!fromUser) {\n      return res.status(404).json({ success: false, error: \"Utente non trovato\" });\n    }\n\n    const serverBalance = parseFloat(fromUser.balance || \"0\");\n    if (amountNum > serverBalance) {\n      return res.status(400).json({ success: false, error: \"Saldo insufficiente\" });\n    }\n\n    const result = await storage.transferBalance(fromUserId, toUserId, amountNum);\n    \n    if (!result.success) {\n      return res.status(400).json(result);\n    }\n\n    // Create transaction records for both users\n    const now = new Date();\n    const toUser = await storage.getUser(toUserId);\n    \n    // Outgoing transaction for sender (real, not simulated)\n    await storage.createTransaction({\n      userId: fromUserId,\n      description: `Trasferimento a ${toUser?.fullName || toUser?.username || 'Utente'}`,\n      amount: amount.toString(),\n      type: \"expense\",\n      category: \"Trasferimenti\",\n      accountNumber: toUser?.accountNumber || null,\n      isContabilizzato: true,\n      isSimulated: false,\n      date: now,\n    });\n\n    // Incoming transaction for receiver (real, not simulated)\n    await storage.createTransaction({\n      userId: toUserId,\n      description: `Trasferimento da ${fromUser.fullName || fromUser.username}`,\n      amount: amount.toString(),\n      type: \"income\",\n      category: \"Trasferimenti\",\n      accountNumber: fromUser.accountNumber || null,\n      isContabilizzato: true,\n      isSimulated: false,\n      date: now,\n    });\n\n    return res.json(result);\n  });\n\n  // Admin: Search user by @username (login username)\n  app.post(\"/api/admin/search-user\", async (req, res) => {\n    const { adminPassword, username } = req.body;\n    \n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    if (!username) {\n      return res.status(400).json({ error: \"Username richiesto\" });\n    }\n    \n    // Remove @ prefix if present and trim\n    const cleanUsername = username.trim().toLowerCase().replace(/^@/, '');\n    const user = await storage.getUserByUsername(cleanUsername);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato con questo username\" });\n    }\n    \n    return res.json({\n      id: user.id,\n      username: user.username,\n      accountNumber: user.accountNumber,\n      fullName: user.fullName,\n      balance: user.balance,\n    });\n  });\n\n  // Admin: Add balance to user (top-up)\n  app.post(\"/api/admin/topup\", async (req, res) => {\n    const { adminPassword, username, amount } = req.body;\n    \n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    if (!username || !amount) {\n      return res.status(400).json({ error: \"Username e importo richiesti\" });\n    }\n    \n    const amountNum = parseInt(amount);\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return res.status(400).json({ error: \"L'importo deve essere un numero intero positivo\" });\n    }\n    \n    // Remove @ prefix if present and trim\n    const cleanUsername = username.trim().toLowerCase().replace(/^@/, '');\n    const user = await storage.getUserByUsername(cleanUsername);\n    \n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    const currentBalance = parseFloat(user.balance || \"0\");\n    const currentPurchasedBalance = parseFloat(user.purchasedBalance || \"0\");\n    const previousTotalRecharged = parseFloat(user.totalRecharged || \"0\");\n    const newBalance = (currentBalance + amountNum).toFixed(2);\n    const newPurchasedBalance = (currentPurchasedBalance + amountNum).toFixed(2);\n    \n    await storage.updateUserBalanceWithPurchased(user.id, newBalance, newPurchasedBalance);\n    await storage.updateUserTotalRecharged(user.id, amountNum);\n    \n    await storage.createTransaction({\n      userId: user.id,\n      description: \"Ricarica PayPal\",\n      amount: amountNum.toString() + \".00\",\n      type: \"income\",\n      category: \"Ricariche\",\n      accountNumber: null,\n      isContabilizzato: true,\n      isSimulated: false,\n      date: new Date(),\n    });\n    \n    // Check if user just crossed €2 threshold and has a referrer\n    const newTotalRecharged = previousTotalRecharged + amountNum;\n    let referralBonusAwarded = false;\n    let referrerName = \"\";\n    \n    if (previousTotalRecharged < 2 && newTotalRecharged >= 2 && user.referredBy && !user.referralActivated) {\n      const referrer = await storage.getUser(user.referredBy);\n      if (referrer) {\n        // Get bonus amount from settings (default 200)\n        const bonusStr = await storage.getAppSetting(\"referral_bonus\");\n        const bonusAmount = bonusStr ? parseInt(bonusStr) : 200;\n        \n        // Award bonus to referrer\n        const referrerBalance = parseFloat(referrer.balance || \"0\");\n        const referrerPurchased = parseFloat(referrer.purchasedBalance || \"0\");\n        const newReferrerBalance = (referrerBalance + bonusAmount).toFixed(2);\n        const newReferrerPurchased = (referrerPurchased + bonusAmount).toFixed(2);\n        \n        await storage.updateUserBalanceWithPurchased(referrer.id, newReferrerBalance, newReferrerPurchased);\n        \n        // Create bonus transaction for referrer\n        await storage.createTransaction({\n          userId: referrer.id,\n          description: `Bonus Referral da ${user.username}`,\n          amount: bonusAmount.toString() + \".00\",\n          type: \"income\",\n          category: \"Bonus\",\n          accountNumber: null,\n          isContabilizzato: true,\n          isSimulated: false,\n          date: new Date(),\n        });\n        \n        // Record the activation\n        await storage.createReferralActivation(referrer.id, user.id, bonusAmount);\n        await storage.activateReferral(user.id);\n        \n        referralBonusAwarded = true;\n        referrerName = referrer.fullName || referrer.username;\n      }\n    }\n    \n    const updatedUser = await storage.getUser(user.id);\n    \n    return res.json({\n      success: true,\n      user: {\n        fullName: updatedUser!.fullName,\n        rechargeUsername: updatedUser!.rechargeUsername,\n        newBalance: updatedUser!.balance,\n        purchasedBalance: updatedUser!.purchasedBalance,\n        totalRecharged: updatedUser!.totalRecharged,\n      },\n      referralBonusAwarded,\n      referrerName: referralBonusAwarded ? referrerName : undefined,\n    });\n  });\n\n  // Admin: Get referral bonus setting\n  app.get(\"/api/admin/referral-settings\", async (req, res) => {\n    const adminPassword = req.headers[\"x-admin-password\"] as string;\n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    const bonusStr = await storage.getAppSetting(\"referral_bonus\");\n    return res.json({ referralBonus: bonusStr ? parseInt(bonusStr) : 200 });\n  });\n\n  // Admin: Update referral bonus setting\n  app.post(\"/api/admin/referral-settings\", async (req, res) => {\n    const { adminPassword, referralBonus } = req.body;\n    \n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    const bonus = parseInt(referralBonus);\n    if (isNaN(bonus) || bonus < 0) {\n      return res.status(400).json({ error: \"Il bonus deve essere un numero positivo\" });\n    }\n    \n    await storage.setAppSetting(\"referral_bonus\", bonus.toString());\n    return res.json({ success: true, referralBonus: bonus });\n  });\n\n  // Admin: Get all referral activations\n  app.get(\"/api/admin/referral-activations\", async (req, res) => {\n    const adminPassword = req.headers[\"x-admin-password\"] as string;\n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    const activations = await storage.getReferralActivations();\n    return res.json(activations);\n  });\n\n  // Admin: Get users sorted\n  app.get(\"/api/admin/users\", async (req, res) => {\n    const adminPassword = req.headers[\"x-admin-password\"] as string;\n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    const sortBy = (req.query.sortBy as string) === 'balance' ? 'balance' : 'newest';\n    const allUsers = await storage.getAllUsersSorted(sortBy);\n    \n    const sanitizedUsers = allUsers.map(user => ({\n      id: user.id,\n      username: user.username,\n      fullName: user.fullName,\n      accountNumber: user.accountNumber,\n      balance: user.balance,\n      purchasedBalance: user.purchasedBalance,\n      totalRecharged: user.totalRecharged,\n      isBlocked: user.isBlocked,\n      blockedReason: user.blockedReason,\n      createdAt: user.createdAt,\n    }));\n    return res.json(sanitizedUsers);\n  });\n\n  // Admin: Block user\n  app.post(\"/api/admin/block-user\", async (req, res) => {\n    const { adminPassword, userId, reason } = req.body;\n    \n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    if (!userId) {\n      return res.status(400).json({ error: \"ID utente richiesto\" });\n    }\n    \n    const user = await storage.blockUser(userId, reason);\n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    return res.json({ success: true, user: { id: user.id, username: user.username, isBlocked: user.isBlocked } });\n  });\n\n  // Admin: Unblock user\n  app.post(\"/api/admin/unblock-user\", async (req, res) => {\n    const { adminPassword, userId } = req.body;\n    \n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    if (!userId) {\n      return res.status(400).json({ error: \"ID utente richiesto\" });\n    }\n    \n    const user = await storage.unblockUser(userId);\n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    return res.json({ success: true, user: { id: user.id, username: user.username, isBlocked: user.isBlocked } });\n  });\n\n  // Admin: Delete user (for duplicate registrations)\n  app.post(\"/api/admin/delete-user\", async (req, res) => {\n    const { adminPassword, userId } = req.body;\n    \n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    if (!userId) {\n      return res.status(400).json({ error: \"ID utente richiesto\" });\n    }\n    \n    const success = await storage.deleteUser(userId);\n    if (!success) {\n      return res.status(500).json({ error: \"Errore durante l'eliminazione dell'utente\" });\n    }\n    \n    return res.json({ success: true, message: \"Utente eliminato con successo\" });\n  });\n\n  // Admin: Set user balance (for anti-cheat corrections)\n  app.post(\"/api/admin/set-balance\", async (req, res) => {\n    const { adminPassword, userId, newBalance } = req.body;\n    \n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    if (!userId || newBalance === undefined) {\n      return res.status(400).json({ error: \"ID utente e nuovo saldo richiesti\" });\n    }\n    \n    const balanceNum = parseFloat(newBalance);\n    if (isNaN(balanceNum) || balanceNum < 0) {\n      return res.status(400).json({ error: \"Il saldo deve essere un numero positivo\" });\n    }\n    \n    const user = await storage.setUserBalance(userId, balanceNum.toFixed(2));\n    if (!user) {\n      return res.status(404).json({ error: \"Utente non trovato\" });\n    }\n    \n    return res.json({ success: true, user: { id: user.id, username: user.username, balance: user.balance } });\n  });\n\n  // Admin: Get transfer history (real transactions only)\n  app.get(\"/api/admin/transfers\", async (req, res) => {\n    const adminPassword = req.headers[\"x-admin-password\"] as string;\n    const validPassword = process.env.ADMIN_PASSWORD;\n    if (!validPassword || adminPassword !== validPassword) {\n      return res.status(401).json({ error: \"Password admin non valida\" });\n    }\n    \n    const transfers = await storage.getTransferHistory();\n    \n    // Enrich with user info\n    const enrichedTransfers = [];\n    for (const transfer of transfers) {\n      const user = await storage.getUser(transfer.userId);\n      enrichedTransfers.push({\n        ...transfer,\n        username: user?.username || 'Sconosciuto',\n        fullName: user?.fullName || 'Sconosciuto',\n      });\n    }\n    \n    return res.json(enrichedTransfers);\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":34803,"size_tokens":null},"client/screens/CarteScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  StyleSheet,\n  Modal,\n  TextInput,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { LinearGradient } from \"expo-linear-gradient\";\nimport * as Haptics from \"expo-haptics\";\nimport { Icon } from \"@/components/Icon\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\n\nconst QuickActionButton = ({ \n  icon, \n  label, \n}: { \n  icon: string; \n  label: string; \n}) => (\n  <Pressable style={({ pressed }) => [styles.quickActionBtn, pressed && styles.quickActionPressed]}>\n    <Icon name={icon} size={18} color={BankColors.white} />\n    <Text style={styles.quickActionLabel}>{label}</Text>\n  </Pressable>\n);\n\nconst MonthlyExpenseItem = ({ month, amount }: { month: string; amount: string }) => (\n  <Pressable style={styles.monthlyItem}>\n    <View style={styles.monthlyLeft}>\n      <View style={styles.monthlyIcon}>\n        <Icon name=\"arrow-down\" size={18} color={BankColors.error} />\n      </View>\n      <Text style={styles.monthlyMonth}>{month}</Text>\n    </View>\n    <View style={styles.monthlyRight}>\n      <Text style={styles.monthlyAmount}>{amount}</Text>\n      <Icon name=\"chevron-right\" size={20} color={BankColors.gray400} />\n    </View>\n  </Pressable>\n);\n\nconst TransactionItem = ({ date, description, category, amount }: { \n  date: string; \n  description: string; \n  category: string; \n  amount: string;\n}) => (\n  <Pressable style={styles.transactionItem}>\n    <View style={styles.transactionInfo}>\n      <Text style={styles.transactionDate}>{date}</Text>\n      <Text style={styles.transactionDesc}>{description}</Text>\n      <Text style={styles.transactionCategory}>{category}</Text>\n    </View>\n    <View style={styles.transactionRight}>\n      <Text style={styles.transactionAmount}>{amount}</Text>\n      <Icon name=\"chevron-right\" size={20} color={BankColors.gray400} />\n    </View>\n  </Pressable>\n);\n\nexport default function CarteScreen() {\n  const insets = useSafeAreaInsets();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { user, updateName } = useAuth();\n  const [showEditName, setShowEditName] = useState(false);\n  const [newName, setNewName] = useState(\"\");\n\n  const handleEditName = () => {\n    setNewName(user?.fullName || \"\");\n    setShowEditName(true);\n  };\n\n  const handleSaveName = async () => {\n    if (newName.trim()) {\n      await updateName(newName.trim());\n      setShowEditName(false);\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <ScrollView\n        style={styles.scrollView}\n        contentContainerStyle={{ paddingBottom: tabBarHeight + Spacing.xl }}\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <LinearGradient\n          colors={[BankColors.primaryLight, BankColors.primary, BankColors.primaryDark]}\n          style={[styles.header, { paddingTop: insets.top + Spacing.md }]}\n        >\n          <View style={styles.headerTop}>\n            <View />\n            <View style={styles.headerActions}>\n              <Pressable style={styles.headerAction}>\n                <Icon name=\"search\" size={22} color={BankColors.white} />\n                <Text style={styles.headerActionText}>Cerca</Text>\n              </Pressable>\n              <Pressable style={styles.headerAction}>\n                <Icon name=\"help-circle\" size={22} color={BankColors.white} />\n                <Text style={styles.headerActionText}>Aiuto</Text>\n              </Pressable>\n            </View>\n          </View>\n\n          <Text style={styles.pageTitle}>Carte</Text>\n\n          <View style={styles.cardSelector}>\n            <Pressable style={styles.cardSelectorBtn}>\n              <Text style={styles.cardSelectorText}>Carta di debito - **** {user?.cardLastFour || \"3796\"}</Text>\n            </Pressable>\n            <Pressable style={styles.cardSelectorBtn}>\n              <Text style={styles.cardSelectorText}>Richiedi nuova</Text>\n            </Pressable>\n          </View>\n\n          <View style={styles.cardDisplay}>\n            <View style={styles.cardVisual}>\n              <View style={styles.cardHeader}>\n                <Text style={styles.cardBankName}>EQUISCASH</Text>\n                <Text style={styles.cardType}>XME Card Plus</Text>\n              </View>\n              <View style={styles.cardChip}>\n                <Icon name=\"cpu\" size={24} color={BankColors.gray600} />\n                <Text style={styles.cardContactless}>)))</Text>\n              </View>\n              <View style={styles.cardBottom}>\n                <Pressable onPress={handleEditName}>\n                  <Text style={styles.cardLabel}>DEBIT</Text>\n                  <Text style={styles.cardHolderName}>{user?.fullName || \"COGNOME NOME\"}</Text>\n                  <View style={styles.cardActiveTag}>\n                    <Text style={styles.cardActiveText}>ATTIVATA</Text>\n                  </View>\n                </Pressable>\n                <View style={styles.cardLogos}>\n                  <View style={styles.pagoBancomatLogo}>\n                    <Text style={styles.pagoBancomatText}>PAGO{\"\\n\"}BANCOMAT</Text>\n                  </View>\n                  <View style={styles.mastercardLogo}>\n                    <View style={[styles.mcCircle, { backgroundColor: \"#EB001B\" }]} />\n                    <View style={[styles.mcCircle, { backgroundColor: \"#F79E1B\", marginLeft: -8 }]} />\n                  </View>\n                </View>\n              </View>\n            </View>\n            <Text style={styles.cardDescription}>Carta digitale e fisica</Text>\n          </View>\n\n          <ScrollView \n            horizontal \n            showsHorizontalScrollIndicator={false}\n            style={styles.quickActionsScroll}\n            contentContainerStyle={styles.quickActionsContainer}\n          >\n            <QuickActionButton icon=\"settings\" label=\"Pagamenti digitali\" />\n            <QuickActionButton icon=\"credit-card\" label=\"Carte virtuali\" />\n            <QuickActionButton icon=\"list\" label=\"Dettagli carta\" />\n          </ScrollView>\n        </LinearGradient>\n\n        <View style={styles.disponibilitaSection}>\n          <View style={styles.sectionHeader}>\n            <Text style={styles.sectionTitle}>Disponibilita</Text>\n            <Pressable style={styles.viewAllBtn}>\n              <Text style={styles.viewAllText}>Dettagli</Text>\n              <Icon name=\"chevron-right\" size={16} color={BankColors.primary} />\n            </Pressable>\n          </View>\n\n          <View style={styles.disponibilitaCard}>\n            <Text style={styles.disponibilitaLabel}>Disponibilita pagamenti di questo mese</Text>\n            <Text style={styles.disponibilitaAmount}>3.771,69 {\"\\u20AC\"} su 5.000,00 {\"\\u20AC\"}</Text>\n            <View style={styles.progressBar}>\n              <View style={[styles.progressFill, { width: \"75%\" }]} />\n            </View>\n            <View style={styles.limitRow}>\n              <Text style={styles.limitLabel}>Limite giornaliero</Text>\n              <Text style={styles.limitAmount}>2.500,00 {\"\\u20AC\"}</Text>\n            </View>\n          </View>\n        </View>\n\n        <View style={styles.usciteSection}>\n          <Text style={styles.sectionTitle}>Uscite</Text>\n          <View style={styles.usciteCard}>\n            <MonthlyExpenseItem month=\"Dicembre\" amount=\"- 1.563,58 €\" />\n            <MonthlyExpenseItem month=\"Novembre\" amount=\"- 1.523,90 €\" />\n          </View>\n        </View>\n\n        <View style={styles.movimentiSection}>\n          <View style={styles.sectionHeader}>\n            <Text style={styles.sectionTitle}>Movimenti</Text>\n            <Pressable style={styles.viewAllBtn}>\n              <Text style={styles.viewAllText}>Visualizza tutti</Text>\n              <Icon name=\"chevron-right\" size={16} color={BankColors.primary} />\n            </Pressable>\n          </View>\n\n          <TransactionItem \n            date=\"18.12.2025\" \n            description=\"AL SOLITO POSTO\" \n            category=\"ALTRE\" \n            amount=\"- 5,00 €\" \n          />\n          <TransactionItem \n            date=\"18.12.2025\" \n            description=\"DOK\" \n            category=\"ALTRE\" \n            amount=\"- 16,06 €\" \n          />\n          <TransactionItem \n            date=\"18.12.2025\" \n            description=\"AL SOLITO POSTO\" \n            category=\"ALTRE\" \n            amount=\"- 4,10 €\" \n          />\n        </View>\n      </ScrollView>\n\n      <Modal visible={showEditName} transparent animationType=\"fade\">\n        <View style={styles.modalOverlay}>\n          <Pressable style={styles.modalBackdrop} onPress={() => setShowEditName(false)} />\n          <View style={styles.modalContent} onStartShouldSetResponder={() => true}>\n            <Text style={styles.modalTitle}>Modifica Nome</Text>\n            <TextInput\n              style={styles.modalInput}\n              value={newName}\n              onChangeText={setNewName}\n              placeholder=\"Nome Cognome\"\n              autoCapitalize=\"words\"\n              autoFocus\n            />\n            <View style={styles.modalButtons}>\n              <Pressable style={styles.modalCancelBtn} onPress={() => setShowEditName(false)}>\n                <Text style={styles.modalCancelText}>Annulla</Text>\n              </Pressable>\n              <Pressable style={styles.modalSaveBtn} onPress={handleSaveName}>\n                <Text style={styles.modalSaveText}>Salva</Text>\n              </Pressable>\n            </View>\n          </View>\n        </View>\n      </Modal>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  header: {\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.xl,\n  },\n  headerTop: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  headerActions: {\n    flexDirection: \"row\",\n    gap: Spacing.lg,\n  },\n  headerAction: {\n    alignItems: \"center\",\n  },\n  headerActionText: {\n    color: BankColors.white,\n    fontSize: 11,\n    marginTop: 2,\n  },\n  pageTitle: {\n    color: BankColors.white,\n    fontSize: 32,\n    fontWeight: \"700\",\n    marginBottom: Spacing.md,\n  },\n  cardSelector: {\n    flexDirection: \"row\",\n    gap: Spacing.sm,\n    marginBottom: Spacing.lg,\n  },\n  cardSelectorBtn: {\n    backgroundColor: \"rgba(255,255,255,0.2)\",\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n    borderRadius: BorderRadius.xl,\n  },\n  cardSelectorText: {\n    color: BankColors.white,\n    fontSize: 13,\n    fontWeight: \"500\",\n  },\n  cardDisplay: {\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  cardVisual: {\n    width: \"90%\",\n    aspectRatio: 1.6,\n    backgroundColor: \"#E3F2FD\",\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.lg,\n    justifyContent: \"space-between\",\n  },\n  cardHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n  },\n  cardBankName: {\n    fontSize: 12,\n    fontWeight: \"600\",\n    color: BankColors.primary,\n    letterSpacing: 1,\n  },\n  cardType: {\n    fontSize: 12,\n    color: BankColors.primary,\n  },\n  cardChip: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  cardContactless: {\n    fontSize: 20,\n    color: BankColors.gray600,\n    transform: [{ rotate: \"90deg\" }],\n  },\n  cardBottom: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"flex-end\",\n  },\n  cardLabel: {\n    fontSize: 10,\n    color: BankColors.gray600,\n  },\n  cardHolderName: {\n    fontSize: 12,\n    fontWeight: \"600\",\n    color: BankColors.gray800,\n  },\n  cardActiveTag: {\n    backgroundColor: \"#4CAF50\",\n    paddingHorizontal: Spacing.sm,\n    paddingVertical: 2,\n    borderRadius: 4,\n    marginTop: 4,\n  },\n  cardActiveText: {\n    color: BankColors.white,\n    fontSize: 10,\n    fontWeight: \"600\",\n  },\n  cardLogos: {\n    alignItems: \"flex-end\",\n    gap: Spacing.xs,\n  },\n  pagoBancomatLogo: {\n    backgroundColor: \"#0066B3\",\n    paddingHorizontal: Spacing.sm,\n    paddingVertical: 2,\n    borderRadius: 4,\n  },\n  pagoBancomatText: {\n    color: BankColors.white,\n    fontSize: 8,\n    fontWeight: \"600\",\n    textAlign: \"center\",\n  },\n  mastercardLogo: {\n    flexDirection: \"row\",\n  },\n  mcCircle: {\n    width: 20,\n    height: 20,\n    borderRadius: 10,\n  },\n  cardDescription: {\n    color: BankColors.white,\n    fontSize: 14,\n    marginTop: Spacing.sm,\n  },\n  quickActionsScroll: {\n    marginHorizontal: -Spacing.lg,\n  },\n  quickActionsContainer: {\n    paddingHorizontal: Spacing.lg,\n    gap: Spacing.sm,\n    flexDirection: \"row\",\n  },\n  quickActionBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: \"rgba(0,0,0,0.2)\",\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n    borderRadius: BorderRadius.xl,\n    gap: Spacing.xs,\n  },\n  quickActionPressed: {\n    backgroundColor: \"rgba(0,0,0,0.3)\",\n  },\n  quickActionLabel: {\n    color: BankColors.white,\n    fontSize: 13,\n    fontWeight: \"500\",\n  },\n  disponibilitaSection: {\n    padding: Spacing.lg,\n  },\n  sectionHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.md,\n  },\n  sectionTitle: {\n    fontSize: 24,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  viewAllBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  viewAllText: {\n    color: BankColors.primary,\n    fontSize: 14,\n  },\n  disponibilitaCard: {\n    backgroundColor: BankColors.gray100,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n  },\n  disponibilitaLabel: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    marginBottom: Spacing.xs,\n  },\n  disponibilitaAmount: {\n    fontSize: 20,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.md,\n  },\n  progressBar: {\n    height: 8,\n    backgroundColor: BankColors.gray300,\n    borderRadius: 4,\n    marginBottom: Spacing.md,\n  },\n  progressFill: {\n    height: \"100%\",\n    backgroundColor: \"#2196F3\",\n    borderRadius: 4,\n  },\n  limitRow: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n  },\n  limitLabel: {\n    fontSize: 14,\n    color: BankColors.gray600,\n  },\n  limitAmount: {\n    fontSize: 14,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  usciteSection: {\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.lg,\n  },\n  usciteCard: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n    borderColor: BankColors.gray200,\n    overflow: \"hidden\",\n    marginTop: Spacing.md,\n  },\n  monthlyItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    padding: Spacing.lg,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  monthlyLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.md,\n  },\n  monthlyIcon: {\n    width: 36,\n    height: 36,\n    borderRadius: 18,\n    backgroundColor: BankColors.gray100,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  monthlyMonth: {\n    fontSize: 16,\n    fontWeight: \"500\",\n    color: BankColors.gray900,\n  },\n  monthlyRight: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  monthlyAmount: {\n    fontSize: 16,\n    fontWeight: \"500\",\n    color: BankColors.gray900,\n  },\n  movimentiSection: {\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.lg,\n  },\n  transactionItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  transactionInfo: {\n    flex: 1,\n  },\n  transactionDate: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  transactionDesc: {\n    fontSize: 15,\n    fontWeight: \"500\",\n    color: BankColors.gray900,\n  },\n  transactionCategory: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  transactionRight: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  transactionAmount: {\n    fontSize: 15,\n    fontWeight: \"500\",\n    color: BankColors.error,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  modalBackdrop: {\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n  },\n  modalContent: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.xl,\n    width: \"85%\",\n    maxWidth: 400,\n    zIndex: 1,\n  },\n  modalTitle: {\n    fontSize: 20,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.lg,\n    textAlign: \"center\",\n  },\n  modalInput: {\n    borderWidth: 1,\n    borderColor: BankColors.gray300,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    fontSize: 18,\n    marginBottom: Spacing.lg,\n  },\n  modalButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  modalCancelBtn: {\n    flex: 1,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    backgroundColor: BankColors.gray200,\n    alignItems: \"center\",\n  },\n  modalCancelText: {\n    color: BankColors.gray700,\n    fontSize: 16,\n    fontWeight: \"500\",\n  },\n  modalSaveBtn: {\n    flex: 1,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n  },\n  modalSaveText: {\n    color: BankColors.white,\n    fontSize: 16,\n    fontWeight: \"500\",\n  },\n});\n","path":null,"size_bytes":17642,"size_tokens":null},"client/components/ThemedText.tsx":{"content":"import { Text, type TextProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Typography } from \"@/constants/theme\";\n\nexport type ThemedTextProps = TextProps & {\n  lightColor?: string;\n  darkColor?: string;\n  type?: \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"body\" | \"small\" | \"link\";\n};\n\nexport function ThemedText({\n  style,\n  lightColor,\n  darkColor,\n  type = \"body\",\n  ...rest\n}: ThemedTextProps) {\n  const { theme, isDark } = useTheme();\n\n  const getColor = () => {\n    if (isDark && darkColor) {\n      return darkColor;\n    }\n\n    if (!isDark && lightColor) {\n      return lightColor;\n    }\n\n    if (type === \"link\") {\n      return theme.link;\n    }\n\n    return theme.text;\n  };\n\n  const getTypeStyle = () => {\n    switch (type) {\n      case \"h1\":\n        return Typography.h1;\n      case \"h2\":\n        return Typography.h2;\n      case \"h3\":\n        return Typography.h3;\n      case \"h4\":\n        return Typography.h4;\n      case \"body\":\n        return Typography.body;\n      case \"small\":\n        return Typography.small;\n      case \"link\":\n        return Typography.link;\n      default:\n        return Typography.body;\n    }\n  };\n\n  return (\n    <Text style={[{ color: getColor() }, getTypeStyle(), style]} {...rest} />\n  );\n}\n","path":null,"size_bytes":1251,"size_tokens":null},"client/navigation/RootStackNavigator.tsx":{"content":"import React from \"react\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\nimport MainTabNavigator from \"@/navigation/MainTabNavigator\";\nimport WelcomeScreen from \"@/screens/WelcomeScreen\";\nimport PinEntryScreen from \"@/screens/PinEntryScreen\";\nimport PinSetupScreen from \"@/screens/PinSetupScreen\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { ActivityIndicator, View, StyleSheet } from \"react-native\";\nimport { BankColors } from \"@/constants/theme\";\n\nexport type RootStackParamList = {\n  Welcome: undefined;\n  PinEntry: undefined;\n  PinSetup: undefined;\n  Main: undefined;\n};\n\nconst Stack = createNativeStackNavigator<RootStackParamList>();\n\nexport default function RootStackNavigator() {\n  const { isAuthenticated, isLoading, userId, needsSetup } = useAuth();\n\n  if (isLoading) {\n    return (\n      <View style={styles.loading}>\n        <ActivityIndicator size=\"large\" color={BankColors.primary} />\n      </View>\n    );\n  }\n\n  return (\n    <Stack.Navigator screenOptions={{ headerShown: false }}>\n      {isAuthenticated ? (\n        <Stack.Screen name=\"Main\" component={MainTabNavigator} />\n      ) : userId && needsSetup ? (\n        <Stack.Screen \n          name=\"PinSetup\" \n          component={PinSetupScreen}\n          options={{ animation: \"slide_from_bottom\" }}\n        />\n      ) : userId ? (\n        <Stack.Screen \n          name=\"PinEntry\" \n          component={PinEntryScreen}\n          options={{ animation: \"slide_from_bottom\" }}\n        />\n      ) : (\n        <Stack.Screen name=\"Welcome\" component={WelcomeScreen} />\n      )}\n    </Stack.Navigator>\n  );\n}\n\nconst styles = StyleSheet.create({\n  loading: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.white,\n  },\n});\n","path":null,"size_bytes":1777,"size_tokens":null},"server/replit_integrations/batch/index.ts":{"content":"export {\n  batchProcess,\n  batchProcessWithSSE,\n  isRateLimitError,\n  type BatchOptions,\n} from \"./utils\";\n\n","path":null,"size_bytes":108,"size_tokens":null},"replit.md":{"content":"# EquisCash (Banca Mobile)\n\n## Overview\n\nEquisCash is a mobile banking application built with React Native and Expo, targeting Android and iOS platforms with Italian language interface. The app provides banking functionality including authentication, account balance viewing, transaction history, and common banking operations like transfers and payments.\n\nThe application follows a client-server architecture with an Express.js backend and PostgreSQL database for data persistence. It's designed to simulate a realistic banking experience with features like PIN-based authentication, transaction generation, and account management.\n\n**Branding Note**: The home screen maintains a similar design aesthetic to professional banking apps for authenticity, while all other screens display the \"EquisCash\" branding. The AI advisor is named \"Assistente EquisCash\".\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React Native with Expo SDK 54\n- **Navigation**: React Navigation with native stack and bottom tab navigators\n- **State Management**: TanStack React Query for server state, React Context for auth state\n- **Styling**: StyleSheet API with a centralized theme system in `client/constants/theme.ts`\n- **Path Aliases**: `@/` maps to `./client`, `@shared/` maps to `./shared`\n\nThe app uses a modular structure:\n- `client/screens/` - Screen components (WelcomeScreen, PinEntryScreen, HomeScreen, etc.)\n- `client/components/` - Reusable UI components (Button, Card, ThemedText, etc.)\n- `client/navigation/` - Navigation configuration\n- `client/lib/` - Authentication context and API client\n- `client/hooks/` - Custom React hooks\n\n### Backend Architecture\n- **Framework**: Express.js with TypeScript\n- **Database ORM**: Drizzle ORM with PostgreSQL\n- **API Pattern**: RESTful endpoints registered in `server/routes.ts`\n- **Storage Layer**: `server/storage.ts` provides database abstraction\n\nKey API capabilities:\n- User authentication (login by username, PIN verification)\n- Transaction management (create, list, generate random transactions)\n- Balance updates\n- AI Financial Advisor chatbot (powered by OpenAI via Replit AI Integrations)\n\n### Authentication Flow\n1. User enters username on WelcomeScreen\n2. Server creates or retrieves user, returns userId\n3. User enters 5-digit PIN on PinEntryScreen\n4. Server verifies PIN and returns full user data\n5. Auth state persisted via AsyncStorage\n\n### Database Schema\nDefined in `shared/schema.ts`:\n- **users**: id, username, pin, fullName, accountNumber, balance, cardLastFour, createdAt\n- **transactions**: id, userId, description, amount, type, category, accountNumber, isContabilizzato, date, createdAt\n- **conversations**: id, userId, title, createdAt (for AI advisor chat)\n- **messages**: id, conversationId, role, content, createdAt (chat messages)\n\nSchema validation uses Drizzle-Zod for type-safe inserts.\n\n### AI Financial Advisor\n- Located in `server/replit_integrations/chat/`\n- Uses OpenAI via Replit AI Integrations (no API key required)\n- Provides personalized financial advice in Italian\n- Accessible from HomeScreen via \"Consulente AI\" quick action\n\n## External Dependencies\n\n### Database\n- **PostgreSQL**: Primary data store, connected via `DATABASE_URL` environment variable\n- **Drizzle ORM**: Database queries and schema management\n- **pg**: Node.js PostgreSQL client\n\n### Frontend Libraries\n- **Expo modules**: expo-blur, expo-haptics, expo-linear-gradient, expo-image, expo-splash-screen\n- **react-native-reanimated**: Animations\n- **react-native-gesture-handler**: Touch handling\n- **react-native-keyboard-controller**: Keyboard-aware components\n- **@tanstack/react-query**: Data fetching and caching\n- **@react-native-async-storage/async-storage**: Local persistence for auth tokens\n\n### Development Tools\n- **tsx**: TypeScript execution for server\n- **drizzle-kit**: Database migrations and schema push\n- **esbuild**: Server bundling for production\n\n### Environment Variables Required\n- `DATABASE_URL`: PostgreSQL connection string\n- `EXPO_PUBLIC_DOMAIN`: API server domain for client requests\n- `REPLIT_DEV_DOMAIN` / `REPLIT_DOMAINS`: Used for CORS configuration\n\n## Security Features\n\n### Anti-Cheat Protections\n- **Server-side balance validation**: All balance checks are performed on the server using database values, never trusting client data\n- **Transaction editing does NOT modify balance**: Users cannot manipulate their balance by editing transaction amounts\n- **Transfer validation**: P2P transfers validate funds server-side, prevent self-transfers, and require integer amounts\n- **Atomic transaction records**: Both sender and receiver get transaction records for audit trail\n\n### Balance Modification Rules\n- Balance can ONLY be changed by:\n  1. Admin top-ups (future feature)\n  2. P2P transfers between users\n  3. Auto-generated transactions (for demo purposes)\n- Editing existing transactions only changes the transaction record, NOT the user's balance\n\n## Admin Panel Features (v2.0)\nThe admin panel at `/admin` now includes:\n- **Ricariche**: Search users by @username and add balance\n- **Utenti**: View all users with sorting (by balance or registration date), block/unblock users, edit balances directly\n- **Scambi**: View all real (non-simulated) P2P transfers between users\n- **Referral**: Manage referral bonus settings and view activation history\n\n### User Management Capabilities\n- Block/unblock users with optional reason\n- Direct balance editing for anti-cheat corrections\n- Sort users by balance (highest first) or registration date (newest first)\n- View total recharged amount per user\n\n## Future Plans (Planned for next month)\n- **Recharge username**: Special username for PayPal.me payments (separate from display name)\n- **Payment tracking**: Database table to track top-up requests and their status","path":null,"size_bytes":5897,"size_tokens":null},"client/hooks/useColorScheme.ts":{"content":"export { useColorScheme } from \"react-native\";\n","path":null,"size_bytes":47,"size_tokens":null},"client/components/Button.tsx":{"content":"import React, { ReactNode } from \"react\";\nimport { StyleSheet, Pressable, ViewStyle, StyleProp } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { BorderRadius, Spacing } from \"@/constants/theme\";\n\ninterface ButtonProps {\n  onPress?: () => void;\n  children: ReactNode;\n  style?: StyleProp<ViewStyle>;\n  disabled?: boolean;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Button({\n  onPress,\n  children,\n  style,\n  disabled = false,\n}: ButtonProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    if (!disabled) {\n      scale.value = withSpring(0.98, springConfig);\n    }\n  };\n\n  const handlePressOut = () => {\n    if (!disabled) {\n      scale.value = withSpring(1, springConfig);\n    }\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={disabled ? undefined : onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      disabled={disabled}\n      style={[\n        styles.button,\n        {\n          backgroundColor: theme.link,\n          opacity: disabled ? 0.5 : 1,\n        },\n        style,\n        animatedStyle,\n      ]}\n    >\n      <ThemedText\n        type=\"body\"\n        style={[styles.buttonText, { color: theme.buttonText }]}\n      >\n        {children}\n      </ThemedText>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  button: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.full,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  buttonText: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":2014,"size_tokens":null},"server/replit_integrations/chat/storage.ts":{"content":"import { db } from \"../../db\";\nimport { conversations, messages } from \"../../../shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\nexport interface IChatStorage {\n  getConversation(id: number): Promise<typeof conversations.$inferSelect | undefined>;\n  getAllConversations(userId?: string): Promise<(typeof conversations.$inferSelect)[]>;\n  createConversation(title: string, userId?: string): Promise<typeof conversations.$inferSelect>;\n  deleteConversation(id: number): Promise<void>;\n  getMessagesByConversation(conversationId: number): Promise<(typeof messages.$inferSelect)[]>;\n  createMessage(conversationId: number, role: string, content: string): Promise<typeof messages.$inferSelect>;\n}\n\nexport const chatStorage: IChatStorage = {\n  async getConversation(id: number) {\n    const [conversation] = await db.select().from(conversations).where(eq(conversations.id, id));\n    return conversation;\n  },\n\n  async getAllConversations(userId?: string) {\n    if (userId) {\n      return db.select().from(conversations).where(eq(conversations.userId, userId)).orderBy(desc(conversations.createdAt));\n    }\n    return db.select().from(conversations).orderBy(desc(conversations.createdAt));\n  },\n\n  async createConversation(title: string, userId?: string) {\n    const [conversation] = await db.insert(conversations).values({ \n      title, \n      userId: userId || null,\n    }).returning();\n    return conversation;\n  },\n\n  async deleteConversation(id: number) {\n    await db.delete(messages).where(eq(messages.conversationId, id));\n    await db.delete(conversations).where(eq(conversations.id, id));\n  },\n\n  async getMessagesByConversation(conversationId: number) {\n    return db.select().from(messages).where(eq(messages.conversationId, conversationId)).orderBy(messages.createdAt);\n  },\n\n  async createMessage(conversationId: number, role: string, content: string) {\n    const [message] = await db.insert(messages).values({ conversationId, role, content }).returning();\n    return message;\n  },\n};\n","path":null,"size_bytes":2000,"size_tokens":null},"eslint.config.js":{"content":"// https://docs.expo.dev/guides/using-eslint/\nconst { defineConfig } = require(\"eslint/config\");\nconst expoConfig = require(\"eslint-config-expo/flat\");\nconst eslintPluginPrettierRecommended = require(\"eslint-plugin-prettier/recommended\");\n\nmodule.exports = defineConfig([\n  expoConfig,\n  eslintPluginPrettierRecommended,\n  {\n    ignores: [\"dist/*\"],\n  },\n]);\n","path":null,"size_bytes":359,"size_tokens":null},"server/storage.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport { eq, desc } from \"drizzle-orm\";\nimport pg from \"pg\";\nimport { \n  users, \n  transactions,\n  userPresetSettings,\n  userCustomPresets,\n  appSettings,\n  referralActivations,\n  conversations,\n  messages,\n  type User, \n  type InsertUser, \n  type Transaction, \n  type InsertTransaction,\n  type UserPresetSettings,\n  type UserCustomPreset,\n  type InsertCustomPreset,\n  type AppSettings,\n  type ReferralActivation\n} from \"@shared/schema\";\n\nconst pool = new pg.Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool);\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByRechargeUsername(rechargeUsername: string): Promise<User | undefined>;\n  getAllUsers(): Promise<User[]>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUserBalance(userId: string, newBalance: string): Promise<User | undefined>;\n  updateUserBalanceWithPurchased(userId: string, newBalance: string, newPurchasedBalance: string): Promise<User | undefined>;\n  updateUserName(userId: string, newName: string): Promise<User | undefined>;\n  updateUserAccountNumber(userId: string, newAccountNumber: string): Promise<User | undefined>;\n  updateUserPin(userId: string, newPin: string): Promise<User | undefined>;\n  setUserRechargeUsername(userId: string, rechargeUsername: string): Promise<User | undefined>;\n  transferBalance(fromUserId: string, toUserId: string, amount: number): Promise<{ success: boolean; error?: string; fromUser?: User; toUser?: User }>;\n  getTransactions(userId: string): Promise<Transaction[]>;\n  getTransaction(id: string): Promise<Transaction | undefined>;\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n  createMultipleTransactions(transactions: InsertTransaction[]): Promise<Transaction[]>;\n  updateTransaction(id: string, updates: { amount?: string; description?: string }): Promise<Transaction | undefined>;\n  deleteUser(userId: string): Promise<boolean>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id));\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.username, username));\n    return result[0];\n  }\n\n  async getUserByRechargeUsername(rechargeUsername: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.rechargeUsername, rechargeUsername));\n    return result[0];\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    const result = await db.select().from(users);\n    return result;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await db.insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  async updateUserBalance(userId: string, newBalance: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ balance: newBalance })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async updateUserBalanceWithPurchased(userId: string, newBalance: string, newPurchasedBalance: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ balance: newBalance, purchasedBalance: newPurchasedBalance })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async updateUserName(userId: string, newName: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ fullName: newName })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async updateUserAccountNumber(userId: string, newAccountNumber: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ accountNumber: newAccountNumber })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async updateUserPin(userId: string, newPin: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ pin: newPin, hasSetPin: true })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async setUserRechargeUsername(userId: string, rechargeUsername: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ rechargeUsername })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async transferBalance(fromUserId: string, toUserId: string, amount: number): Promise<{ success: boolean; error?: string; fromUser?: User; toUser?: User }> {\n    const fromUser = await this.getUser(fromUserId);\n    const toUser = await this.getUser(toUserId);\n\n    if (!fromUser) {\n      return { success: false, error: \"Utente mittente non trovato\" };\n    }\n    if (!toUser) {\n      return { success: false, error: \"Utente destinatario non trovato\" };\n    }\n    if (fromUserId === toUserId) {\n      return { success: false, error: \"Non puoi trasferire denaro a te stesso\" };\n    }\n\n    const fromBalance = parseFloat(fromUser.balance || \"0\");\n    const toBalance = parseFloat(toUser.balance || \"0\");\n\n    if (amount <= 0) {\n      return { success: false, error: \"L'importo deve essere maggiore di zero\" };\n    }\n    if (amount > fromBalance) {\n      return { success: false, error: \"Saldo insufficiente\" };\n    }\n\n    const newFromBalance = (fromBalance - amount).toFixed(2);\n    const newToBalance = (toBalance + amount).toFixed(2);\n\n    const updatedFromUser = await this.updateUserBalance(fromUserId, newFromBalance);\n    const updatedToUser = await this.updateUserBalance(toUserId, newToBalance);\n\n    if (!updatedFromUser || !updatedToUser) {\n      return { success: false, error: \"Errore durante il trasferimento\" };\n    }\n\n    return { success: true, fromUser: updatedFromUser, toUser: updatedToUser };\n  }\n\n  async getTransactions(userId: string): Promise<Transaction[]> {\n    const result = await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.userId, userId))\n      .orderBy(desc(transactions.createdAt));\n    return result;\n  }\n\n  async getTransaction(id: string): Promise<Transaction | undefined> {\n    const result = await db.select().from(transactions).where(eq(transactions.id, id));\n    return result[0];\n  }\n\n  async createTransaction(insertTransaction: InsertTransaction): Promise<Transaction> {\n    const result = await db.insert(transactions).values(insertTransaction).returning();\n    return result[0];\n  }\n\n  async createMultipleTransactions(insertTransactions: InsertTransaction[]): Promise<Transaction[]> {\n    if (insertTransactions.length === 0) return [];\n    const result = await db.insert(transactions).values(insertTransactions).returning();\n    return result;\n  }\n\n  async updateTransaction(id: string, updates: { amount?: string; description?: string }): Promise<Transaction | undefined> {\n    const result = await db\n      .update(transactions)\n      .set(updates)\n      .where(eq(transactions.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteUser(userId: string): Promise<boolean> {\n    try {\n      // Delete all related data first (foreign key constraints)\n      // 1. Get all conversations for user and delete their messages\n      const userConversations = await db.select().from(conversations).where(eq(conversations.userId, userId));\n      for (const conv of userConversations) {\n        await db.delete(messages).where(eq(messages.conversationId, conv.id));\n      }\n      // 2. Delete conversations\n      await db.delete(conversations).where(eq(conversations.userId, userId));\n      // 3. Delete transactions\n      await db.delete(transactions).where(eq(transactions.userId, userId));\n      // 4. Delete preset settings\n      await db.delete(userPresetSettings).where(eq(userPresetSettings.userId, userId));\n      // 5. Delete custom presets\n      await db.delete(userCustomPresets).where(eq(userCustomPresets.userId, userId));\n      // 6. Finally delete the user\n      await db.delete(users).where(eq(users.id, userId));\n      return true;\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      return false;\n    }\n  }\n\n  async getPresetSettings(userId: string): Promise<UserPresetSettings | undefined> {\n    const result = await db.select().from(userPresetSettings).where(eq(userPresetSettings.userId, userId));\n    return result[0];\n  }\n\n  async savePresetSettings(userId: string, settings: { deletedPresets?: string[]; disabledPresets?: string[]; customPresets?: any[] }): Promise<UserPresetSettings> {\n    const existing = await this.getPresetSettings(userId);\n    if (existing) {\n      const result = await db\n        .update(userPresetSettings)\n        .set({\n          deletedPresets: settings.deletedPresets ? JSON.stringify(settings.deletedPresets) : existing.deletedPresets,\n          disabledPresets: settings.disabledPresets ? JSON.stringify(settings.disabledPresets) : existing.disabledPresets,\n          customPresets: settings.customPresets ? JSON.stringify(settings.customPresets) : existing.customPresets,\n        })\n        .where(eq(userPresetSettings.userId, userId))\n        .returning();\n      return result[0];\n    } else {\n      const result = await db\n        .insert(userPresetSettings)\n        .values({\n          userId,\n          deletedPresets: JSON.stringify(settings.deletedPresets || []),\n          disabledPresets: JSON.stringify(settings.disabledPresets || []),\n          customPresets: JSON.stringify(settings.customPresets || []),\n        })\n        .returning();\n      return result[0];\n    }\n  }\n\n  async getAppSetting(key: string): Promise<string | null> {\n    const result = await db.select().from(appSettings).where(eq(appSettings.key, key));\n    return result[0]?.value ?? null;\n  }\n\n  async setAppSetting(key: string, value: string): Promise<void> {\n    const existing = await db.select().from(appSettings).where(eq(appSettings.key, key));\n    if (existing.length > 0) {\n      await db.update(appSettings).set({ value }).where(eq(appSettings.key, key));\n    } else {\n      await db.insert(appSettings).values({ key, value });\n    }\n  }\n\n  async updateUserReferredBy(userId: string, referredBy: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ referredBy })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async updateUserTotalRecharged(userId: string, amount: number): Promise<User | undefined> {\n    const user = await this.getUser(userId);\n    if (!user) return undefined;\n    const currentTotal = parseFloat(user.totalRecharged || \"0\");\n    const newTotal = (currentTotal + amount).toFixed(2);\n    const result = await db\n      .update(users)\n      .set({ totalRecharged: newTotal })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async activateReferral(userId: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ referralActivated: true })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async createReferralActivation(referrerId: string, referredId: string, bonusAmount: number): Promise<ReferralActivation> {\n    const result = await db.insert(referralActivations).values({\n      referrerId,\n      referredId,\n      bonusAmount: bonusAmount.toFixed(2),\n    }).returning();\n    return result[0];\n  }\n\n  async getReferralActivations(): Promise<(ReferralActivation & { referrerUsername?: string; referredUsername?: string })[]> {\n    const activations = await db.select().from(referralActivations).orderBy(desc(referralActivations.activatedAt));\n    const result = [];\n    for (const activation of activations) {\n      const referrer = await this.getUser(activation.referrerId);\n      const referred = await this.getUser(activation.referredId);\n      result.push({\n        ...activation,\n        referrerUsername: referrer?.username,\n        referredUsername: referred?.username,\n      });\n    }\n    return result;\n  }\n\n  async getUserByReferralCode(referralCode: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.username, referralCode));\n    return result[0];\n  }\n\n  async blockUser(userId: string, reason?: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ isBlocked: true, blockedReason: reason || null })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async unblockUser(userId: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ isBlocked: false, blockedReason: null })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async setUserBalance(userId: string, newBalance: string): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ balance: newBalance })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async getTransferHistory(): Promise<Transaction[]> {\n    const result = await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.isSimulated, false))\n      .orderBy(desc(transactions.createdAt));\n    return result;\n  }\n\n  async getAllUsersSorted(sortBy: 'balance' | 'newest'): Promise<User[]> {\n    if (sortBy === 'balance') {\n      const result = await db.select().from(users).orderBy(desc(users.balance));\n      return result;\n    } else {\n      const result = await db.select().from(users).orderBy(desc(users.createdAt));\n      return result;\n    }\n  }\n\n  // Custom Presets CRUD\n  async getCustomPresets(userId: string): Promise<UserCustomPreset[]> {\n    const result = await db\n      .select()\n      .from(userCustomPresets)\n      .where(eq(userCustomPresets.userId, userId))\n      .orderBy(desc(userCustomPresets.createdAt));\n    return result;\n  }\n\n  async getCustomPreset(id: number): Promise<UserCustomPreset | undefined> {\n    const result = await db.select().from(userCustomPresets).where(eq(userCustomPresets.id, id));\n    return result[0];\n  }\n\n  async createCustomPreset(preset: InsertCustomPreset): Promise<UserCustomPreset> {\n    const result = await db.insert(userCustomPresets).values(preset).returning();\n    return result[0];\n  }\n\n  async updateCustomPreset(id: number, updates: Partial<InsertCustomPreset>): Promise<UserCustomPreset | undefined> {\n    const result = await db\n      .update(userCustomPresets)\n      .set(updates)\n      .where(eq(userCustomPresets.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteCustomPreset(id: number): Promise<boolean> {\n    const result = await db.delete(userCustomPresets).where(eq(userCustomPresets.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async triggerPresetTransaction(userId: string, presetId: number): Promise<{ success: boolean; error?: string; transaction?: Transaction; user?: User }> {\n    const preset = await this.getCustomPreset(presetId);\n    if (!preset) {\n      return { success: false, error: \"Preset non trovato\" };\n    }\n    if (preset.userId !== userId) {\n      return { success: false, error: \"Preset non autorizzato\" };\n    }\n\n    const user = await this.getUser(userId);\n    if (!user) {\n      return { success: false, error: \"Utente non trovato\" };\n    }\n\n    // Calculate random amount within range\n    const amount = Math.floor(Math.random() * (preset.maxAmount - preset.minAmount + 1)) + preset.minAmount;\n    \n    const currentBalance = parseFloat(user.balance || \"0\");\n    const currentPurchased = parseFloat(user.purchasedBalance || \"0\");\n\n    if (preset.type === \"expense\") {\n      if (amount > currentBalance) {\n        return { success: false, error: \"Saldo insufficiente\" };\n      }\n      \n      const newBalance = (currentBalance - amount).toFixed(2);\n      const newPurchased = Math.max(0, currentPurchased - amount).toFixed(2);\n\n      // Update balance atomically\n      const updatedUser = await this.updateUserBalanceWithPurchased(userId, newBalance, newPurchased);\n\n      // Create transaction record\n      const transaction = await this.createTransaction({\n        userId,\n        description: preset.description,\n        amount: (-amount).toString(),\n        type: \"expense\",\n        category: preset.category,\n        isContabilizzato: true,\n        isSimulated: true,\n      });\n\n      return { success: true, transaction, user: updatedUser };\n    } else {\n      // Income - add to balance\n      const newBalance = (currentBalance + amount).toFixed(2);\n      const newPurchased = (currentPurchased + amount).toFixed(2);\n\n      const updatedUser = await this.updateUserBalanceWithPurchased(userId, newBalance, newPurchased);\n\n      const transaction = await this.createTransaction({\n        userId,\n        description: preset.description,\n        amount: amount.toString(),\n        type: \"income\",\n        category: preset.category,\n        isContabilizzato: true,\n        isSimulated: true,\n      });\n\n      return { success: true, transaction, user: updatedUser };\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":17274,"size_tokens":null},"client/lib/query-client.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n/**\n * Gets the base URL for the Express API server (e.g., \"http://localhost:3000\")\n * @returns {string} The API base URL\n */\nexport function getApiUrl(): string {\n  let host = process.env.EXPO_PUBLIC_DOMAIN;\n\n  if (!host) {\n    throw new Error(\"EXPO_PUBLIC_DOMAIN is not set\");\n  }\n\n  let url = new URL(`https://${host}`);\n\n  return url.href;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  route: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const baseUrl = getApiUrl();\n  const url = new URL(route, baseUrl);\n\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const baseUrl = getApiUrl();\n    const url = new URL(queryKey.join(\"/\") as string, baseUrl);\n\n    const res = await fetch(url, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1876,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, decimal, timestamp, boolean, serial, integer } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  rechargeUsername: text(\"recharge_username\").unique(),\n  pin: text(\"pin\").notNull(),\n  hasSetPin: boolean(\"has_set_pin\").notNull().default(false),\n  fullName: text(\"full_name\").notNull(),\n  accountNumber: text(\"account_number\").notNull(),\n  balance: decimal(\"balance\", { precision: 12, scale: 2 }).notNull().default(\"0.00\"),\n  purchasedBalance: decimal(\"purchased_balance\", { precision: 12, scale: 2 }).notNull().default(\"0.00\"),\n  totalRecharged: decimal(\"total_recharged\", { precision: 12, scale: 2 }).notNull().default(\"0.00\"),\n  referredBy: varchar(\"referred_by\"),\n  referralActivated: boolean(\"referral_activated\").notNull().default(false),\n  cardLastFour: text(\"card_last_four\").notNull().default(\"3796\"),\n  isBlocked: boolean(\"is_blocked\").notNull().default(false),\n  blockedReason: text(\"blocked_reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const transactions = pgTable(\"transactions\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  description: text(\"description\").notNull(),\n  amount: decimal(\"amount\", { precision: 12, scale: 2 }).notNull(),\n  type: text(\"type\").notNull(),\n  category: text(\"category\").notNull(),\n  accountNumber: text(\"account_number\"),\n  isContabilizzato: boolean(\"is_contabilizzato\").notNull().default(false),\n  isSimulated: boolean(\"is_simulated\").notNull().default(true),\n  date: timestamp(\"date\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  rechargeUsername: true,\n  pin: true,\n  hasSetPin: true,\n  fullName: true,\n  accountNumber: true,\n  balance: true,\n  purchasedBalance: true,\n  cardLastFour: true,\n});\n\nexport const insertTransactionSchema = createInsertSchema(transactions).pick({\n  userId: true,\n  description: true,\n  amount: true,\n  type: true,\n  category: true,\n  accountNumber: true,\n  isContabilizzato: true,\n  isSimulated: true,\n  date: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type Transaction = typeof transactions.$inferSelect;\n\n// Chat tables for AI financial advisor\nexport const conversations = pgTable(\"conversations\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  title: text(\"title\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  conversationId: integer(\"conversation_id\").notNull().references(() => conversations.id, { onDelete: \"cascade\" }),\n  role: text(\"role\").notNull(),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Conversation = typeof conversations.$inferSelect;\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\n// User preset settings table (for deleted/disabled defaults)\nexport const userPresetSettings = pgTable(\"user_preset_settings\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  deletedPresets: text(\"deleted_presets\").notNull().default(\"[]\"),\n  disabledPresets: text(\"disabled_presets\").notNull().default(\"[]\"),\n  customPresets: text(\"custom_presets\").notNull().default(\"[]\"),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport type UserPresetSettings = typeof userPresetSettings.$inferSelect;\n\n// User custom presets table (normalized, persistent)\nexport const userCustomPresets = pgTable(\"user_custom_presets\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  description: text(\"description\").notNull(),\n  type: text(\"type\").notNull().default(\"expense\"),\n  category: text(\"category\").notNull(),\n  minAmount: integer(\"min_amount\").notNull(),\n  maxAmount: integer(\"max_amount\").notNull(),\n  isEnabled: boolean(\"is_enabled\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport const insertCustomPresetSchema = createInsertSchema(userCustomPresets).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type UserCustomPreset = typeof userCustomPresets.$inferSelect;\nexport type InsertCustomPreset = z.infer<typeof insertCustomPresetSchema>;\n\n// App settings table for admin configuration\nexport const appSettings = pgTable(\"app_settings\", {\n  id: serial(\"id\").primaryKey(),\n  key: text(\"key\").notNull().unique(),\n  value: text(\"value\").notNull(),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport type AppSettings = typeof appSettings.$inferSelect;\n\n// Referral activations tracking\nexport const referralActivations = pgTable(\"referral_activations\", {\n  id: serial(\"id\").primaryKey(),\n  referrerId: varchar(\"referrer_id\").notNull().references(() => users.id),\n  referredId: varchar(\"referred_id\").notNull().references(() => users.id),\n  bonusAmount: decimal(\"bonus_amount\", { precision: 12, scale: 2 }).notNull(),\n  activatedAt: timestamp(\"activated_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport type ReferralActivation = typeof referralActivations.$inferSelect;\n","path":null,"size_bytes":6120,"size_tokens":null},"server/replit_integrations/chat/index.ts":{"content":"export { registerChatRoutes } from \"./routes\";\nexport { chatStorage, type IChatStorage } from \"./storage\";\n\n","path":null,"size_bytes":108,"size_tokens":null},"client/App.tsx":{"content":"import React from \"react\";\nimport { StyleSheet } from \"react-native\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\nimport { KeyboardProvider } from \"react-native-keyboard-controller\";\nimport { SafeAreaProvider } from \"react-native-safe-area-context\";\nimport { StatusBar } from \"expo-status-bar\";\n\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/query-client\";\n\nimport { AuthProvider } from \"@/lib/auth-context\";\nimport RootStackNavigator from \"@/navigation/RootStackNavigator\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { SecurityCheck } from \"@/components/SecurityCheck\";\n\nexport default function App() {\n  return (\n    <ErrorBoundary>\n      <SecurityCheck>\n        <QueryClientProvider client={queryClient}>\n          <AuthProvider>\n            <SafeAreaProvider>\n              <GestureHandlerRootView style={styles.root}>\n                <KeyboardProvider>\n                  <NavigationContainer>\n                    <RootStackNavigator />\n                  </NavigationContainer>\n                  <StatusBar style=\"auto\" />\n                </KeyboardProvider>\n              </GestureHandlerRootView>\n            </SafeAreaProvider>\n          </AuthProvider>\n        </QueryClientProvider>\n      </SecurityCheck>\n    </ErrorBoundary>\n  );\n}\n\nconst styles = StyleSheet.create({\n  root: {\n    flex: 1,\n  },\n});\n","path":null,"size_bytes":1476,"size_tokens":null},"client/screens/HomeScreen.tsx":{"content":"import React, { useState, useCallback } from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  StyleSheet,\n  RefreshControl,\n  TextInput,\n  Modal,\n  ActivityIndicator,\n  Linking,\n  Alert,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { LinearGradient } from \"expo-linear-gradient\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport * as Haptics from \"expo-haptics\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { apiRequest } from \"@/lib/query-client\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport type { Transaction } from \"@shared/schema\";\nimport type { HomeStackParamList } from \"@/navigation/MainTabNavigator\";\n\ntype HomeScreenNavigationProp = NativeStackNavigationProp<HomeStackParamList, \"HomeMain\">;\n\nconst QuickActionButton = ({ \n  icon, \n  label, \n  onPress \n}: { \n  icon: string; \n  label: string; \n  onPress?: () => void;\n}) => (\n  <Pressable \n    style={({ pressed }) => [styles.quickActionBtn, pressed && styles.quickActionPressed]}\n    onPress={onPress}\n  >\n    <Icon name={icon} size={18} color={BankColors.white} />\n    <Text style={styles.quickActionLabel}>{label}</Text>\n  </Pressable>\n);\n\nconst TransactionItem = ({ transaction, onPress }: { transaction: Transaction; onPress: () => void }) => {\n  const isExpense = transaction.type === \"expense\";\n  const amountValue = Math.abs(parseFloat(transaction.amount));\n  const formattedAmount = `${isExpense ? \"-\" : \"+\"} ${amountValue.toFixed(2).replace(\".\", \",\")} \\u20AC`;\n  const dateStr = transaction.date ? new Date(transaction.date).toLocaleDateString(\"it-IT\", {\n    day: \"2-digit\",\n    month: \"2-digit\",\n    year: \"numeric\",\n  }) : \"\";\n\n  return (\n    <Pressable style={styles.transactionItem} onPress={onPress}>\n      <View style={styles.transactionIcon}>\n        <Icon \n          name={isExpense ? \"arrow-down-left\" : \"arrow-up-right\"} \n          size={20} \n          color={BankColors.gray600} \n        />\n      </View>\n      <View style={styles.transactionInfo}>\n        <Text style={styles.transactionDate}>{dateStr}</Text>\n        <Text style={styles.transactionDesc}>{transaction.description}</Text>\n        {transaction.accountNumber ? (\n          <Text style={styles.transactionAccount}>{transaction.accountNumber}</Text>\n        ) : null}\n      </View>\n      <View style={styles.transactionAmountContainer}>\n        {!transaction.isContabilizzato ? (\n          <Text style={styles.nonContabilizzato}>NON CONTABILIZZATO</Text>\n        ) : null}\n        <View style={styles.transactionAmountRow}>\n          <Text style={[styles.transactionAmount, isExpense && styles.expenseAmount]}>\n            {formattedAmount}\n          </Text>\n          <Icon name=\"chevron-right\" size={20} color={BankColors.gray400} />\n        </View>\n      </View>\n    </Pressable>\n  );\n};\n\nexport default function HomeScreen() {\n  const insets = useSafeAreaInsets();\n  const tabBarHeight = useBottomTabBarHeight();\n  const navigation = useNavigation<HomeScreenNavigationProp>();\n  const queryClient = useQueryClient();\n  const { user, userId, refreshUser, updateBalance, updateAccountNumber } = useAuth();\n  const [showBalance, setShowBalance] = useState(false);\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [showEditBalance, setShowEditBalance] = useState(false);\n  const [newBalance, setNewBalance] = useState(\"\");\n  const [showEditAccount, setShowEditAccount] = useState(false);\n  const [newAccountNumber, setNewAccountNumber] = useState(\"\");\n  const [showWeeklyHistory, setShowWeeklyHistory] = useState(false);\n\n  const { data: transactions = [], isLoading: loadingTransactions } = useQuery<Transaction[]>({\n    queryKey: [\"/api/transactions\", userId],\n    enabled: !!userId,\n  });\n\n  const generateTransactionsMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/transactions/${userId}/generate-random`);\n      return response.json();\n    },\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({ queryKey: [\"/api/transactions\", userId] });\n      await refreshUser();\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    },\n  });\n\n  const handleHelpPress = () => {\n    if (!userId) return;\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    generateTransactionsMutation.mutate();\n  };\n\n  const handleRefresh = useCallback(async () => {\n    setIsRefreshing(true);\n    await refreshUser();\n    await queryClient.invalidateQueries({ queryKey: [\"/api/transactions\", userId] });\n    setIsRefreshing(false);\n  }, [refreshUser, queryClient, userId]);\n\n  const handleToggleBalance = () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    setShowBalance(!showBalance);\n  };\n\n  const handleOpenPayPal = async () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    const paypalUrl = \"https://paypal.me/Rintech/1\";\n    try {\n      const supported = await Linking.canOpenURL(paypalUrl);\n      if (supported) {\n        await Linking.openURL(paypalUrl);\n      } else {\n        Alert.alert(\"Errore\", \"Impossibile aprire il link PayPal\");\n      }\n    } catch (error) {\n      Alert.alert(\"Errore\", \"Si e verificato un errore nell'apertura del link\");\n    }\n  };\n\n  const handleEditBalance = () => {\n    setNewBalance(user?.balance || \"0\");\n    setShowEditBalance(true);\n  };\n\n  const handleSaveBalance = async () => {\n    const value = newBalance.replace(\",\", \".\");\n    if (!isNaN(parseFloat(value))) {\n      await updateBalance(value);\n      setShowEditBalance(false);\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n  };\n\n  const handleEditAccountNumber = () => {\n    setNewAccountNumber(user?.accountNumber || \"\");\n    setShowEditAccount(true);\n  };\n\n  const handleSaveAccountNumber = async () => {\n    if (newAccountNumber.trim()) {\n      await updateAccountNumber(newAccountNumber.trim());\n      setShowEditAccount(false);\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n  };\n\n  const formatBalance = (balance: string) => {\n    const num = parseFloat(balance);\n    const [integer, decimal] = num.toFixed(2).split(\".\");\n    return { integer: integer.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\"), decimal };\n  };\n\n  const balanceFormatted = user?.balance ? formatBalance(user.balance) : { integer: \"0\", decimal: \"00\" };\n\n  const totalExpenses = transactions\n    .filter(t => t.type === \"expense\")\n    .reduce((sum, t) => sum + Math.abs(parseFloat(t.amount)), 0);\n\n  const totalIncome = transactions\n    .filter(t => t.type === \"income\")\n    .reduce((sum, t) => sum + parseFloat(t.amount), 0);\n\n  // Filter transactions from last 7 days\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n  const weeklyTransactions = transactions.filter(t => {\n    if (!t.date) return false;\n    const txDate = new Date(t.date);\n    return txDate >= sevenDaysAgo;\n  });\n\n  const formatTransactionDate = (dateStr: string | Date) => {\n    const date = new Date(dateStr);\n    const today = new Date();\n    const yesterday = new Date();\n    yesterday.setDate(yesterday.getDate() - 1);\n    \n    if (date.toDateString() === today.toDateString()) return \"Oggi\";\n    if (date.toDateString() === yesterday.toDateString()) return \"Ieri\";\n    return date.toLocaleDateString(\"it-IT\", { day: \"numeric\", month: \"short\" });\n  };\n\n  return (\n    <View style={styles.container}>\n      <ScrollView\n        style={styles.scrollView}\n        contentContainerStyle={{ paddingBottom: tabBarHeight + Spacing.xl }}\n        refreshControl={\n          <RefreshControl refreshing={isRefreshing} onRefresh={handleRefresh} />\n        }\n        scrollIndicatorInsets={{ bottom: insets.bottom }}\n      >\n        <LinearGradient\n          colors={[BankColors.primaryLight, BankColors.primary, BankColors.primaryDark]}\n          style={[styles.header, { paddingTop: insets.top + Spacing.md }]}\n        >\n          <View style={styles.headerTop}>\n            <Pressable style={styles.headerBackBtn}>\n              <Icon name=\"chevron-left\" size={24} color={BankColors.white} />\n              <Text style={styles.headerBackText}>Il mio patrimonio</Text>\n            </Pressable>\n            <View style={styles.headerActions}>\n              <Pressable style={styles.headerAction}>\n                <Icon name=\"search\" size={22} color={BankColors.white} />\n                <Text style={styles.headerActionText}>Cerca</Text>\n              </Pressable>\n              <Pressable style={styles.headerAction} onPress={handleHelpPress}>\n                {generateTransactionsMutation.isPending ? (\n                  <ActivityIndicator size=\"small\" color={BankColors.white} />\n                ) : (\n                  <Icon name=\"help-circle\" size={22} color={BankColors.white} />\n                )}\n                <Text style={styles.headerActionText}>Aiuto</Text>\n              </Pressable>\n            </View>\n          </View>\n\n          <View style={styles.greetingContainer}>\n            <Text style={styles.greeting}>Ciao {user?.username || \"Utente\"}</Text>\n            <Pressable>\n              <Text style={styles.personalizeLink}>Personalizza</Text>\n            </Pressable>\n          </View>\n\n          <Pressable onPress={handleEditAccountNumber}>\n            <Text style={styles.accountNumber}>Conto {user?.accountNumber || \"1000/00002521\"}</Text>\n          </Pressable>\n\n          <Pressable style={styles.balanceRow} onPress={handleOpenPayPal} onLongPress={handleEditBalance}>\n            {showBalance ? (\n              <Text style={styles.balanceAmount}>\n                {balanceFormatted.integer}<Text style={styles.balanceDecimal}>,{balanceFormatted.decimal}</Text> {\"\\u20AC\"}\n              </Text>\n            ) : (\n              <Text style={styles.balanceAmount}>******* {\"\\u20AC\"}</Text>\n            )}\n            <Pressable style={styles.showHideBtn} onPress={handleToggleBalance}>\n              <Icon \n                name={showBalance ? \"eye-off\" : \"eye\"} \n                size={20} \n                color={BankColors.white} \n              />\n              <Text style={styles.showHideText}>{showBalance ? \"Nascondi\" : \"Mostra\"}</Text>\n            </Pressable>\n          </Pressable>\n\n          <Pressable onPress={handleEditBalance}>\n            <Text style={styles.detailLink}>Dettaglio</Text>\n          </Pressable>\n\n          <ScrollView \n            horizontal \n            showsHorizontalScrollIndicator={false}\n            style={styles.quickActionsScroll}\n            contentContainerStyle={styles.quickActionsContainer}\n          >\n            <QuickActionButton icon=\"send\" label=\"Bonifico\" />\n            <QuickActionButton icon=\"credit-card\" label=\"Carta virtuale\" />\n            <QuickActionButton icon=\"file-text\" label=\"CBILL/pagoPA\" />\n            <QuickActionButton icon=\"smartphone\" label=\"Ricarica\" />\n            <QuickActionButton icon=\"message-circle\" label=\"Consulente AI\" onPress={() => navigation.navigate(\"Advisor\")} />\n            <QuickActionButton icon=\"rss\" label=\"Notizie\" onPress={() => navigation.navigate(\"News\")} />\n          </ScrollView>\n        </LinearGradient>\n\n        <View style={styles.movimentiSection}>\n          <View style={styles.sectionHeader}>\n            <Text style={styles.sectionTitle}>Movimenti</Text>\n            <Pressable style={styles.viewAllBtn} onPress={() => setShowWeeklyHistory(true)}>\n              <Text style={styles.viewAllText}>Visualizza tutti</Text>\n              <Icon name=\"chevron-right\" size={16} color={BankColors.primary} />\n            </Pressable>\n          </View>\n\n          <View style={styles.expenseSummary}>\n            <Text style={styles.expenseSummaryLabel}>Uscite nei prossimi 30 giorni:</Text>\n            <Text style={styles.expenseSummaryAmount}>- {totalExpenses.toFixed(2).replace(\".\", \",\")} {\"\\u20AC\"}</Text>\n            <Text style={styles.expenseSummaryCount}>{transactions.filter(t => t.type === \"expense\").length} operazione</Text>\n            <Pressable onPress={() => setShowWeeklyHistory(true)}>\n              <Text style={styles.detailLinkGreen}>Dettagli</Text>\n            </Pressable>\n          </View>\n\n          {loadingTransactions ? (\n            <ActivityIndicator style={styles.loader} color={BankColors.primary} />\n          ) : (\n            transactions.slice(0, 5).map((transaction) => (\n              <TransactionItem \n                key={transaction.id} \n                transaction={transaction} \n                onPress={() => navigation.navigate(\"TransactionDetail\", { transaction })}\n              />\n            ))\n          )}\n        </View>\n\n        <View style={styles.analisiSection}>\n          <View style={styles.sectionHeader}>\n            <Text style={styles.sectionTitle}>Analisi delle spese</Text>\n            <Pressable style={styles.viewAllBtn} onPress={() => navigation.navigate(\"Analisi\")}>\n              <Text style={styles.viewAllText}>Vai alla sezione</Text>\n              <Icon name=\"chevron-right\" size={16} color={BankColors.primary} />\n            </Pressable>\n          </View>\n\n          <View style={styles.analisiCard}>\n            <View style={styles.analisiRow}>\n              <Text style={styles.analisiLabel}>Uscite del mese</Text>\n              <View style={styles.analisiAmountRow}>\n                <Text style={styles.analisiAmountNegative}>\n                  - {totalExpenses.toFixed(2).replace(\".\", \",\").replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")} {\"\\u20AC\"}\n                </Text>\n                <Icon name=\"arrow-down\" size={16} color={BankColors.error} />\n              </View>\n            </View>\n            <View style={styles.analisiDivider} />\n            <View style={styles.analisiRow}>\n              <Text style={styles.analisiLabel}>Entrate del mese</Text>\n              <View style={styles.analisiAmountRow}>\n                <Text style={styles.analisiAmountPositive}>\n                  + {totalIncome.toFixed(2).replace(\".\", \",\").replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")} {\"\\u20AC\"}\n                </Text>\n                <Icon name=\"arrow-up\" size={16} color={BankColors.success} />\n              </View>\n            </View>\n          </View>\n        </View>\n      </ScrollView>\n\n      <Modal visible={showEditBalance} transparent animationType=\"fade\">\n        <View style={styles.modalOverlay}>\n          <Pressable style={styles.modalBackdrop} onPress={() => setShowEditBalance(false)} />\n          <View style={styles.modalContent} onStartShouldSetResponder={() => true}>\n            <Text style={styles.modalTitle}>Modifica Saldo</Text>\n            <TextInput\n              style={styles.modalInput}\n              value={newBalance}\n              onChangeText={setNewBalance}\n              keyboardType=\"decimal-pad\"\n              placeholder=\"0.00\"\n              autoFocus\n            />\n            <View style={styles.modalButtons}>\n              <Pressable style={styles.modalCancelBtn} onPress={() => setShowEditBalance(false)}>\n                <Text style={styles.modalCancelText}>Annulla</Text>\n              </Pressable>\n              <Pressable style={styles.modalSaveBtn} onPress={handleSaveBalance}>\n                <Text style={styles.modalSaveText}>Salva</Text>\n              </Pressable>\n            </View>\n          </View>\n        </View>\n      </Modal>\n\n      <Modal visible={showEditAccount} transparent animationType=\"fade\">\n        <View style={styles.modalOverlay}>\n          <Pressable style={styles.modalBackdrop} onPress={() => setShowEditAccount(false)} />\n          <View style={styles.modalContent} onStartShouldSetResponder={() => true}>\n            <Text style={styles.modalTitle}>Modifica Numero Conto</Text>\n            <TextInput\n              style={styles.modalInput}\n              value={newAccountNumber}\n              onChangeText={setNewAccountNumber}\n              placeholder=\"1000/00002521\"\n              autoFocus\n            />\n            <View style={styles.modalButtons}>\n              <Pressable style={styles.modalCancelBtn} onPress={() => setShowEditAccount(false)}>\n                <Text style={styles.modalCancelText}>Annulla</Text>\n              </Pressable>\n              <Pressable style={styles.modalSaveBtn} onPress={handleSaveAccountNumber}>\n                <Text style={styles.modalSaveText}>Salva</Text>\n              </Pressable>\n            </View>\n          </View>\n        </View>\n      </Modal>\n\n      <Modal visible={showWeeklyHistory} animationType=\"slide\">\n        <View style={styles.weeklyModalContainer}>\n          <View style={styles.weeklyModalHeader}>\n            <Pressable onPress={() => setShowWeeklyHistory(false)} style={styles.weeklyCloseBtn}>\n              <Icon name=\"x\" size={24} color={BankColors.gray800} />\n            </Pressable>\n            <Text style={styles.weeklyModalTitle}>Movimenti Settimanali</Text>\n            <View style={{ width: 24 }} />\n          </View>\n\n          <ScrollView style={styles.weeklyScrollView} contentContainerStyle={styles.weeklyScrollContent}>\n            <Text style={styles.weeklyLabel}>TRANSAZIONI ULTIMI 7 GIORNI</Text>\n            \n            {weeklyTransactions.length === 0 ? (\n              <View style={styles.weeklyEmptyState}>\n                <Icon name=\"inbox\" size={48} color={BankColors.gray400} />\n                <Text style={styles.weeklyEmptyText}>Nessuna transazione questa settimana</Text>\n              </View>\n            ) : (\n              weeklyTransactions.map((transaction) => {\n                const isExpense = transaction.type === \"expense\";\n                const amountValue = Math.abs(parseFloat(transaction.amount));\n                const formattedAmount = `${isExpense ? \"-\" : \"+\"} ${amountValue.toFixed(2).replace(\".\", \",\").replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")} \\u20AC`;\n                \n                return (\n                  <Pressable \n                    key={transaction.id} \n                    style={styles.weeklyTransRow}\n                    onPress={() => {\n                      setShowWeeklyHistory(false);\n                      navigation.navigate(\"TransactionDetail\", { transaction });\n                    }}\n                  >\n                    <View style={styles.weeklyIconCircle}>\n                      <Icon \n                        name={isExpense ? \"arrow-down-left\" : \"arrow-up-right\"} \n                        size={20} \n                        color={isExpense ? BankColors.gray600 : BankColors.primary} \n                      />\n                    </View>\n                    <View style={styles.weeklyTransInfo}>\n                      <Text style={styles.weeklyTransName}>{transaction.description}</Text>\n                      <Text style={styles.weeklyTransDate}>\n                        {transaction.date ? formatTransactionDate(transaction.date) : \"\"}\n                      </Text>\n                    </View>\n                    <Text style={[\n                      styles.weeklyTransAmount,\n                      { color: isExpense ? BankColors.gray800 : BankColors.primary }\n                    ]}>\n                      {formattedAmount}\n                    </Text>\n                  </Pressable>\n                );\n              })\n            )}\n          </ScrollView>\n        </View>\n      </Modal>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  header: {\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.xl,\n  },\n  headerTop: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  headerBackBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  headerBackText: {\n    color: BankColors.white,\n    fontSize: 14,\n  },\n  headerActions: {\n    flexDirection: \"row\",\n    gap: Spacing.lg,\n  },\n  headerAction: {\n    alignItems: \"center\",\n  },\n  headerActionText: {\n    color: BankColors.white,\n    fontSize: 11,\n    marginTop: 2,\n  },\n  greetingContainer: {\n    marginBottom: Spacing.sm,\n  },\n  greeting: {\n    color: BankColors.white,\n    fontSize: 32,\n    fontWeight: \"700\",\n  },\n  personalizeLink: {\n    color: BankColors.white,\n    fontSize: 14,\n    textDecorationLine: \"underline\",\n    opacity: 0.9,\n  },\n  accountNumber: {\n    color: BankColors.white,\n    fontSize: 16,\n    marginBottom: Spacing.md,\n    opacity: 0.9,\n  },\n  balanceRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    marginBottom: Spacing.xs,\n  },\n  balanceAmount: {\n    color: BankColors.white,\n    fontSize: 36,\n    fontWeight: \"700\",\n  },\n  balanceDecimal: {\n    fontSize: 24,\n    fontWeight: \"400\",\n  },\n  showHideBtn: {\n    alignItems: \"center\",\n  },\n  showHideText: {\n    color: BankColors.white,\n    fontSize: 11,\n    marginTop: 2,\n  },\n  detailLink: {\n    color: BankColors.white,\n    fontSize: 14,\n    textDecorationLine: \"underline\",\n    marginBottom: Spacing.lg,\n  },\n  quickActionsScroll: {\n    marginHorizontal: -Spacing.lg,\n  },\n  quickActionsContainer: {\n    paddingHorizontal: Spacing.lg,\n    gap: Spacing.sm,\n    flexDirection: \"row\",\n  },\n  quickActionBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: \"rgba(0,0,0,0.2)\",\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n    borderRadius: BorderRadius.xl,\n    gap: Spacing.xs,\n  },\n  quickActionPressed: {\n    backgroundColor: \"rgba(0,0,0,0.3)\",\n  },\n  quickActionLabel: {\n    color: BankColors.white,\n    fontSize: 13,\n    fontWeight: \"500\",\n  },\n  movimentiSection: {\n    padding: Spacing.lg,\n  },\n  sectionHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  sectionTitle: {\n    fontSize: 24,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  viewAllBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  viewAllText: {\n    color: BankColors.primary,\n    fontSize: 14,\n  },\n  expenseSummary: {\n    backgroundColor: BankColors.gray100,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n    marginBottom: Spacing.lg,\n  },\n  expenseSummaryLabel: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    marginBottom: Spacing.xs,\n  },\n  expenseSummaryAmount: {\n    fontSize: 28,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  expenseSummaryCount: {\n    fontSize: 12,\n    color: BankColors.gray500,\n    marginBottom: Spacing.xs,\n  },\n  detailLinkGreen: {\n    color: BankColors.primary,\n    fontSize: 14,\n    textDecorationLine: \"underline\",\n  },\n  loader: {\n    marginVertical: Spacing.xl,\n  },\n  transactionItem: {\n    flexDirection: \"row\",\n    alignItems: \"flex-start\",\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  transactionIcon: {\n    width: 40,\n    height: 40,\n    borderRadius: 8,\n    backgroundColor: BankColors.gray100,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  transactionInfo: {\n    flex: 1,\n  },\n  transactionDate: {\n    fontSize: 12,\n    color: BankColors.gray500,\n    marginBottom: 2,\n  },\n  transactionDesc: {\n    fontSize: 15,\n    color: BankColors.gray900,\n    fontWeight: \"500\",\n  },\n  transactionAccount: {\n    fontSize: 12,\n    color: BankColors.gray500,\n  },\n  transactionAmountContainer: {\n    alignItems: \"flex-end\",\n  },\n  nonContabilizzato: {\n    fontSize: 10,\n    color: BankColors.primary,\n    fontWeight: \"600\",\n    marginBottom: 2,\n  },\n  transactionAmountRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  transactionAmount: {\n    fontSize: 15,\n    fontWeight: \"500\",\n    color: BankColors.gray900,\n  },\n  expenseAmount: {\n    color: BankColors.error,\n  },\n  chatButton: {\n    position: \"absolute\",\n    right: Spacing.lg,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: BankColors.gray800,\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.md,\n    borderRadius: BorderRadius.xl,\n    gap: Spacing.sm,\n  },\n  chatButtonText: {\n    color: BankColors.white,\n    fontSize: 14,\n    fontWeight: \"500\",\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  modalBackdrop: {\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n  },\n  modalContent: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.xl,\n    width: \"80%\",\n    zIndex: 1,\n  },\n  modalTitle: {\n    fontSize: 20,\n    fontWeight: \"600\",\n    marginBottom: Spacing.lg,\n    textAlign: \"center\",\n  },\n  modalInput: {\n    borderWidth: 1,\n    borderColor: BankColors.gray300,\n    borderRadius: BorderRadius.sm,\n    padding: Spacing.md,\n    fontSize: 18,\n    textAlign: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  modalButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  modalCancelBtn: {\n    flex: 1,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.sm,\n    backgroundColor: BankColors.gray200,\n    alignItems: \"center\",\n  },\n  modalCancelText: {\n    color: BankColors.gray700,\n    fontSize: 16,\n  },\n  modalSaveBtn: {\n    flex: 1,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.sm,\n    backgroundColor: BankColors.primary,\n    alignItems: \"center\",\n  },\n  modalSaveText: {\n    color: BankColors.white,\n    fontSize: 16,\n    fontWeight: \"600\",\n  },\n  analisiSection: {\n    padding: Spacing.lg,\n    backgroundColor: BankColors.white,\n  },\n  analisiCard: {\n    backgroundColor: BankColors.gray100,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.lg,\n  },\n  analisiRow: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingVertical: Spacing.sm,\n  },\n  analisiLabel: {\n    fontSize: 15,\n    color: BankColors.gray700,\n  },\n  analisiAmountRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  analisiAmountNegative: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.error,\n  },\n  analisiAmountPositive: {\n    fontSize: 16,\n    fontWeight: \"600\",\n    color: BankColors.primary,\n  },\n  analisiDivider: {\n    height: 1,\n    backgroundColor: BankColors.gray300,\n    marginVertical: Spacing.sm,\n  },\n  weeklyModalContainer: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n  },\n  weeklyModalHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    padding: Spacing.lg,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  weeklyCloseBtn: {\n    padding: Spacing.xs,\n  },\n  weeklyModalTitle: {\n    fontSize: 18,\n    fontWeight: \"600\",\n    color: BankColors.gray800,\n  },\n  weeklyScrollView: {\n    flex: 1,\n  },\n  weeklyScrollContent: {\n    padding: Spacing.lg,\n  },\n  weeklyLabel: {\n    fontSize: 11,\n    fontWeight: \"600\",\n    color: BankColors.gray500,\n    marginBottom: Spacing.lg,\n    letterSpacing: 1,\n  },\n  weeklyEmptyState: {\n    alignItems: \"center\",\n    paddingVertical: Spacing[\"2xl\"],\n  },\n  weeklyEmptyText: {\n    marginTop: Spacing.md,\n    fontSize: 15,\n    color: BankColors.gray500,\n  },\n  weeklyTransRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray100,\n  },\n  weeklyIconCircle: {\n    width: 40,\n    height: 40,\n    backgroundColor: BankColors.gray100,\n    borderRadius: BorderRadius.sm,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginRight: Spacing.md,\n  },\n  weeklyTransInfo: {\n    flex: 1,\n  },\n  weeklyTransName: {\n    fontWeight: \"600\",\n    fontSize: 15,\n    color: BankColors.gray800,\n  },\n  weeklyTransDate: {\n    color: BankColors.gray500,\n    fontSize: 12,\n    marginTop: 2,\n  },\n  weeklyTransAmount: {\n    fontWeight: \"600\",\n    fontSize: 15,\n  },\n});\n","path":null,"size_bytes":28115,"size_tokens":null},"client/hooks/useScreenOptions.ts":{"content":"import { Platform } from \"react-native\";\nimport { NativeStackNavigationOptions } from \"@react-navigation/native-stack\";\nimport { isLiquidGlassAvailable } from \"expo-glass-effect\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\n\ninterface UseScreenOptionsParams {\n  transparent?: boolean;\n}\n\nexport function useScreenOptions({\n  transparent = true,\n}: UseScreenOptionsParams = {}): NativeStackNavigationOptions {\n  const { theme, isDark } = useTheme();\n\n  return {\n    headerTitleAlign: \"center\",\n    headerTransparent: transparent,\n    headerBlurEffect: isDark ? \"dark\" : \"light\",\n    headerTintColor: theme.text,\n    headerStyle: {\n      backgroundColor: Platform.select({\n        ios: undefined,\n        android: theme.backgroundRoot,\n        web: theme.backgroundRoot,\n      }),\n    },\n    gestureEnabled: true,\n    gestureDirection: \"horizontal\",\n    fullScreenGestureEnabled: isLiquidGlassAvailable() ? false : true,\n    contentStyle: {\n      backgroundColor: theme.backgroundRoot,\n    },\n  };\n}\n","path":null,"size_bytes":1000,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/screens/PinEntryScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  Pressable,\n  StyleSheet,\n  ActivityIndicator,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport * as Haptics from \"expo-haptics\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\ntype NavigationProp = NativeStackNavigationProp<RootStackParamList>;\n\nconst PIN_LENGTH = 5;\n\nexport default function PinEntryScreen() {\n  const insets = useSafeAreaInsets();\n  const navigation = useNavigation<NavigationProp>();\n  const { verifyPin, logout } = useAuth();\n  const [pin, setPin] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(false);\n\n  const handleNumberPress = async (num: string) => {\n    if (pin.length >= PIN_LENGTH) return;\n    \n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    const newPin = pin + num;\n    setPin(newPin);\n    setError(false);\n\n    if (newPin.length === PIN_LENGTH) {\n      setIsLoading(true);\n      const success = await verifyPin(newPin);\n      setIsLoading(false);\n      \n      if (success) {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      } else {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);\n        setError(true);\n        setPin(\"\");\n      }\n    }\n  };\n\n  const handleDelete = () => {\n    if (pin.length > 0) {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      setPin(pin.slice(0, -1));\n      setError(false);\n    }\n  };\n\n  const handleCancel = async () => {\n    await logout();\n    navigation.goBack();\n  };\n\n  const renderPinDots = () => {\n    return (\n      <View style={styles.dotsContainer}>\n        {Array.from({ length: PIN_LENGTH }).map((_, index) => (\n          <View\n            key={index}\n            style={[\n              styles.dot,\n              index < pin.length && styles.dotFilled,\n              error && styles.dotError,\n            ]}\n          >\n            {index < pin.length ? (\n              <View style={[styles.dotInner, error && styles.dotInnerError]} />\n            ) : (\n              <Text style={styles.dotPlaceholder}>_</Text>\n            )}\n          </View>\n        ))}\n      </View>\n    );\n  };\n\n  const renderKeypad = () => {\n    const rows = [\n      [\"1\", \"2\", \"3\"],\n      [\"4\", \"5\", \"6\"],\n      [\"7\", \"8\", \"9\"],\n      [\"\", \"0\", \"delete\"],\n    ];\n\n    return (\n      <View style={styles.keypad}>\n        {rows.map((row, rowIndex) => (\n          <View key={rowIndex} style={styles.keypadRow}>\n            {row.map((key, keyIndex) => {\n              if (key === \"\") {\n                return <View key={keyIndex} style={styles.keyEmpty} />;\n              }\n              if (key === \"delete\") {\n                return (\n                  <Pressable\n                    key={keyIndex}\n                    style={({ pressed }) => [\n                      styles.keyButton,\n                      pressed && styles.keyPressed,\n                    ]}\n                    onPress={handleDelete}\n                  >\n                    <Icon name=\"delete\" size={28} color={BankColors.gray800} />\n                  </Pressable>\n                );\n              }\n              return (\n                <Pressable\n                  key={keyIndex}\n                  style={({ pressed }) => [\n                    styles.keyButton,\n                    pressed && styles.keyPressed,\n                  ]}\n                  onPress={() => handleNumberPress(key)}\n                  disabled={isLoading}\n                >\n                  <Text style={styles.keyText}>{key}</Text>\n                </Pressable>\n              );\n            })}\n          </View>\n        ))}\n      </View>\n    );\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.header}>\n        <View style={styles.headerBar} />\n      </View>\n      \n      <View style={[styles.content, { paddingTop: insets.top + Spacing[\"4xl\"] }]}>\n        <Text style={styles.title}>Inserisci PIN</Text>\n        \n        {isLoading ? (\n          <View style={styles.loadingContainer}>\n            <ActivityIndicator size=\"large\" color={BankColors.primary} />\n          </View>\n        ) : (\n          renderPinDots()\n        )}\n        \n        {error && (\n          <Text style={styles.errorText}>PIN non valido. Riprova.</Text>\n        )}\n        \n        {renderKeypad()}\n        \n        <View style={styles.forgotContainer}>\n          <Text style={styles.forgotText}>Hai dimenticato il tuo PIN?</Text>\n          <Pressable>\n            <Text style={styles.forgotLink}>Recupera PIN</Text>\n          </Pressable>\n        </View>\n      </View>\n      \n      <Pressable\n        style={[styles.cancelButton, { paddingBottom: insets.bottom + Spacing.lg }]}\n        onPress={handleCancel}\n      >\n        <Text style={styles.cancelText}>Annulla</Text>\n      </Pressable>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n  },\n  header: {\n    height: 4,\n  },\n  headerBar: {\n    height: 4,\n    backgroundColor: BankColors.primary,\n  },\n  content: {\n    flex: 1,\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.xl,\n  },\n  title: {\n    fontSize: 22,\n    fontWeight: \"400\",\n    color: BankColors.gray900,\n    marginBottom: Spacing[\"4xl\"],\n  },\n  loadingContainer: {\n    height: 60,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  dotsContainer: {\n    flexDirection: \"row\",\n    gap: Spacing.lg,\n    marginBottom: Spacing.xl,\n  },\n  dot: {\n    width: 40,\n    height: 40,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  dotFilled: {},\n  dotError: {},\n  dotInner: {\n    width: 12,\n    height: 12,\n    borderRadius: 6,\n    backgroundColor: BankColors.gray900,\n  },\n  dotInnerError: {\n    backgroundColor: BankColors.error,\n  },\n  dotPlaceholder: {\n    fontSize: 28,\n    color: BankColors.gray400,\n    fontWeight: \"300\",\n  },\n  errorText: {\n    color: BankColors.error,\n    fontSize: 14,\n    marginBottom: Spacing.md,\n  },\n  keypad: {\n    marginTop: Spacing[\"2xl\"],\n    gap: Spacing.lg,\n  },\n  keypadRow: {\n    flexDirection: \"row\",\n    gap: Spacing[\"4xl\"],\n  },\n  keyButton: {\n    width: 80,\n    height: 80,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  keyPressed: {\n    backgroundColor: BankColors.gray100,\n    borderRadius: 40,\n  },\n  keyEmpty: {\n    width: 80,\n    height: 80,\n  },\n  keyText: {\n    fontSize: 36,\n    fontWeight: \"300\",\n    color: BankColors.gray800,\n  },\n  forgotContainer: {\n    marginTop: Spacing[\"3xl\"],\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  forgotText: {\n    fontSize: 14,\n    color: BankColors.gray600,\n  },\n  forgotLink: {\n    fontSize: 14,\n    color: BankColors.primary,\n    fontWeight: \"500\",\n  },\n  cancelButton: {\n    paddingVertical: Spacing.lg,\n    alignItems: \"center\",\n    borderTopWidth: 1,\n    borderTopColor: BankColors.gray200,\n  },\n  cancelText: {\n    fontSize: 16,\n    color: BankColors.gray900,\n  },\n});\n","path":null,"size_bytes":7312,"size_tokens":null},"babel.config.js":{"content":"module.exports = function (api) {\n  api.cache(true);\n  return {\n    presets: [\"babel-preset-expo\"],\n    plugins: [\n      [\n        \"module-resolver\",\n        {\n          root: [\"./\"],\n          alias: {\n            \"@\": \"./client\",\n            \"@shared\": \"./shared\",\n          },\n          extensions: [\".ios.js\", \".android.js\", \".js\", \".ts\", \".tsx\", \".json\"],\n        },\n      ],\n      \"react-native-reanimated/plugin\",\n    ],\n  };\n};\n","path":null,"size_bytes":436,"size_tokens":null},"server/index.ts":{"content":"import express from \"express\";\nimport type { Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst app = express();\nconst log = console.log;\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\nfunction setupCors(app: express.Application) {\n  app.use((req, res, next) => {\n    const origins = new Set<string>();\n\n    if (process.env.REPLIT_DEV_DOMAIN) {\n      origins.add(`https://${process.env.REPLIT_DEV_DOMAIN}`);\n    }\n\n    if (process.env.REPLIT_DOMAINS) {\n      process.env.REPLIT_DOMAINS.split(\",\").forEach((d) => {\n        origins.add(`https://${d.trim()}`);\n      });\n    }\n\n    const origin = req.header(\"origin\");\n\n    if (origin && origins.has(origin)) {\n      res.header(\"Access-Control-Allow-Origin\", origin);\n      res.header(\n        \"Access-Control-Allow-Methods\",\n        \"GET, POST, PUT, DELETE, OPTIONS\",\n      );\n      res.header(\"Access-Control-Allow-Headers\", \"Content-Type\");\n      res.header(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n\n    if (req.method === \"OPTIONS\") {\n      return res.sendStatus(200);\n    }\n\n    next();\n  });\n}\n\nfunction setupBodyParsing(app: express.Application) {\n  app.use(\n    express.json({\n      verify: (req, _res, buf) => {\n        req.rawBody = buf;\n      },\n    }),\n  );\n\n  app.use(express.urlencoded({ extended: false }));\n}\n\nfunction setupRequestLogging(app: express.Application) {\n  app.use((req, res, next) => {\n    const start = Date.now();\n    const path = req.path;\n    let capturedJsonResponse: Record<string, unknown> | undefined = undefined;\n\n    const originalResJson = res.json;\n    res.json = function (bodyJson, ...args) {\n      capturedJsonResponse = bodyJson;\n      return originalResJson.apply(res, [bodyJson, ...args]);\n    };\n\n    res.on(\"finish\", () => {\n      if (!path.startsWith(\"/api\")) return;\n\n      const duration = Date.now() - start;\n\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    });\n\n    next();\n  });\n}\n\nfunction getAppName(): string {\n  try {\n    const appJsonPath = path.resolve(process.cwd(), \"app.json\");\n    const appJsonContent = fs.readFileSync(appJsonPath, \"utf-8\");\n    const appJson = JSON.parse(appJsonContent);\n    return appJson.expo?.name || \"App Landing Page\";\n  } catch {\n    return \"App Landing Page\";\n  }\n}\n\nfunction serveExpoManifest(platform: string, res: Response) {\n  const manifestPath = path.resolve(\n    process.cwd(),\n    \"static-build\",\n    platform,\n    \"manifest.json\",\n  );\n\n  if (!fs.existsSync(manifestPath)) {\n    return res\n      .status(404)\n      .json({ error: `Manifest not found for platform: ${platform}` });\n  }\n\n  res.setHeader(\"expo-protocol-version\", \"1\");\n  res.setHeader(\"expo-sfv-version\", \"0\");\n  res.setHeader(\"content-type\", \"application/json\");\n\n  const manifest = fs.readFileSync(manifestPath, \"utf-8\");\n  res.send(manifest);\n}\n\nfunction serveLandingPage({\n  req,\n  res,\n  landingPageTemplate,\n  appName,\n}: {\n  req: Request;\n  res: Response;\n  landingPageTemplate: string;\n  appName: string;\n}) {\n  const forwardedProto = req.header(\"x-forwarded-proto\");\n  const protocol = forwardedProto || req.protocol || \"https\";\n  const forwardedHost = req.header(\"x-forwarded-host\");\n  const host = forwardedHost || req.get(\"host\");\n  const baseUrl = `${protocol}://${host}`;\n  const expsUrl = `${host}`;\n\n  log(`baseUrl`, baseUrl);\n  log(`expsUrl`, expsUrl);\n\n  const html = landingPageTemplate\n    .replace(/BASE_URL_PLACEHOLDER/g, baseUrl)\n    .replace(/EXPS_URL_PLACEHOLDER/g, expsUrl)\n    .replace(/APP_NAME_PLACEHOLDER/g, appName);\n\n  res.setHeader(\"Content-Type\", \"text/html; charset=utf-8\");\n  res.status(200).send(html);\n}\n\nfunction configureExpoAndLanding(app: express.Application) {\n  const templatePath = path.resolve(\n    process.cwd(),\n    \"server\",\n    \"templates\",\n    \"landing-page.html\",\n  );\n  const adminTemplatePath = path.resolve(\n    process.cwd(),\n    \"server\",\n    \"templates\",\n    \"admin.html\",\n  );\n  const landingPageTemplate = fs.readFileSync(templatePath, \"utf-8\");\n  const adminPageTemplate = fs.readFileSync(adminTemplatePath, \"utf-8\");\n  const appName = getAppName();\n\n  log(\"Serving static Expo files with dynamic manifest routing\");\n\n  app.use((req: Request, res: Response, next: NextFunction) => {\n    if (req.path.startsWith(\"/api\")) {\n      return next();\n    }\n\n    if (req.path === \"/admin\") {\n      res.setHeader(\"Content-Type\", \"text/html; charset=utf-8\");\n      return res.status(200).send(adminPageTemplate);\n    }\n\n    if (req.path !== \"/\" && req.path !== \"/manifest\") {\n      return next();\n    }\n\n    const platform = req.header(\"expo-platform\");\n    if (platform && (platform === \"ios\" || platform === \"android\")) {\n      return serveExpoManifest(platform, res);\n    }\n\n    if (req.path === \"/\") {\n      return serveLandingPage({\n        req,\n        res,\n        landingPageTemplate,\n        appName,\n      });\n    }\n\n    next();\n  });\n\n  app.use(\"/assets\", express.static(path.resolve(process.cwd(), \"assets\")));\n  app.use(express.static(path.resolve(process.cwd(), \"static-build\")));\n\n  log(\"Expo routing: Checking expo-platform header on / and /manifest\");\n}\n\nfunction setupErrorHandler(app: express.Application) {\n  app.use((err: unknown, _req: Request, res: Response, _next: NextFunction) => {\n    const error = err as {\n      status?: number;\n      statusCode?: number;\n      message?: string;\n    };\n\n    const status = error.status || error.statusCode || 500;\n    const message = error.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n\n    throw err;\n  });\n}\n\n(async () => {\n  setupCors(app);\n  setupBodyParsing(app);\n  setupRequestLogging(app);\n\n  configureExpoAndLanding(app);\n\n  const server = await registerRoutes(app);\n\n  setupErrorHandler(app);\n\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  server.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`express server serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":6296,"size_tokens":null},"client/hooks/useServerDate.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\ninterface ServerDateResponse {\n  date: string;\n  timestamp: number;\n  timezone: string;\n}\n\nexport function useServerDate() {\n  return useQuery<ServerDateResponse>({\n    queryKey: [\"/api/server-date\"],\n    refetchInterval: 60000,\n    staleTime: 30000,\n  });\n}\n\nexport function formatServerDate(isoDate: string, format: \"short\" | \"long\" | \"full\" = \"short\"): string {\n  const date = new Date(isoDate);\n  \n  switch (format) {\n    case \"full\":\n      return date.toLocaleDateString(\"it-IT\", {\n        weekday: \"long\",\n        day: \"numeric\",\n        month: \"long\",\n        year: \"numeric\",\n      });\n    case \"long\":\n      return date.toLocaleDateString(\"it-IT\", {\n        day: \"numeric\",\n        month: \"long\",\n        year: \"numeric\",\n      });\n    case \"short\":\n    default:\n      return date.toLocaleDateString(\"it-IT\", {\n        day: \"2-digit\",\n        month: \"2-digit\",\n        year: \"numeric\",\n      });\n  }\n}\n\nexport function isToday(isoDate: string, serverDate: string): boolean {\n  const transactionDate = new Date(isoDate).toDateString();\n  const currentDate = new Date(serverDate).toDateString();\n  return transactionDate === currentDate;\n}\n\nexport function isThisMonth(isoDate: string, serverDate: string): boolean {\n  const transaction = new Date(isoDate);\n  const current = new Date(serverDate);\n  return transaction.getMonth() === current.getMonth() && \n         transaction.getFullYear() === current.getFullYear();\n}\n","path":null,"size_bytes":1479,"size_tokens":null},"client/screens/AnalisiScreen.tsx":{"content":"import React, { useState, useMemo } from \"react\";\nimport {\n  View,\n  Text,\n  ScrollView,\n  Pressable,\n  StyleSheet,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Svg, { Path, G, Circle as SvgCircle } from \"react-native-svg\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport type { Transaction } from \"@shared/schema\";\n\ntype TabType = \"Uscite\" | \"Entrate\";\ntype PeriodType = \"DIC\" | \"ULTIMI 12 MESI\" | \"TUTTO IL 2025\";\n\nconst EXPENSE_CATEGORIES = [\n  { id: \"Casa\", color: \"#FF9800\", icon: \"home\" },\n  { id: \"Trasporti\", color: \"#4CAF50\", icon: \"truck\" },\n  { id: \"Famiglia\", color: \"#00BCD4\", icon: \"users\" },\n  { id: \"Salute e benessere\", color: \"#F44336\", icon: \"heart\" },\n  { id: \"Tempo libero\", color: \"#2196F3\", icon: \"star\" },\n  { id: \"Altre uscite\", color: \"#9C27B0\", icon: \"more-horizontal\" },\n];\n\nconst INCOME_CATEGORIES = [\n  { id: \"Bonifici ricevuti\", color: \"#8B0000\", icon: \"arrow-up-right\" },\n  { id: \"Entrate varie\", color: \"#FFB6C1\", icon: \"plus\" },\n  { id: \"Regali ricevuti\", color: \"#4B0082\", icon: \"gift\" },\n  { id: \"Rimborsi spese e storni\", color: \"#6495ED\", icon: \"rotate-ccw\" },\n];\n\nfunction DonutChart({ \n  data, \n  total, \n  label,\n  isExpense \n}: { \n  data: { category: string; amount: number; color: string }[];\n  total: number;\n  label: string;\n  isExpense: boolean;\n}) {\n  const size = 180;\n  const strokeWidth = 28;\n  const radius = (size - strokeWidth) / 2;\n  const circumference = 2 * Math.PI * radius;\n  const center = size / 2;\n\n  let currentAngle = -90;\n  const segments = data.map((item) => {\n    const percentage = total > 0 ? (item.amount / total) * 100 : 0;\n    const angle = (percentage / 100) * 360;\n    const startAngle = currentAngle;\n    currentAngle += angle;\n    return { ...item, startAngle, angle, percentage };\n  });\n\n  const formatAmount = (amount: number) => {\n    const formatted = amount.toFixed(2).replace(\".\", \",\");\n    const parts = formatted.split(\",\");\n    const intPart = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\");\n    return `${isExpense ? \"-\" : \"+\"}${intPart},${parts[1]}`;\n  };\n\n  const polarToCartesian = (centerX: number, centerY: number, radius: number, angleInDegrees: number) => {\n    const angleInRadians = (angleInDegrees * Math.PI) / 180.0;\n    return {\n      x: centerX + radius * Math.cos(angleInRadians),\n      y: centerY + radius * Math.sin(angleInRadians),\n    };\n  };\n\n  const describeArc = (x: number, y: number, radius: number, startAngle: number, endAngle: number) => {\n    const start = polarToCartesian(x, y, radius, endAngle);\n    const end = polarToCartesian(x, y, radius, startAngle);\n    const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\";\n    return `M ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArcFlag} 0 ${end.x} ${end.y}`;\n  };\n\n  return (\n    <View style={styles.donutContainer}>\n      <View style={styles.legendContainer}>\n        {(isExpense ? EXPENSE_CATEGORIES : INCOME_CATEGORIES).map((cat) => {\n          const item = data.find(d => d.category === cat.id);\n          if (!item || item.amount === 0) return null;\n          return (\n            <View key={cat.id} style={styles.legendItem}>\n              <View style={[styles.legendDot, { backgroundColor: cat.color }]} />\n              <Text style={styles.legendText} numberOfLines={1}>{cat.id}</Text>\n            </View>\n          );\n        })}\n      </View>\n      <View style={styles.chartContainer}>\n        <Svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\n          <SvgCircle\n            cx={center}\n            cy={center}\n            r={radius}\n            fill=\"none\"\n            stroke=\"#E0E0E0\"\n            strokeWidth={strokeWidth}\n          />\n          <G>\n            {segments.map((segment, index) => {\n              if (segment.angle <= 0) return null;\n              const endAngle = segment.startAngle + Math.min(segment.angle - 0.5, segment.angle);\n              return (\n                <Path\n                  key={index}\n                  d={describeArc(center, center, radius, segment.startAngle, endAngle)}\n                  fill=\"none\"\n                  stroke={segment.color}\n                  strokeWidth={strokeWidth}\n                  strokeLinecap=\"butt\"\n                />\n              );\n            })}\n          </G>\n        </Svg>\n        <View style={styles.donutCenter}>\n          <Text style={styles.donutLabel}>{label}</Text>\n          <Text style={[styles.donutAmount, isExpense && styles.expenseText]}>\n            {formatAmount(total)}\n          </Text>\n          <View style={styles.infoIcon}>\n            <Icon name=\"info\" size={16} color={BankColors.gray400} />\n          </View>\n        </View>\n      </View>\n    </View>\n  );\n}\n\nfunction CategoryRow({ \n  category, \n  amount, \n  total, \n  color, \n  icon,\n  isExpense,\n  onPress \n}: { \n  category: string;\n  amount: number;\n  total: number;\n  color: string;\n  icon: string;\n  isExpense: boolean;\n  onPress: () => void;\n}) {\n  const percentage = total > 0 ? (amount / total) * 100 : 0;\n  const formattedAmount = `${isExpense ? \"-\" : \"+\"}${amount.toFixed(2).replace(\".\", \",\").replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")} \\u20AC`;\n\n  return (\n    <Pressable style={styles.categoryRow} onPress={onPress}>\n      <View style={styles.categoryIconContainer}>\n        <View style={[styles.categoryIcon, { backgroundColor: `${color}20` }]}>\n          <Icon name={icon} size={20} color={color} />\n        </View>\n      </View>\n      <View style={styles.categoryInfo}>\n        <Text style={styles.categoryName}>{category}</Text>\n        <View style={styles.progressBarContainer}>\n          <View \n            style={[\n              styles.progressBar, \n              { width: `${Math.min(percentage, 100)}%`, backgroundColor: color }\n            ]} \n          />\n        </View>\n      </View>\n      <View style={styles.categoryAmountContainer}>\n        <Text style={[styles.categoryAmount, isExpense && styles.expenseText]}>\n          {formattedAmount}\n        </Text>\n        <Icon name=\"chevron-right\" size={16} color={BankColors.gray400} />\n      </View>\n    </Pressable>\n  );\n}\n\nexport default function AnalisiScreen() {\n  const insets = useSafeAreaInsets();\n  const navigation = useNavigation();\n  const { userId, user } = useAuth();\n  const [activeTab, setActiveTab] = useState<TabType>(\"Uscite\");\n  const [activePeriod, setActivePeriod] = useState<PeriodType>(\"TUTTO IL 2025\");\n\n  const { data: transactions = [] } = useQuery<Transaction[]>({\n    queryKey: [\"/api/transactions\", userId],\n    enabled: !!userId,\n  });\n\n  const { categoryData, total, totalIncome, totalExpense } = useMemo(() => {\n    const now = new Date();\n    const currentMonth = now.getMonth();\n    const currentYear = now.getFullYear();\n\n    let filteredTransactions = transactions.filter(t => {\n      const dateValue = t.date || t.createdAt;\n      if (!dateValue) return false;\n      const date = new Date(dateValue);\n      if (activePeriod === \"DIC\") {\n        return date.getMonth() === 11 && date.getFullYear() === currentYear;\n      } else if (activePeriod === \"ULTIMI 12 MESI\") {\n        const oneYearAgo = new Date(now);\n        oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);\n        return date >= oneYearAgo;\n      }\n      return date.getFullYear() === currentYear;\n    });\n\n    const isExpenseTab = activeTab === \"Uscite\";\n    const relevantTransactions = filteredTransactions.filter(\n      t => isExpenseTab ? t.type === \"expense\" : t.type === \"income\"\n    );\n\n    const categories = isExpenseTab ? EXPENSE_CATEGORIES : INCOME_CATEGORIES;\n    const categoryMap = new Map<string, number>();\n\n    categories.forEach(cat => categoryMap.set(cat.id, 0));\n\n    relevantTransactions.forEach(t => {\n      const amount = Math.abs(parseFloat(t.amount));\n      const category = t.category || (isExpenseTab ? \"Altre uscite\" : \"Entrate varie\");\n      \n      let matchedCategory = categories.find(c => c.id === category);\n      if (!matchedCategory) {\n        matchedCategory = categories[categories.length - 1];\n      }\n      \n      categoryMap.set(matchedCategory.id, (categoryMap.get(matchedCategory.id) || 0) + amount);\n    });\n\n    const data = categories\n      .map(cat => ({\n        category: cat.id,\n        amount: categoryMap.get(cat.id) || 0,\n        color: cat.color,\n        icon: cat.icon,\n      }))\n      .sort((a, b) => b.amount - a.amount);\n\n    const totalAmount = data.reduce((sum, item) => sum + item.amount, 0);\n\n    const incomeTotal = filteredTransactions\n      .filter(t => t.type === \"income\")\n      .reduce((sum, t) => sum + Math.abs(parseFloat(t.amount)), 0);\n\n    const expenseTotal = filteredTransactions\n      .filter(t => t.type === \"expense\")\n      .reduce((sum, t) => sum + Math.abs(parseFloat(t.amount)), 0);\n\n    return { \n      categoryData: data, \n      total: totalAmount,\n      totalIncome: incomeTotal,\n      totalExpense: expenseTotal,\n    };\n  }, [transactions, activeTab, activePeriod]);\n\n  const formatCurrency = (amount: number, isExpense: boolean) => {\n    const formatted = amount.toFixed(2).replace(\".\", \",\");\n    const parts = formatted.split(\",\");\n    const intPart = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\");\n    return `${isExpense ? \"-\" : \"+\"}${intPart},${parts[1]} \\u20AC`;\n  };\n\n  const isExpense = activeTab === \"Uscite\";\n\n  return (\n    <View style={[styles.container, { paddingTop: insets.top }]}>\n      <View style={styles.header}>\n        <Pressable style={styles.backButton} onPress={() => navigation.goBack()}>\n          <Icon name=\"chevron-left\" size={24} color={BankColors.primary} />\n          <Text style={styles.backText}>Indietro</Text>\n        </Pressable>\n        <Text style={styles.headerTitle}>Entrate e uscite</Text>\n        <Pressable style={styles.helpButton}>\n          <Icon name=\"help-circle\" size={24} color={BankColors.primary} />\n          <Text style={styles.helpText}>Aiuto</Text>\n        </Pressable>\n      </View>\n\n      <ScrollView \n        style={styles.scrollView}\n        contentContainerStyle={styles.scrollContent}\n        showsVerticalScrollIndicator={false}\n      >\n        <View style={styles.accountHeader}>\n          <Text style={styles.accountLabel}>CONTO {user?.accountNumber || \"00000000\"}</Text>\n        </View>\n\n        <View style={styles.tabContainer}>\n          <Pressable\n            style={[styles.tab, activeTab === \"Uscite\" && styles.activeTab]}\n            onPress={() => setActiveTab(\"Uscite\")}\n          >\n            <Text style={[styles.tabText, activeTab === \"Uscite\" && styles.activeTabText]}>\n              Uscite\n            </Text>\n          </Pressable>\n          <Pressable\n            style={[styles.tab, activeTab === \"Entrate\" && styles.activeTab]}\n            onPress={() => setActiveTab(\"Entrate\")}\n          >\n            <Text style={[styles.tabText, activeTab === \"Entrate\" && styles.activeTabText]}>\n              Entrate\n            </Text>\n          </Pressable>\n        </View>\n\n        <DonutChart\n          data={categoryData}\n          total={total}\n          label={isExpense ? \"Uscite\" : \"Entrate\"}\n          isExpense={isExpense}\n        />\n\n        <Pressable style={styles.showTrendButton}>\n          <Text style={styles.showTrendText}>MOSTRA ANDAMENTO</Text>\n        </Pressable>\n\n        <View style={styles.periodContainer}>\n          <Pressable style={styles.periodArrow}>\n            <Icon name=\"chevron-left\" size={24} color={BankColors.gray600} />\n          </Pressable>\n          {([\"DIC\", \"ULTIMI 12 MESI\", \"TUTTO IL 2025\"] as PeriodType[]).map((period) => (\n            <Pressable\n              key={period}\n              style={[styles.periodButton, activePeriod === period && styles.activePeriod]}\n              onPress={() => setActivePeriod(period)}\n            >\n              <Text style={[\n                styles.periodText, \n                activePeriod === period && styles.activePeriodText\n              ]}>\n                {period === \"ULTIMI 12 MESI\" ? \"ULTIMI\\n12 MESI\" : period}\n              </Text>\n            </Pressable>\n          ))}\n        </View>\n\n        <View style={styles.totalRow}>\n          <Text style={styles.totalLabel}>{isExpense ? \"Uscite\" : \"Entrate\"}</Text>\n          <Text style={[styles.totalAmount, isExpense && styles.expenseText]}>\n            {formatCurrency(total, isExpense)}\n          </Text>\n        </View>\n\n        <View style={styles.detailSection}>\n          <View style={styles.detailHeader}>\n            <Text style={styles.detailTitle}>\n              DETTAGLIO {isExpense ? \"USCITE\" : \"ENTRATE\"}\n            </Text>\n            <Pressable style={styles.sortButton}>\n              <Text style={styles.sortText}>Ordina per: Importo</Text>\n              <Icon name=\"chevron-down\" size={16} color={BankColors.primary} />\n            </Pressable>\n          </View>\n\n          {categoryData.filter(item => item.amount > 0).map((item) => (\n            <CategoryRow\n              key={item.category}\n              category={item.category}\n              amount={item.amount}\n              total={total}\n              color={item.color}\n              icon={item.icon}\n              isExpense={isExpense}\n              onPress={() => {}}\n            />\n          ))}\n        </View>\n\n        <View style={{ height: 100 }} />\n      </ScrollView>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n  },\n  header: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  backButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  backText: {\n    color: BankColors.primary,\n    fontSize: 16,\n  },\n  headerTitle: {\n    fontSize: 17,\n    fontWeight: \"600\",\n    color: BankColors.gray900,\n  },\n  helpButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  helpText: {\n    color: BankColors.primary,\n    fontSize: 14,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  scrollContent: {\n    paddingBottom: Spacing.xl,\n  },\n  accountHeader: {\n    backgroundColor: BankColors.gray100,\n    paddingVertical: Spacing.md,\n    paddingHorizontal: Spacing.lg,\n  },\n  accountLabel: {\n    fontSize: 13,\n    fontWeight: \"500\",\n    color: BankColors.gray700,\n  },\n  tabContainer: {\n    flexDirection: \"row\",\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.lg,\n  },\n  tab: {\n    flex: 1,\n    paddingVertical: Spacing.md,\n    alignItems: \"center\",\n    borderBottomWidth: 2,\n    borderBottomColor: \"transparent\",\n  },\n  activeTab: {\n    borderBottomColor: BankColors.primary,\n  },\n  tabText: {\n    fontSize: 15,\n    color: BankColors.gray500,\n  },\n  activeTabText: {\n    color: BankColors.primary,\n    fontWeight: \"600\",\n  },\n  donutContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.xl,\n  },\n  legendContainer: {\n    flex: 1,\n    gap: Spacing.sm,\n  },\n  legendItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  legendDot: {\n    width: 12,\n    height: 12,\n    borderRadius: 2,\n  },\n  legendText: {\n    fontSize: 12,\n    color: BankColors.gray700,\n    flex: 1,\n  },\n  chartContainer: {\n    position: \"relative\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  donutCenter: {\n    position: \"absolute\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  donutLabel: {\n    fontSize: 14,\n    color: BankColors.gray600,\n  },\n  donutAmount: {\n    fontSize: 22,\n    fontWeight: \"700\",\n    color: BankColors.gray900,\n  },\n  expenseText: {\n    color: BankColors.error,\n  },\n  infoIcon: {\n    marginTop: Spacing.xs,\n  },\n  showTrendButton: {\n    alignItems: \"center\",\n    paddingVertical: Spacing.md,\n  },\n  showTrendText: {\n    color: BankColors.primary,\n    fontSize: 13,\n    fontWeight: \"600\",\n  },\n  periodContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.md,\n    gap: Spacing.sm,\n  },\n  periodArrow: {\n    padding: Spacing.xs,\n  },\n  periodButton: {\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n  },\n  activePeriod: {\n    backgroundColor: BankColors.gray100,\n    borderRadius: BorderRadius.sm,\n  },\n  periodText: {\n    fontSize: 12,\n    color: BankColors.gray500,\n    textAlign: \"center\",\n  },\n  activePeriodText: {\n    color: BankColors.gray900,\n    fontWeight: \"600\",\n  },\n  totalRow: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.lg,\n    borderTopWidth: 1,\n    borderTopColor: BankColors.gray200,\n  },\n  totalLabel: {\n    fontSize: 17,\n    fontWeight: \"500\",\n    color: BankColors.gray900,\n  },\n  totalAmount: {\n    fontSize: 17,\n    fontWeight: \"600\",\n    color: BankColors.success,\n  },\n  detailSection: {\n    paddingTop: Spacing.md,\n  },\n  detailHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray200,\n  },\n  detailTitle: {\n    fontSize: 12,\n    fontWeight: \"600\",\n    color: BankColors.gray600,\n  },\n  sortButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  sortText: {\n    fontSize: 13,\n    color: BankColors.primary,\n  },\n  categoryRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingVertical: Spacing.lg,\n    borderBottomWidth: 1,\n    borderBottomColor: BankColors.gray100,\n  },\n  categoryIconContainer: {\n    marginRight: Spacing.md,\n  },\n  categoryIcon: {\n    width: 44,\n    height: 44,\n    borderRadius: 22,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  categoryInfo: {\n    flex: 1,\n    gap: Spacing.sm,\n  },\n  categoryName: {\n    fontSize: 15,\n    color: BankColors.gray900,\n  },\n  progressBarContainer: {\n    height: 8,\n    backgroundColor: BankColors.gray200,\n    borderRadius: 4,\n    overflow: \"hidden\",\n  },\n  progressBar: {\n    height: \"100%\",\n    borderRadius: 4,\n  },\n  categoryAmountContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  categoryAmount: {\n    fontSize: 15,\n    fontWeight: \"500\",\n    color: BankColors.gray900,\n  },\n});\n","path":null,"size_bytes":18646,"size_tokens":null},"client/hooks/useColorScheme.web.ts":{"content":"import { useEffect, useState } from \"react\";\nimport { useColorScheme as useRNColorScheme } from \"react-native\";\n\n/**\n * To support static rendering, this value needs to be re-calculated on the client side for web\n */\nexport function useColorScheme() {\n  const [hasHydrated, setHasHydrated] = useState(false);\n\n  useEffect(() => {\n    setHasHydrated(true);\n  }, []);\n\n  const colorScheme = useRNColorScheme();\n\n  if (hasHydrated) {\n    return colorScheme;\n  }\n\n  return \"light\";\n}\n","path":null,"size_bytes":480,"size_tokens":null},"shared/presets.ts":{"content":"export type PresetTransaction = {\n  description: string;\n  type: \"expense\" | \"income\";\n  category: string;\n  minAmount: number;\n  maxAmount: number;\n  fixedAmounts?: number[];\n  isCustom?: boolean;\n};\n\nexport const TRANSACTION_CATEGORIES = [\n  \"Spesa e supermercati\",\n  \"Generi alimentari e supermercato\",\n  \"Ristorazione e bar\",\n  \"Ristoranti e bar\",\n  \"Trasporti\",\n  \"Carburanti\",\n  \"Casa\",\n  \"Prelievi\",\n  \"Bonifici ricevuti\",\n  \"Altre uscite\",\n  \"Salute e benessere\",\n  \"Tempo libero\",\n  \"Tabaccai e simili\",\n  \"Tasse e bolli\",\n  \"Trasferimenti\",\n  \"Sanità\",\n  \"Trasporti e viaggi\",\n  \"Servizi\",\n];\n\nexport const DEFAULT_PRESETS: PresetTransaction[] = [];\n","path":null,"size_bytes":661,"size_tokens":null},"client/screens/PinSetupScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  Pressable,\n  StyleSheet,\n  ActivityIndicator,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport type { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport * as Haptics from \"expo-haptics\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius, Typography } from \"@/constants/theme\";\nimport type { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\ntype NavigationProp = NativeStackNavigationProp<RootStackParamList>;\n\nconst PIN_LENGTH = 5;\n\nexport default function PinSetupScreen() {\n  const insets = useSafeAreaInsets();\n  const navigation = useNavigation<NavigationProp>();\n  const { setupPin, logout } = useAuth();\n  const [pin, setPin] = useState(\"\");\n  const [confirmPin, setConfirmPin] = useState(\"\");\n  const [step, setStep] = useState<\"create\" | \"confirm\">(\"create\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const handleNumberPress = async (num: string) => {\n    const currentPin = step === \"create\" ? pin : confirmPin;\n    if (currentPin.length >= PIN_LENGTH) return;\n    \n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    const newPin = currentPin + num;\n    \n    if (step === \"create\") {\n      setPin(newPin);\n      setError(\"\");\n      \n      if (newPin.length === PIN_LENGTH) {\n        setStep(\"confirm\");\n      }\n    } else {\n      setConfirmPin(newPin);\n      setError(\"\");\n      \n      if (newPin.length === PIN_LENGTH) {\n        if (newPin === pin) {\n          setIsLoading(true);\n          const success = await setupPin(newPin);\n          setIsLoading(false);\n          \n          if (success) {\n            Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n          } else {\n            Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);\n            setError(\"Errore durante la configurazione del PIN\");\n            setConfirmPin(\"\");\n          }\n        } else {\n          Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);\n          setError(\"I PIN non corrispondono. Riprova.\");\n          setPin(\"\");\n          setConfirmPin(\"\");\n          setStep(\"create\");\n        }\n      }\n    }\n  };\n\n  const handleDelete = () => {\n    const currentPin = step === \"create\" ? pin : confirmPin;\n    if (currentPin.length > 0) {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      if (step === \"create\") {\n        setPin(pin.slice(0, -1));\n      } else {\n        setConfirmPin(confirmPin.slice(0, -1));\n      }\n      setError(\"\");\n    }\n  };\n\n  const handleCancel = async () => {\n    await logout();\n  };\n\n  const renderPinDots = () => {\n    const currentPin = step === \"create\" ? pin : confirmPin;\n    return (\n      <View style={styles.dotsContainer}>\n        {Array.from({ length: PIN_LENGTH }).map((_, index) => (\n          <View\n            key={index}\n            style={[\n              styles.dot,\n              index < currentPin.length && styles.dotFilled,\n              error ? styles.dotError : null,\n            ]}\n          >\n            {index < currentPin.length ? (\n              <View style={[styles.dotInner, error ? styles.dotInnerError : null]} />\n            ) : (\n              <Text style={styles.dotPlaceholder}>_</Text>\n            )}\n          </View>\n        ))}\n      </View>\n    );\n  };\n\n  const renderKeypad = () => {\n    const rows = [\n      [\"1\", \"2\", \"3\"],\n      [\"4\", \"5\", \"6\"],\n      [\"7\", \"8\", \"9\"],\n      [\"\", \"0\", \"delete\"],\n    ];\n\n    return (\n      <View style={styles.keypad}>\n        {rows.map((row, rowIndex) => (\n          <View key={rowIndex} style={styles.keypadRow}>\n            {row.map((key, keyIndex) => {\n              if (key === \"\") {\n                return <View key={keyIndex} style={styles.keyEmpty} />;\n              }\n              if (key === \"delete\") {\n                return (\n                  <Pressable\n                    key={keyIndex}\n                    style={({ pressed }) => [\n                      styles.keyButton,\n                      pressed && styles.keyPressed,\n                    ]}\n                    onPress={handleDelete}\n                  >\n                    <Icon name=\"delete\" size={28} color={BankColors.gray800} />\n                  </Pressable>\n                );\n              }\n              return (\n                <Pressable\n                  key={keyIndex}\n                  style={({ pressed }) => [\n                    styles.keyButton,\n                    pressed && styles.keyPressed,\n                  ]}\n                  onPress={() => handleNumberPress(key)}\n                  disabled={isLoading}\n                >\n                  <Text style={styles.keyText}>{key}</Text>\n                </Pressable>\n              );\n            })}\n          </View>\n        ))}\n      </View>\n    );\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.header}>\n        <View style={styles.headerBar} />\n      </View>\n      \n      <View style={[styles.content, { paddingTop: insets.top + Spacing[\"4xl\"] }]}>\n        <Text style={styles.title}>\n          {step === \"create\" ? \"Crea il tuo PIN\" : \"Conferma il tuo PIN\"}\n        </Text>\n        <Text style={styles.subtitle}>\n          {step === \"create\" \n            ? \"Inserisci un PIN di 5 cifre per proteggere il tuo conto\"\n            : \"Inserisci nuovamente il PIN per confermare\"\n          }\n        </Text>\n        \n        {isLoading ? (\n          <View style={styles.loadingContainer}>\n            <ActivityIndicator size=\"large\" color={BankColors.primary} />\n          </View>\n        ) : (\n          renderPinDots()\n        )}\n        \n        {error ? (\n          <Text style={styles.errorText}>{error}</Text>\n        ) : null}\n        \n        {renderKeypad()}\n      </View>\n      \n      <Pressable\n        style={[styles.cancelButton, { paddingBottom: insets.bottom + Spacing.lg }]}\n        onPress={handleCancel}\n      >\n        <Text style={styles.cancelText}>Annulla</Text>\n      </Pressable>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: BankColors.white,\n  },\n  header: {\n    height: 4,\n  },\n  headerBar: {\n    height: 4,\n    backgroundColor: BankColors.primary,\n  },\n  content: {\n    flex: 1,\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.xl,\n  },\n  title: {\n    fontSize: 22,\n    fontWeight: \"400\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.sm,\n  },\n  subtitle: {\n    fontSize: 14,\n    color: BankColors.gray600,\n    textAlign: \"center\",\n    marginBottom: Spacing[\"3xl\"],\n    paddingHorizontal: Spacing.xl,\n  },\n  loadingContainer: {\n    height: 60,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  dotsContainer: {\n    flexDirection: \"row\",\n    gap: Spacing.lg,\n    marginBottom: Spacing.xl,\n  },\n  dot: {\n    width: 40,\n    height: 40,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  dotFilled: {},\n  dotError: {},\n  dotInner: {\n    width: 12,\n    height: 12,\n    borderRadius: 6,\n    backgroundColor: BankColors.gray900,\n  },\n  dotInnerError: {\n    backgroundColor: BankColors.error,\n  },\n  dotPlaceholder: {\n    fontSize: 28,\n    color: BankColors.gray400,\n    fontWeight: \"300\",\n  },\n  errorText: {\n    color: BankColors.error,\n    fontSize: 14,\n    marginBottom: Spacing.md,\n    textAlign: \"center\",\n  },\n  keypad: {\n    marginTop: Spacing[\"2xl\"],\n    gap: Spacing.lg,\n  },\n  keypadRow: {\n    flexDirection: \"row\",\n    gap: Spacing[\"4xl\"],\n  },\n  keyButton: {\n    width: 80,\n    height: 80,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  keyPressed: {\n    backgroundColor: BankColors.gray100,\n    borderRadius: 40,\n  },\n  keyEmpty: {\n    width: 80,\n    height: 80,\n  },\n  keyText: {\n    fontSize: 36,\n    fontWeight: \"300\",\n    color: BankColors.gray800,\n  },\n  cancelButton: {\n    paddingVertical: Spacing.lg,\n    alignItems: \"center\",\n    borderTopWidth: 1,\n    borderTopColor: BankColors.gray200,\n  },\n  cancelText: {\n    fontSize: 16,\n    color: BankColors.gray900,\n  },\n});\n","path":null,"size_bytes":8237,"size_tokens":null},"client/hooks/useTheme.ts":{"content":"import { Colors } from \"@/constants/theme\";\nimport { useColorScheme } from \"@/hooks/useColorScheme\";\n\nexport function useTheme() {\n  const colorScheme = useColorScheme();\n  const isDark = colorScheme === \"dark\";\n  const theme = Colors[colorScheme ?? \"light\"];\n\n  return {\n    theme,\n    isDark,\n  };\n}\n","path":null,"size_bytes":302,"size_tokens":null},"client/constants/theme.ts":{"content":"import { Platform } from \"react-native\";\n\nexport const BankColors = {\n  primary: \"#208037\",\n  primaryDark: \"#1a6b2d\",\n  primaryLight: \"#2a9645\",\n  gradientStart: \"#208037\",\n  gradientEnd: \"#1a6b2d\",\n  cardBlue: \"#007AB7\",\n  white: \"#FFFFFF\",\n  black: \"#000000\",\n  gray50: \"#FAFAFA\",\n  gray100: \"#F5F5F5\",\n  gray200: \"#EEEEEE\",\n  gray300: \"#E0E0E0\",\n  gray400: \"#BDBDBD\",\n  gray500: \"#9E9E9E\",\n  gray600: \"#757575\",\n  gray700: \"#616161\",\n  gray800: \"#424242\",\n  gray900: \"#212121\",\n  success: \"#4CAF50\",\n  error: \"#E53935\",\n  errorLight: \"#F44336\",\n  warning: \"#FF9800\",\n  link: \"#208037\",\n  cardBackground: \"#FFFFFF\",\n  divider: \"#E0E0E0\",\n  pagoBancomat: \"#FFD700\",\n  mastercardRed: \"#EB001B\",\n  mastercardOrange: \"#F79E1B\",\n};\n\nconst tintColorLight = BankColors.primary;\nconst tintColorDark = \"#4CAF50\";\n\nexport const Colors = {\n  light: {\n    text: \"#11181C\",\n    textSecondary: \"#757575\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#9E9E9E\",\n    tabIconSelected: tintColorLight,\n    link: BankColors.link,\n    backgroundRoot: \"#FFFFFF\",\n    backgroundDefault: \"#F5F5F5\",\n    backgroundSecondary: \"#EEEEEE\",\n    backgroundTertiary: \"#E0E0E0\",\n    primary: BankColors.primary,\n    success: BankColors.success,\n    error: BankColors.error,\n  },\n  dark: {\n    text: \"#ECEDEE\",\n    textSecondary: \"#9BA1A6\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#9BA1A6\",\n    tabIconSelected: tintColorDark,\n    link: \"#4CAF50\",\n    backgroundRoot: \"#1F2123\",\n    backgroundDefault: \"#2A2C2E\",\n    backgroundSecondary: \"#353739\",\n    backgroundTertiary: \"#404244\",\n    primary: BankColors.primary,\n    success: BankColors.success,\n    error: BankColors.error,\n  },\n};\n\nexport const Spacing = {\n  xs: 4,\n  sm: 8,\n  md: 12,\n  lg: 16,\n  xl: 20,\n  \"2xl\": 24,\n  \"3xl\": 32,\n  \"4xl\": 40,\n  \"5xl\": 48,\n  inputHeight: 48,\n  buttonHeight: 52,\n};\n\nexport const BorderRadius = {\n  xs: 4,\n  sm: 8,\n  md: 12,\n  lg: 16,\n  xl: 24,\n  \"2xl\": 32,\n  \"3xl\": 40,\n  full: 9999,\n};\n\nexport const Typography = {\n  h1: {\n    fontSize: 32,\n    fontWeight: \"700\" as const,\n  },\n  h2: {\n    fontSize: 28,\n    fontWeight: \"700\" as const,\n  },\n  h3: {\n    fontSize: 24,\n    fontWeight: \"600\" as const,\n  },\n  h4: {\n    fontSize: 20,\n    fontWeight: \"600\" as const,\n  },\n  body: {\n    fontSize: 16,\n    fontWeight: \"400\" as const,\n  },\n  small: {\n    fontSize: 14,\n    fontWeight: \"400\" as const,\n  },\n  caption: {\n    fontSize: 12,\n    fontWeight: \"400\" as const,\n  },\n  link: {\n    fontSize: 16,\n    fontWeight: \"400\" as const,\n  },\n  balance: {\n    fontSize: 36,\n    fontWeight: \"700\" as const,\n  },\n  balanceSmall: {\n    fontSize: 24,\n    fontWeight: \"400\" as const,\n  },\n};\n\nexport const Fonts = Platform.select({\n  ios: {\n    sans: \"system-ui\",\n    serif: \"ui-serif\",\n    rounded: \"ui-rounded\",\n    mono: \"ui-monospace\",\n  },\n  default: {\n    sans: \"normal\",\n    serif: \"serif\",\n    rounded: \"normal\",\n    mono: \"monospace\",\n  },\n  web: {\n    sans: \"system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif\",\n    serif: \"Georgia, 'Times New Roman', serif\",\n    rounded:\n      \"'SF Pro Rounded', 'Hiragino Maru Gothic ProN', Meiryo, 'MS PGothic', sans-serif\",\n    mono: \"SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace\",\n  },\n});\n","path":null,"size_bytes":3276,"size_tokens":null},"server/replit_integrations/image/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { openai } from \"./client\";\n\nexport function registerImageRoutes(app: Express): void {\n  app.post(\"/api/generate-image\", async (req: Request, res: Response) => {\n    try {\n      const { prompt, size = \"1024x1024\" } = req.body;\n\n      if (!prompt) {\n        return res.status(400).json({ error: \"Prompt is required\" });\n      }\n\n      const response = await openai.images.generate({\n        model: \"gpt-image-1\",\n        prompt,\n        n: 1,\n        size: size as \"1024x1024\" | \"512x512\" | \"256x256\",\n      });\n\n      const imageData = response.data?.[0];\n      res.json({\n        url: imageData?.url,\n        b64_json: imageData?.b64_json,\n      });\n    } catch (error) {\n      console.error(\"Error generating image:\", error);\n      res.status(500).json({ error: \"Failed to generate image\" });\n    }\n  });\n}\n","path":null,"size_bytes":875,"size_tokens":null},"client/components/Card.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, Pressable, ViewStyle } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface CardProps {\n  elevation?: number;\n  title?: string;\n  description?: string;\n  children?: React.ReactNode;\n  onPress?: () => void;\n  style?: ViewStyle;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst getBackgroundColorForElevation = (\n  elevation: number,\n  theme: any,\n): string => {\n  switch (elevation) {\n    case 1:\n      return theme.backgroundDefault;\n    case 2:\n      return theme.backgroundSecondary;\n    case 3:\n      return theme.backgroundTertiary;\n    default:\n      return theme.backgroundRoot;\n  }\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Card({\n  elevation = 1,\n  title,\n  description,\n  children,\n  onPress,\n  style,\n}: CardProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const cardBackgroundColor = getBackgroundColorForElevation(elevation, theme);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    scale.value = withSpring(0.98, springConfig);\n  };\n\n  const handlePressOut = () => {\n    scale.value = withSpring(1, springConfig);\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      style={[\n        styles.card,\n        {\n          backgroundColor: cardBackgroundColor,\n        },\n        animatedStyle,\n        style,\n      ]}\n    >\n      {title ? (\n        <ThemedText type=\"h4\" style={styles.cardTitle}>\n          {title}\n        </ThemedText>\n      ) : null}\n      {description ? (\n        <ThemedText type=\"small\" style={styles.cardDescription}>\n          {description}\n        </ThemedText>\n      ) : null}\n      {children}\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  card: {\n    padding: Spacing.xl,\n    borderRadius: BorderRadius[\"2xl\"],\n  },\n  cardTitle: {\n    marginBottom: Spacing.sm,\n  },\n  cardDescription: {\n    opacity: 0.7,\n  },\n});\n","path":null,"size_bytes":2437,"size_tokens":null},"client/components/ThemedView.tsx":{"content":"import { View, type ViewProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type ThemedViewProps = ViewProps & {\n  lightColor?: string;\n  darkColor?: string;\n};\n\nexport function ThemedView({\n  style,\n  lightColor,\n  darkColor,\n  ...otherProps\n}: ThemedViewProps) {\n  const { theme, isDark } = useTheme();\n\n  const backgroundColor =\n    isDark && darkColor\n      ? darkColor\n      : !isDark && lightColor\n        ? lightColor\n        : theme.backgroundRoot;\n\n  return <View style={[{ backgroundColor }, style]} {...otherProps} />;\n}\n","path":null,"size_bytes":563,"size_tokens":null},"client/navigation/MainTabNavigator.tsx":{"content":"import React from \"react\";\nimport { View, Text, StyleSheet } from \"react-native\";\nimport { createBottomTabNavigator } from \"@react-navigation/bottom-tabs\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport HomeScreen from \"@/screens/HomeScreen\";\nimport TransactionDetailScreen from \"@/screens/TransactionDetailScreen\";\nimport AnalisiScreen from \"@/screens/AnalisiScreen\";\nimport AdvisorScreen from \"@/screens/AdvisorScreen\";\nimport NewsScreen from \"@/screens/NewsScreen\";\nimport OperazioniScreen from \"@/screens/OperazioniScreen\";\nimport TransferScreen from \"@/screens/TransferScreen\";\nimport CarteScreen from \"@/screens/CarteScreen\";\nimport AltroScreen from \"@/screens/AltroScreen\";\nimport { Icon } from \"@/components/Icon\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport type { Transaction } from \"@shared/schema\";\n\nexport type HomeStackParamList = {\n  HomeMain: undefined;\n  TransactionDetail: { transaction: Transaction };\n  Analisi: undefined;\n  Advisor: undefined;\n  News: undefined;\n};\n\nexport type OperazioniStackParamList = {\n  OperazioniMain: undefined;\n  Transfer: undefined;\n};\n\nexport type MainTabParamList = {\n  Home: undefined;\n  Operazioni: undefined;\n  Carte: undefined;\n  Altro: undefined;\n};\n\nconst Tab = createBottomTabNavigator<MainTabParamList>();\nconst HomeStack = createNativeStackNavigator<HomeStackParamList>();\nconst OperazioniStack = createNativeStackNavigator<OperazioniStackParamList>();\n\nfunction HomeStackNavigator() {\n  return (\n    <HomeStack.Navigator screenOptions={{ headerShown: false }}>\n      <HomeStack.Screen name=\"HomeMain\" component={HomeScreen} />\n      <HomeStack.Screen name=\"TransactionDetail\" component={TransactionDetailScreen} />\n      <HomeStack.Screen name=\"Analisi\" component={AnalisiScreen} />\n      <HomeStack.Screen \n        name=\"Advisor\" \n        component={AdvisorScreen}\n        options={{\n          headerShown: true,\n          headerTitle: \"Consulente AI\",\n          headerTintColor: BankColors.primary,\n          headerStyle: { backgroundColor: BankColors.white },\n          headerBackTitle: \"Indietro\",\n        }}\n      />\n      <HomeStack.Screen \n        name=\"News\" \n        component={NewsScreen}\n        options={{\n          headerShown: true,\n          headerTitle: \"Notizie Finanziarie\",\n          headerTintColor: BankColors.primary,\n          headerStyle: { backgroundColor: BankColors.white },\n          headerBackTitle: \"Indietro\",\n        }}\n      />\n    </HomeStack.Navigator>\n  );\n}\n\nfunction OperazioniStackNavigator() {\n  return (\n    <OperazioniStack.Navigator screenOptions={{ headerShown: false }}>\n      <OperazioniStack.Screen name=\"OperazioniMain\" component={OperazioniScreen} />\n      <OperazioniStack.Screen name=\"Transfer\" component={TransferScreen} />\n    </OperazioniStack.Navigator>\n  );\n}\n\nfunction TabBarIcon({ name, color, focused, badge }: { \n  name: string; \n  color: string; \n  focused: boolean;\n  badge?: number;\n}) {\n  return (\n    <View style={styles.tabIconContainer}>\n      <Icon name={name} size={24} color={color} />\n      {badge ? (\n        <View style={styles.badge}>\n          <Text style={styles.badgeText}>{badge}</Text>\n        </View>\n      ) : null}\n    </View>\n  );\n}\n\nexport default function MainTabNavigator() {\n  const insets = useSafeAreaInsets();\n\n  return (\n    <Tab.Navigator\n      initialRouteName=\"Home\"\n      screenOptions={{\n        tabBarActiveTintColor: BankColors.primary,\n        tabBarInactiveTintColor: BankColors.gray500,\n        tabBarStyle: {\n          backgroundColor: BankColors.white,\n          borderTopWidth: 1,\n          borderTopColor: BankColors.gray200,\n          height: 60 + insets.bottom,\n          paddingTop: Spacing.sm,\n          paddingBottom: insets.bottom,\n        },\n        tabBarLabelStyle: {\n          fontSize: 11,\n          fontWeight: \"500\",\n        },\n        headerShown: false,\n      }}\n    >\n      <Tab.Screen\n        name=\"Home\"\n        component={HomeStackNavigator}\n        options={{\n          tabBarIcon: ({ color, focused }) => (\n            <TabBarIcon name=\"home\" color={color} focused={focused} />\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"Operazioni\"\n        component={OperazioniStackNavigator}\n        options={{\n          tabBarIcon: ({ color, focused }) => (\n            <View style={styles.euroIconContainer}>\n              <View style={[styles.euroCircle, { borderColor: color }]}>\n                <Text style={[styles.euroSymbol, { color }]}>E</Text>\n              </View>\n            </View>\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"Carte\"\n        component={CarteScreen}\n        options={{\n          tabBarIcon: ({ color, focused }) => (\n            <TabBarIcon name=\"credit-card\" color={color} focused={focused} />\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"Altro\"\n        component={AltroScreen}\n        options={{\n          tabBarIcon: ({ color, focused }) => (\n            <TabBarIcon name=\"menu\" color={color} focused={focused} badge={8} />\n          ),\n        }}\n      />\n    </Tab.Navigator>\n  );\n}\n\nconst styles = StyleSheet.create({\n  tabIconContainer: {\n    position: \"relative\",\n  },\n  badge: {\n    position: \"absolute\",\n    top: -4,\n    right: -8,\n    backgroundColor: BankColors.error,\n    borderRadius: 8,\n    minWidth: 16,\n    height: 16,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: 4,\n  },\n  badgeText: {\n    color: BankColors.white,\n    fontSize: 10,\n    fontWeight: \"700\",\n  },\n  euroIconContainer: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  euroCircle: {\n    width: 24,\n    height: 24,\n    borderRadius: 12,\n    borderWidth: 2,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  euroSymbol: {\n    fontSize: 14,\n    fontWeight: \"700\",\n  },\n});\n","path":null,"size_bytes":5916,"size_tokens":null},"server/replit_integrations/batch/utils.ts":{"content":"import pLimit from \"p-limit\";\nimport pRetry, { AbortError } from \"p-retry\";\n\nexport interface BatchOptions {\n  concurrency?: number;\n  retries?: number;\n  minTimeout?: number;\n  maxTimeout?: number;\n  onProgress?: (completed: number, total: number, item: unknown) => void;\n}\n\nexport function isRateLimitError(error: unknown): boolean {\n  const errorMsg = error instanceof Error ? error.message : String(error);\n  return (\n    errorMsg.includes(\"429\") ||\n    errorMsg.includes(\"RATELIMIT_EXCEEDED\") ||\n    errorMsg.toLowerCase().includes(\"quota\") ||\n    errorMsg.toLowerCase().includes(\"rate limit\")\n  );\n}\n\nexport async function batchProcess<T, R>(\n  items: T[],\n  processor: (item: T, index: number) => Promise<R>,\n  options: BatchOptions = {}\n): Promise<R[]> {\n  const {\n    concurrency = 2,\n    retries = 7,\n    minTimeout = 2000,\n    maxTimeout = 128000,\n    onProgress,\n  } = options;\n\n  const limit = pLimit(concurrency);\n  let completed = 0;\n\n  const promises = items.map((item, index) =>\n    limit(() =>\n      pRetry(\n        async () => {\n          try {\n            const result = await processor(item, index);\n            completed++;\n            onProgress?.(completed, items.length, item);\n            return result;\n          } catch (error: unknown) {\n            if (isRateLimitError(error)) {\n              throw error;\n            }\n            throw new AbortError(\n              error instanceof Error ? error : new Error(String(error))\n            );\n          }\n        },\n        { retries, minTimeout, maxTimeout, factor: 2 }\n      )\n    )\n  );\n\n  return Promise.all(promises);\n}\n\nexport async function batchProcessWithSSE<T, R>(\n  items: T[],\n  processor: (item: T, index: number) => Promise<R>,\n  sendEvent: (event: { type: string; [key: string]: unknown }) => void,\n  options: Omit<BatchOptions, \"concurrency\" | \"onProgress\"> = {}\n): Promise<R[]> {\n  const { retries = 5, minTimeout = 1000, maxTimeout = 15000 } = options;\n\n  sendEvent({ type: \"started\", total: items.length });\n\n  const results: R[] = [];\n  let errors = 0;\n\n  for (let index = 0; index < items.length; index++) {\n    const item = items[index];\n    sendEvent({ type: \"processing\", index, item });\n\n    try {\n      const result = await pRetry(\n        () => processor(item, index),\n        {\n          retries,\n          minTimeout,\n          maxTimeout,\n          factor: 2,\n          onFailedAttempt: (error) => {\n            if (!isRateLimitError(error)) {\n              throw new AbortError(\n                error instanceof Error ? error : new Error(String(error))\n              );\n            }\n          },\n        }\n      );\n      results.push(result);\n      sendEvent({ type: \"progress\", index, result });\n    } catch (error) {\n      errors++;\n      results.push(undefined as R);\n      sendEvent({\n        type: \"progress\",\n        index,\n        error: error instanceof Error ? error.message : \"Processing failed\",\n      });\n    }\n  }\n\n  sendEvent({ type: \"complete\", processed: items.length, errors });\n  return results;\n}\n","path":null,"size_bytes":3027,"size_tokens":null},"metro.config.js":{"content":"const { getDefaultConfig } = require(\"expo/metro-config\");\n\nconst config = getDefaultConfig(__dirname);\n\nconfig.transformer = {\n  ...config.transformer,\n  minifierPath: \"metro-minify-terser\",\n  minifierConfig: {\n    compress: {\n      drop_console: true,\n      drop_debugger: true,\n      dead_code: true,\n      unused: true,\n      passes: 3,\n    },\n    mangle: {\n      toplevel: true,\n      keep_fnames: false,\n      keep_classnames: false,\n    },\n    output: {\n      comments: false,\n    },\n  },\n};\n\nmodule.exports = config;\n","path":null,"size_bytes":525,"size_tokens":null},"client/components/SecurityCheck.tsx":{"content":"import React, { useEffect, useState } from \"react\";\nimport { View, Text, Modal, Pressable, StyleSheet, Platform } from \"react-native\";\nimport * as Device from \"expo-device\";\nimport { BankColors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport { Icon } from \"@/components/Icon\";\n\ninterface SecurityCheckProps {\n  children: React.ReactNode;\n}\n\nexport function SecurityCheck({ children }: SecurityCheckProps) {\n  const [showWarning, setShowWarning] = useState(false);\n  const [warningDismissed, setWarningDismissed] = useState(false);\n\n  useEffect(() => {\n    checkDeviceSecurity();\n  }, []);\n\n  const checkDeviceSecurity = async () => {\n    try {\n      const isEmulator = !Device.isDevice;\n      const isRootedIndicators = await detectRootIndicators();\n      \n      if (isRootedIndicators && !isEmulator) {\n        setShowWarning(true);\n      }\n    } catch (error) {\n      console.log(\"Security check error:\", error);\n    }\n  };\n\n  const detectRootIndicators = async (): Promise<boolean> => {\n    if (Platform.OS === \"web\") {\n      return false;\n    }\n\n    if (Platform.OS === \"android\") {\n      const deviceName = Device.deviceName?.toLowerCase() || \"\";\n      const modelName = Device.modelName?.toLowerCase() || \"\";\n      const brand = Device.brand?.toLowerCase() || \"\";\n      \n      const suspiciousPatterns = [\n        \"rooted\",\n        \"magisk\",\n        \"supersu\",\n        \"kingroot\",\n        \"test-keys\",\n        \"custom\",\n        \"lineage\",\n        \"cyanogen\",\n      ];\n      \n      const combinedInfo = `${deviceName} ${modelName} ${brand}`;\n      \n      for (const pattern of suspiciousPatterns) {\n        if (combinedInfo.includes(pattern)) {\n          return true;\n        }\n      }\n    }\n\n    if (Platform.OS === \"ios\") {\n      const osName = Device.osName?.toLowerCase() || \"\";\n      const deviceName = Device.deviceName?.toLowerCase() || \"\";\n      \n      const jailbreakIndicators = [\n        \"jailbroken\",\n        \"cydia\",\n        \"sileo\",\n        \"unc0ver\",\n        \"checkra1n\",\n      ];\n      \n      const combinedInfo = `${osName} ${deviceName}`;\n      \n      for (const indicator of jailbreakIndicators) {\n        if (combinedInfo.includes(indicator)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  const handleDismiss = () => {\n    setWarningDismissed(true);\n    setShowWarning(false);\n  };\n\n  if (showWarning && !warningDismissed) {\n    return (\n      <View style={styles.container}>\n        {children}\n        <Modal visible={true} transparent animationType=\"fade\">\n          <View style={styles.overlay}>\n            <View style={styles.warningCard}>\n              <View style={styles.iconContainer}>\n                <Icon name=\"alert-triangle\" size={48} color={BankColors.error} />\n              </View>\n              <Text style={styles.title}>Avviso di Sicurezza</Text>\n              <Text style={styles.message}>\n                Abbiamo rilevato che il tuo dispositivo potrebbe essere stato modificato (root/jailbreak).\n              </Text>\n              <Text style={styles.submessage}>\n                Per la tua sicurezza, alcune funzionalita potrebbero essere limitate. Ti consigliamo di utilizzare un dispositivo non modificato.\n              </Text>\n              <Pressable style={styles.button} onPress={handleDismiss}>\n                <Text style={styles.buttonText}>Ho capito, continua</Text>\n              </Pressable>\n            </View>\n          </View>\n        </Modal>\n      </View>\n    );\n  }\n\n  return <>{children}</>;\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  overlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.7)\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing.xl,\n  },\n  warningCard: {\n    backgroundColor: BankColors.white,\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.xl,\n    width: \"100%\",\n    maxWidth: 340,\n    alignItems: \"center\",\n  },\n  iconContainer: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    backgroundColor: \"#FEE2E2\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  title: {\n    fontSize: 20,\n    fontWeight: \"700\",\n    color: BankColors.gray900,\n    marginBottom: Spacing.md,\n    textAlign: \"center\",\n  },\n  message: {\n    fontSize: 15,\n    color: BankColors.gray700,\n    textAlign: \"center\",\n    marginBottom: Spacing.sm,\n    lineHeight: 22,\n  },\n  submessage: {\n    fontSize: 13,\n    color: BankColors.gray500,\n    textAlign: \"center\",\n    marginBottom: Spacing.xl,\n    lineHeight: 20,\n  },\n  button: {\n    backgroundColor: BankColors.error,\n    paddingVertical: Spacing.md,\n    paddingHorizontal: Spacing.xl,\n    borderRadius: BorderRadius.md,\n    width: \"100%\",\n  },\n  buttonText: {\n    color: BankColors.white,\n    fontSize: 16,\n    fontWeight: \"600\",\n    textAlign: \"center\",\n  },\n});\n","path":null,"size_bytes":4835,"size_tokens":null}},"version":2}